<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.relate.hihokenshoshikakushohakko.IHihokenshoShikakushoHakkoMapper">

    <resultMap id="被保険者証資格証発行情報取得ResultMap" type="jp.co.ndensan.reams.db.dbz.entity.db.hihokenshoshikakushohakko.HihokenshoShikakushoHakkoEntity" autoMapping="true">
        <result property="要介護認定状態区分コード" column="TB1_yokaigoJotaiKubunCode"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
        <result property="受給申請年月日" column="TB1_jukyuShinseiYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="認定年月日" column="TB1_ninteiYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="認定有効期間開始年月日" column="TB1_ninteiYukoKikanKaishiYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="認定有効期間終了年月日" column="TB1_ninteiYukoKikanShuryoYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="支給限度単位数" column="TB1_shikyuGendoTanisu"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DemicalTypeHandler" />
        <result property="支給限度有効開始年月日" column="TB1_shikyuGendoKaishiYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="支給限度有効終了年月日" column="TB1_shikyuGendoShuryoYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="介護認定審査会意見" column="C_shinsakaiIken"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
    </resultMap>

    <resultMap id="限度額データ取得ResultMap" type="jp.co.ndensan.reams.db.dbz.entity.db.hihokenshoshikakushohakko.ServiceTypeListEntity" autoMapping="true">
        <result property="限度額" column="A_shikyuGendoTaniSu"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DemicalTypeHandler" />
        <result property="サービス種類コード" column="A_serviceShuruiCode"  typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ServiceShuruiCodeTypeHandler" />
        <result property="サービス種類名称" column="B_serviceShuruiMeisho"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
    </resultMap>

    <resultMap id="支払方法変更の情報取得ResultMap" type="jp.co.ndensan.reams.db.dbz.entity.db.hihokenshoshikakushohakko.ShiharaiHohoHenkoEntity" autoMapping="true">
        <result property="証記載保険者番号" column="ShiharaiHohoHenko_shoKisaiHokenshaNo"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="被保険者番号" column="ShiharaiHohoHenko_hihokenshaNo"  typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler" />
        <result property="管理区分" column="ShiharaiHohoHenko_kanriKubun"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="履歴番号" column="ShiharaiHohoHenko_rirekiNo" />
        <result property="登録区分" column="ShiharaiHohoHenko_torokuKubun"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="適用開始年月日" column="ShiharaiHohoHenko_tekiyoKaishiYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="適用終了年月日" column="ShiharaiHohoHenko_tekiyoShuryoYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
    </resultMap>

    <resultMap id="居宅給付計画届出情報取得ResultMap" type="jp.co.ndensan.reams.db.dbz.entity.db.hihokenshoshikakushohakko.KyotakuKeikakuTodokedeEntity" autoMapping="true">
        <result property="被保険者番号" column="KyotakuKeikakuTodokede_hihokenshaNo"  typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler" />
        <result property="対象年月" column="KyotakuKeikakuTodokede_taishoYM"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler" />
        <result property="履歴番号" column="KyotakuKeikakuTodokede_rirekiNo"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler" />
        <result property="届出年月日" column="KyotakuKeikakuTodokede_todokedeYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
    </resultMap>

    <resultMap id="介護保険施設入退所の情報取得ResultMap" type="jp.co.ndensan.reams.db.dbz.entity.db.hihokenshoshikakushohakko.KaigoHokenShisetsuNyutaishoEntity" autoMapping="true">
        <result property="識別コード" column="ShisetsuNyutaisho_shikibetsuCode"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler" />
        <result property="入所施設種類" column="ShisetsuNyutaisho_nyushoShisetsuShurui"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="入所施設コード" column="ShisetsuNyutaisho_nyushoShisetsuCode"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="入所年月日" column="ShisetsuNyutaisho_nyushoYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="退所年月日" column="ShisetsuNyutaisho_taishoYMD"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
    </resultMap>

    <select id="被保険者証資格証発行情報取得" parameterType="jp.co.ndensan.reams.db.dbz.definition.core.hihokenshoshikakushohakko.HihokenshoShikakushoHakkoMapperParameter"
            resultMap="被保険者証資格証発行情報取得ResultMap" fetchSize="500">
        SELECT
        TB1."yokaigoJotaiKubunCode" AS TB1_yokaigoJotaiKubunCode,
        TB1."jukyuShinseiYMD" AS TB1_jukyuShinseiYMD,
        TB1."ninteiYMD" AS TB1_ninteiYMD,
        TB1."ninteiYukoKikanKaishiYMD" AS TB1_ninteiYukoKikanKaishiYMD,
        TB1."ninteiYukoKikanShuryoYMD" AS TB1_ninteiYukoKikanShuryoYMD,
        TB1."shikyuGendoTanisu" AS TB1_shikyuGendoTanisu,
        TB1."shikyuGendoKaishiYMD" AS TB1_shikyuGendoKaishiYMD,
        TB1."shikyuGendoShuryoYMD" AS TB1_shikyuGendoShuryoYMD,
        C."shinsakaiIken" AS C_shinsakaiIken
        FROM
        (
        SELECT
        A."hihokenshaNo",
        A."shikibetsuCode",
        A."shinseishoKanriNo",
        A."jukyuShinseiYMD",
        A."ninteiYMD",
        A."yokaigoJotaiKubunCode",
        A."ninteiYukoKikanKaishiYMD",
        A."ninteiYukoKikanShuryoYMD",
        A."shikyuGendoTanisu",
        A."shikyuGendoKaishiYMD",
        A."shikyuGendoShuryoYMD"
        From
        rgdb."DbT4001JukyushaDaicho" AS A
        WHERE
        A."hihokenshaNo" = #{被保険者番号}
        AND A."yukoMukoKubun" = #{有効無効区分}
        AND A."logicalDeletedFlag" = #{論理削除フラグ}
        ORDER BY
        A."rirekiNo" DESC,
        A."edaban" DESC
        LIMIT 1

        ) AS TB1
        LEFT JOIN
        rgdb."DbT4102NinteiKekkaJoho" AS C
        ON
        TB1."shinseishoKanriNo" = C."shinseishoKanriNo"

    </select>

    <select id="限度額データ取得" parameterType="jp.co.ndensan.reams.db.dbz.definition.core.hihokenshoshikakushohakko.HihokenshoShikakushoHakkoMapperParameter"
            resultMap="限度額データ取得ResultMap" fetchSize="500">
        SELECT
        A."serviceShuruiCode" AS A_serviceShuruiCode,
        A."shikyuGendoTaniSu" AS A_shikyuGendoTaniSu,
        B."serviceShuruiMeisho" AS B_serviceShuruiMeisho
        FROM
        rgdb."DbT7111ServiceShuruiShikyuGendoGaku" AS A
        LEFT JOIN
        rgdb."DbT7130KaigoServiceShurui" AS B
        ON
        A."serviceShuruiCode" = B."serviceShuruiCd"
        AND B."teikyoKaishiYM" <![CDATA[<=]]> A."tekiyoKaishuYM"
        AND A."tekiyoKaishuYM" <![CDATA[<=]]> B."teikyoshuryoYM"
        WHERE
        A."yoKaigoJotaiKubun" = '1'
        AND #{認定有効期間開始年月日} <![CDATA[<=]]> A."tekiyoKaishuYM"
        AND A."tekiyoKaishuYM" <![CDATA[<=]]> #{認定有効期間終了年月日}
        ORDER BY
        A_serviceShuruiCode ASC

    </select>
    <select id="支払方法変更の情報取得" resultMap="支払方法変更の情報取得ResultMap" fetchSize="500">

        SELECT
        A."shoKisaiHokenshaNo"  AS ShiharaiHohoHenko_shoKisaiHokenshaNo,
        A."hihokenshaNo" AS ShiharaiHohoHenko_hihokenshaNo,
        A."kanriKubun" AS ShiharaiHohoHenko_kanriKubun,
        A."rirekiNo" AS ShiharaiHohoHenko_rirekiNo,
        A."torokuKubun" AS ShiharaiHohoHenko_torokuKubun,
        A."tekiyoKaishiYMD" AS ShiharaiHohoHenko_tekiyoKaishiYMD,
        A."tekiyoShuryoYMD" AS ShiharaiHohoHenko_tekiyoShuryoYMD
        FROM
        (SELECT
        ShiharaiHohoHenko."shoKisaiHokenshaNo",
        ShiharaiHohoHenko."hihokenshaNo",
        ShiharaiHohoHenko."kanriKubun",
        ShiharaiHohoHenko."rirekiNo",
        ShiharaiHohoHenko."torokuKubun",
        ShiharaiHohoHenko."tekiyoKaishiYMD",
        ShiharaiHohoHenko."tekiyoShuryoYMD",
        row_number() over(partition by ShiharaiHohoHenko."shoKisaiHokenshaNo" order by ShiharaiHohoHenko."tekiyoShuryoYMD"  desc,ShiharaiHohoHenko."tekiyoKaishiYMD" desc) as rank_number
        FROM
        rgdb."DbT4021ShiharaiHohoHenko" AS ShiharaiHohoHenko
        WHERE
        ShiharaiHohoHenko."tekiyoShuryoYMD" <![CDATA[>]]> ShiharaiHohoHenko."tekiyoKaishiYMD") AS A
        WHERE (A.rank_number = 1 OR A.rank_number = 2 OR A.rank_number = 3)

    </select>

    <select id="居宅給付計画届出情報取得" resultMap="居宅給付計画届出情報取得ResultMap" fetchSize="500">

        SELECT
        A."hihokenshaNo" AS KyotakuKeikakuTodokede_hihokenshaNo,
        A."taishoYM" AS KyotakuKeikakuTodokede_taishoYM,
        A."rirekiNo" AS KyotakuKeikakuTodokede_rirekiNo,
        A."todokedeYMD" AS KyotakuKeikakuTodokede_todokedeYMD
        FROM
        (SELECT
        KyotakuKeikakuTodokede."hihokenshaNo",
        KyotakuKeikakuTodokede."taishoYM",
        KyotakuKeikakuTodokede."rirekiNo",
        KyotakuKeikakuTodokede."todokedeYMD",
        row_number() over(partition by KyotakuKeikakuTodokede."hihokenshaNo" order by KyotakuKeikakuTodokede."taishoYM" desc, KyotakuKeikakuTodokede."rirekiNo" desc) as rank_number
        FROM
        rgdb."DbT3005KyotakuKeikakuTodokede" AS KyotakuKeikakuTodokede) AS A
        WHERE
        (A.rank_number = 1 OR A.rank_number = 2 OR A.rank_number = 3)

    </select>

    <select id="介護保険施設入退所の情報取得" resultMap="介護保険施設入退所の情報取得ResultMap" fetchSize="500">

        SELECT
        A."shikibetsuCode" AS ShisetsuNyutaisho_shikibetsuCode,
        A."nyushoShisetsuShurui" AS ShisetsuNyutaisho_nyushoShisetsuShurui,
        A."nyushoShisetsuCode" AS ShisetsuNyutaisho_nyushoShisetsuCode,
        A."nyushoYMD" AS ShisetsuNyutaisho_nyushoYMD,
        A."taishoYMD" AS ShisetsuNyutaisho_taishoYMD
        FROM
        (SELECT
        ShisetsuNyutaisho."shikibetsuCode",
        ShisetsuNyutaisho."nyushoShisetsuShurui",
        ShisetsuNyutaisho."nyushoShisetsuCode",
        ShisetsuNyutaisho."nyushoYMD",
        ShisetsuNyutaisho."taishoYMD",
        row_number() over(partition by ShisetsuNyutaisho."shikibetsuCode" order by ShisetsuNyutaisho."taishoYMD" desc, ShisetsuNyutaisho."nyushoYMD" desc) as rank_number
        FROM
        rgdb."DbT1004ShisetsuNyutaisho" AS ShisetsuNyutaisho
        WHERE
        ShisetsuNyutaisho."daichoShubetsu" = '1'
        AND ShisetsuNyutaisho."taishoYMD" <![CDATA[>]]> ShisetsuNyutaisho."nyushoYMD"
        ) AS A
        WHERE
        (A.rank_number = 1 OR A.rank_number = 2)

    </select>
</mapper>
