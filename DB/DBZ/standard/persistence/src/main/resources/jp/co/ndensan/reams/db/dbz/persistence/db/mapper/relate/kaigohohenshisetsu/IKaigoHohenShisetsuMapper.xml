<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<mapper namespace="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.relate.kaigohohenshisetsu.IKaigoHohenShisetsuMapper">
    
    <resultMap id="ResultMap_DbT1004ShisetsuNyutaishoEntity" type="jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT1004ShisetsuNyutaishoEntity" autoMapping="true">
        <id property="shikibetsuCode" column="dbT1004ShisetsuNyutaisho_shikibetsuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
        <id property="rirekiNo" column="dbT1004ShisetsuNyutaisho_rirekiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="insertDantaiCd" column="dbT1004ShisetsuNyutaisho_insertDantaiCd" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="insertTimestamp" column="dbT1004ShisetsuNyutaisho_insertTimestamp" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RDateTimeTypeHandler"/>
        <result property="insertReamsLoginId" column="dbT1004ShisetsuNyutaisho_insertReamsLoginId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="insertContextId" column="dbT1004ShisetsuNyutaisho_insertContextId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.UUIDTypeHandler"/>
        <result property="isDeleted" column="dbT1004ShisetsuNyutaisho_isDeleted" />
        <result property="updateCount" column="dbT1004ShisetsuNyutaisho_updateCount" />
        <result property="lastUpdateTimestamp" column="dbT1004ShisetsuNyutaisho_lastUpdateTimestamp" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RDateTimeTypeHandler"/>
        <result property="lastUpdateReamsLoginId" column="dbT1004ShisetsuNyutaisho_lastUpdateReamsLoginId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shichosonCode" column="dbT1004ShisetsuNyutaisho_shichosonCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler"/>
        <result property="daichoShubetsu" column="dbT1004ShisetsuNyutaisho_daichoShubetsu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="nyushoShisetsuShurui" column="dbT1004ShisetsuNyutaisho_nyushoShisetsuShurui" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="nyushoShisetsuCode" column="dbT1004ShisetsuNyutaisho_nyushoShisetsuCode" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
        <result property="nyushoShoriYMD" column="dbT1004ShisetsuNyutaisho_nyushoShoriYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="nyushoYMD" column="dbT1004ShisetsuNyutaisho_nyushoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="taishoShoriYMD" column="dbT1004ShisetsuNyutaisho_taishoShoriYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="taishoYMD" column="dbT1004ShisetsuNyutaisho_taishoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="roomKigoNo" column="dbT1004ShisetsuNyutaisho_roomKigoNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>
    
    <select id="getShiSeTsuJyoHon" parameterType="jp.co.ndensan.reams.db.dbz.definition.mybatisprm.kaigohohenshisetsu.KaigoHohenShisetsuMybatisParameter" resultMap="ResultMap_DbT1004ShisetsuNyutaishoEntity">
        SELECT
        rgdb."DbT1004ShisetsuNyutaisho"."shikibetsuCode"
        , rgdb."DbT1004ShisetsuNyutaisho"."rirekiNo"
        , rgdb."DbT1004ShisetsuNyutaisho"."shichosonCode"
        , rgdb."DbT1004ShisetsuNyutaisho"."daichoShubetsu"
        , rgdb."DbT1004ShisetsuNyutaisho"."nyushoShisetsuShurui"
        , rgdb."DbT1004ShisetsuNyutaisho"."nyushoShisetsuCode"
        , rgdb."DbT1004ShisetsuNyutaisho"."nyushoShoriYMD"
        , rgdb."DbT1004ShisetsuNyutaisho"."nyushoYMD"
        , rgdb."DbT1004ShisetsuNyutaisho"."taishoShoriYMD"
        , rgdb."DbT1004ShisetsuNyutaisho"."taishoYMD"
        , rgdb."DbT1004ShisetsuNyutaisho"."roomKigoNo" 
        FROM
        rgdb."DbT1004ShisetsuNyutaisho" 
        WHERE
        rgdb."DbT1004ShisetsuNyutaisho"."shikibetsuCode" = #{shikibetsuCode}
        ORDER BY
        rgdb."DbT1004ShisetsuNyutaisho"."rirekiNo",
        rgdb."DbT1004ShisetsuNyutaisho"."nyushoYMD"
    </select>
    
     <resultMap id="result_selct施設情報の取得" type="jp.co.ndensan.reams.db.dbz.entity.db.relate.kaigohohenshisetsu.KaigoHohenShisetsuRelateEntity">
        <result property="shikibetsuCode" column="shikibetsuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
        <result property="rirekiNo" column="rirekiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="shichosonCode" column="shichosonCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler"/>
        <result property="daichoShubetsu" column="daichoShubetsu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="nyushoShoriYMD" column="nyushoShoriYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="nyushoYMD" column="nyushoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="taishoShoriYMD" column="taishoShoriYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="taishoYMD" column="taishoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="roomKigoNo" column="roomKigoNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="jigyoshaName" column="jigyoshaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>
    
    
    <!--適用除外施設情報件数を取得します-->
    <select id="getShiSeTsuJyoHon_A" parameterType="jp.co.ndensan.reams.db.dbz.definition.mybatisprm.kaigohohenshisetsu.KaigoHohenShisetsuMybatisParameter" resultMap="result_selct施設情報の取得">
        SELECT  
            DbT1004."shikibetsuCode"          AS  shikibetsuCode
            , DbT1004."rirekiNo"               AS  rirekiNo
            , DbT1004."shichosonCode"          AS  shikibetsuCode
            , DbT1004."daichoShubetsu"         AS  daichoShubetsu
            , DbT1004."nyushoShisetsuShurui"   AS  nyushoShisetsuShurui
            , DbT1004."nyushoShisetsuCode"     AS  nyushoShisetsuCode
            , DbT1004."nyushoShoriYMD"         AS  nyushoShoriYMD
            , DbT1004."nyushoYMD"              AS  nyushoYMD
            , DbT1004."taishoShoriYMD"         AS  taishoShoriYMD
            , DbT1004."taishoYMD"              AS  taishoYMD
            , DbT1004."roomKigoNo"             AS  roomKigoNo
            , DbT7060."jigyoshaName"           AS  jigyoshaName
        FROM      
                (SELECT
                    rgdb."DbT1004ShisetsuNyutaisho"."shikibetsuCode"
                    , rgdb."DbT1004ShisetsuNyutaisho"."rirekiNo"
                    , rgdb."DbT1004ShisetsuNyutaisho"."shichosonCode"
                    , rgdb."DbT1004ShisetsuNyutaisho"."daichoShubetsu"
                    , rgdb."DbT1004ShisetsuNyutaisho"."nyushoShisetsuShurui"
                    , rgdb."DbT1004ShisetsuNyutaisho"."nyushoShisetsuCode"
                    , rgdb."DbT1004ShisetsuNyutaisho"."nyushoShoriYMD"
                    , rgdb."DbT1004ShisetsuNyutaisho"."nyushoYMD"
                    , rgdb."DbT1004ShisetsuNyutaisho"."taishoShoriYMD"
                    , rgdb."DbT1004ShisetsuNyutaisho"."taishoYMD"
                    , rgdb."DbT1004ShisetsuNyutaisho"."roomKigoNo" 
                FROM
                rgdb."DbT1004ShisetsuNyutaisho" 
                WHERE
                rgdb."DbT1004ShisetsuNyutaisho"."shikibetsuCode" = #{shikibetsuCode}
                ORDER BY
                rgdb."DbT1004ShisetsuNyutaisho"."rirekiNo",
                rgdb."DbT1004ShisetsuNyutaisho"."nyushoYMD") AS  DbT1004
        LEFT JOIN 
            rgdb."DbT7060KaigoJigyosha" AS DbT7060
        ON          DbT7060."jigyoshaNo" = DbT1004."nyushoShisetsuCode"
        AND         DbT1004."nyushoShisetsuShurui" = #{入所施設種類}
        AND         DbT7060."yukoKaishiYMD" = (SELECT MAX(rgdb."DbT7060KaigoJigyosha"."yukoKaishiYMD")
                                                FROM  rgdb."DbT7060KaigoJigyosha"
                                                WHERE rgdb."DbT7060KaigoJigyosha"."jigyoshaNo" =  DbT1004."nyushoShisetsuCode")
    </select>
      
    <select id="getShiSeTsuJyoHon_I" parameterType="jp.co.ndensan.reams.db.dbz.definition.mybatisprm.kaigohohenshisetsu.KaigoHohenShisetsuMybatisParameter" resultMap="result_selct施設情報の取得">
        SELECT  
            DbT1004."shikibetsuCode"          AS  shikibetsuCode
           , DbT1004."rirekiNo"               AS  rirekiNo
           , DbT1004."shichosonCode"          AS  shikibetsuCode
           , DbT1004."daichoShubetsu"         AS  daichoShubetsu
           , DbT1004."nyushoShisetsuShurui"   AS  nyushoShisetsuShurui
           , DbT1004."nyushoShisetsuCode"     AS  nyushoShisetsuCode
           , DbT1004."nyushoShoriYMD"         AS  nyushoShoriYMD
           , DbT1004."nyushoYMD"              AS  nyushoYMD
           , DbT1004."taishoShoriYMD"         AS  taishoShoriYMD
           , DbT1004."taishoYMD"              AS  taishoYMD
           , DbT1004."roomKigoNo"             AS  roomKigoNo
           , DbT1005."jigyoshaMeisho"           AS  jigyoshaName
        FROM      
            (SELECT
            rgdb."DbT1004ShisetsuNyutaisho"."shikibetsuCode"
            , rgdb."DbT1004ShisetsuNyutaisho"."rirekiNo"
            , rgdb."DbT1004ShisetsuNyutaisho"."shichosonCode"
            , rgdb."DbT1004ShisetsuNyutaisho"."daichoShubetsu"
            , rgdb."DbT1004ShisetsuNyutaisho"."nyushoShisetsuShurui"
            , rgdb."DbT1004ShisetsuNyutaisho"."nyushoShisetsuCode"
            , rgdb."DbT1004ShisetsuNyutaisho"."nyushoShoriYMD"
            , rgdb."DbT1004ShisetsuNyutaisho"."nyushoYMD"
            , rgdb."DbT1004ShisetsuNyutaisho"."taishoShoriYMD"
            , rgdb."DbT1004ShisetsuNyutaisho"."taishoYMD"
            , rgdb."DbT1004ShisetsuNyutaisho"."roomKigoNo" 
        FROM
            rgdb."DbT1004ShisetsuNyutaisho" 
        WHERE
                rgdb."DbT1004ShisetsuNyutaisho"."shikibetsuCode" = #{shikibetsuCode}
                ORDER BY
                rgdb."DbT1004ShisetsuNyutaisho"."rirekiNo",
                rgdb."DbT1004ShisetsuNyutaisho"."nyushoYMD") AS  DbT1004
        LEFT JOIN 
                rgdb."DbT1005KaigoJogaiTokureiTaishoShisetsu" AS DbT1005
        ON          DbT1005."jigyoshaNo" = DbT1004."nyushoShisetsuCode"
        AND         DbT1005."jigyoshaShubetsu" = DbT1004."nyushoShisetsuShurui"
        AND         DbT1004."nyushoShisetsuShurui" = #{入所施設種類}
        AND         DbT1005."yukoKaishiYMD" = ( SELECT MAX(rgdb."DbT1005KaigoJogaiTokureiTaishoShisetsu"."yukoKaishiYMD")
                                                FROM  rgdb."DbT1005KaigoJogaiTokureiTaishoShisetsu"
                                                WHERE DbT1005."jigyoshaNo" = DbT1004."nyushoShisetsuCode"
                                                    AND  DbT1005."jigyoshaShubetsu" = DbT1004."nyushoShisetsuShurui")
    </select>
</mapper>