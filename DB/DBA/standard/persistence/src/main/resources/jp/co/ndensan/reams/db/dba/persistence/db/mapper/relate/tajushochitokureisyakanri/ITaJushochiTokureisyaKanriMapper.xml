<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 他住所地特例者管理クラスのマッパー用XMLです。 -->
<!-- @reamsid_L DBA-0200-020 linghuhang -->
<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dba.persistence.db.mapper.relate.tajushochitokureisyakanri.ITaJushochiTokureisyaKanriMapper">

    <resultMap id="result_selct他市町村住所地特例" type="jp.co.ndensan.reams.db.dba.entity.db.relate.tajushochitokureisyakan.TaJushochiTokureisyaKanriRelateEntity">
        <result property="shikibetsuCode" column="shikibetsuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
        <result property="idoYMD" column="idoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="edaNo" column="edaNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="idoJiyuCode" column="idoJiyuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shichosonCode" column="shichosonCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler"/>
        <result property="tekiyoJiyuCode" column="tekiyoJiyuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="tekiyoYMD" column="tekiyoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="tekiyoTodokedeYMD" column="tekiyoTodokedeYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="tekiyoUketsukeYMD" column="tekiyoUketsukeYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="kaijoJiyuCode" column="kaijoJiyuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="kaijoYMD" column="kaijoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="kaijoTodokedeYMD" column="kaijoTodokedeYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="kaijoUketsukeYMD" column="kaijoUketsukeYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="sochiHokenshaNo" column="sochiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ShoKisaiHokenshaNoTypeHandler"/>
        <result property="sochiHihokenshaNo" column="sochiHihokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <result property="tatokuRenrakuhyoHakkoYMD" column="tatokuRenrakuhyoHakkoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shisetsuTaishoTsuchiHakkoYMD" column="shisetsuTaishoTsuchiHakkoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shisetsuHenkoTsuchiHakkoYMD" column="shisetsuHenkoTsuchiHakkoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="rirekiNo" column="rirekiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="daichoShubetsu" column="daichoShubetsu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="nyushoShisetsuShurui" column="nyushoShisetsuShurui" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="nyushoShisetsuCode" column="nyushoShisetsuCode" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
        <result property="nyushoYMD" column="nyushoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="taishoYMD" column="taishoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="hokenjaName" column="hokenjaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>

    <select resultOrdered="true" id="selct他市町村住所地特例" resultMap="result_selct他市町村住所地特例"
            parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.tajushochitokureisyakanri.TaJushochiTokureisyaKanriParameter" fetchSize="500">
        SELECT
        dbT1003."shikibetsuCode"               AS "shikibetsuCode",
        dbT1003."idoYMD"                       AS "idoYMD",
        dbT1003."edaNo"                        AS "edaNo",
        dbT1003."idoJiyuCode"                  AS "idoJiyuCode",
        dbT1003."shichosonCode"                AS "shichosonCode",
        dbT1003."tekiyoJiyuCode"               AS "tekiyoJiyuCode",
        dbT1003."tekiyoYMD"                    AS "tekiyoYMD",
        dbT1003."tekiyoTodokedeYMD"            AS "tekiyoTodokedeYMD",
        dbT1003."tekiyoUketsukeYMD"            AS "tekiyoUketsukeYMD",
        dbT1003."kaijoJiyuCode"                AS "kaijoJiyuCode",
        dbT1003."kaijoYMD"                     AS "kaijoYMD",
        dbT1003."kaijoTodokedeYMD"             AS "kaijoTodokedeYMD",
        dbT1003."kaijoUketsukeYMD"             AS "kaijoUketsukeYMD",
        dbT1003."sochiHokenshaNo"              AS "sochiHokenshaNo",
        dbT1003."sochiHihokenshaNo"            AS "sochiHihokenshaNo",
        dbT1003."tatokuRenrakuhyoHakkoYMD"     AS "tatokuRenrakuhyoHakkoYMD",
        dbT1003."shisetsuTaishoTsuchiHakkoYMD" AS "shisetsuTaishoTsuchiHakkoYMD",
        dbT1003."shisetsuHenkoTsuchiHakkoYMD"  AS "shisetsuHenkoTsuchiHakkoYMD",
        dbT1004."rirekiNo"                     AS "rirekiNo",
        dbT1004."daichoShubetsu"               AS "daichoShubetsu",
        dbT1004."nyushoShisetsuShurui"         AS "nyushoShisetsuShurui",
        dbT1004."nyushoShisetsuCode"           AS "nyushoShisetsuCode",
        dbT1004."nyushoYMD"                    AS "nyushoYMD",
        dbT1004."taishoYMD"                    AS "taishoYMD",
        urT0507."hokenjaName"                  AS "hokenjaName"
        FROM
        (
        SELECT
        dbT1003Tashichoson."shikibetsuCode"               AS "shikibetsuCode",
        dbT1003Tashichoson."idoYMD"                       AS "idoYMD",
        dbT1003Tashichoson."edaNo"                        AS "edaNo",
        dbT1003Tashichoson."idoJiyuCode"                  AS "idoJiyuCode",
        dbT1003Tashichoson."shichosonCode"                AS "shichosonCode",
        dbT1003Tashichoson."tekiyoJiyuCode"               AS "tekiyoJiyuCode",
        dbT1003Tashichoson."tekiyoYMD"                    AS "tekiyoYMD",
        dbT1003Tashichoson."tekiyoTodokedeYMD"            AS "tekiyoTodokedeYMD",
        dbT1003Tashichoson."tekiyoUketsukeYMD"            AS "tekiyoUketsukeYMD",
        dbT1003Tashichoson."kaijoJiyuCode"                AS "kaijoJiyuCode",
        dbT1003Tashichoson."kaijoYMD"                     AS "kaijoYMD",
        dbT1003Tashichoson."kaijoTodokedeYMD"             AS "kaijoTodokedeYMD",
        dbT1003Tashichoson."kaijoUketsukeYMD"             AS "kaijoUketsukeYMD",
        dbT1003Tashichoson."sochiHokenshaNo"              AS "sochiHokenshaNo",
        dbT1003Tashichoson."sochiHihokenshaNo"            AS "sochiHihokenshaNo",
        dbT1003Tashichoson."tatokuRenrakuhyoHakkoYMD"     AS "tatokuRenrakuhyoHakkoYMD",
        dbT1003Tashichoson."shisetsuTaishoTsuchiHakkoYMD" AS "shisetsuTaishoTsuchiHakkoYMD",
        dbT1003Tashichoson."shisetsuHenkoTsuchiHakkoYMD"  AS "shisetsuHenkoTsuchiHakkoYMD"
        FROM
                    (SELECT
                    *,
                    ROW_NUMBER() OVER (PARTITION BY T1."shikibetsuCode", T1."tekiyoYMD" ORDER BY 
                    T1."shikibetsuCode" ASC,
                    T1."tekiyoYMD" ASC,
                    T1."idoYMD" DESC,
                    T1."edaNo" DESC) AS rrkno
             FROM
                    rgdb."DbT1003TashichosonJushochiTokurei" AS T1
             WHERE
                    T1."shikibetsuCode" = #{shikibetsuCode}
                    AND T1."logicalDeletedFlag" = FALSE) AS dbT1003Tashichoson
        WHERE
            dbT1003Tashichoson."rrkno" = 1
        ) AS dbT1003
        LEFT JOIN rgdb."DbT1004ShisetsuNyutaisho" AS dbT1004
        ON
        dbT1004."shikibetsuCode" = dbT1003."shikibetsuCode"
        AND 
        dbT1004."daichoShubetsu" = #{psmShikibetsuTaisho}
        AND
        ((dbT1003."kaijoYMD" IS NULL AND (dbT1004."taishoYMD" IS NULL OR dbT1003."tekiyoYMD" <![CDATA[<=]]> dbT1004."taishoYMD"))
        OR ((dbT1003."kaijoYMD" IS NOT NULL
        AND ((dbT1004."taishoYMD" IS NULL AND dbT1004."nyushoYMD" <![CDATA[<]]> dbT1003."kaijoYMD")
        OR (dbT1004."nyushoYMD" <![CDATA[<]]> dbT1003."kaijoYMD" AND dbT1004."taishoYMD" <![CDATA[>]]> dbT1003."tekiyoYMD")))))
        LEFT JOIN rgur."UrT0507Hokenja" AS urT0507
        ON
        urT0507."hokenjaNo" = dbT1003."sochiHokenshaNo"
        AND urT0507."hokenjaShubetsu" = '08'
        ORDER BY
        dbT1003."tekiyoYMD" DESC, dbT1003."idoYMD" DESC,dbT1003."edaNo" DESC, dbT1004."nyushoYMD" DESC, dbT1004."taishoYMD" DESC
    </select>

    <resultMap id="result_get事業者名称_介護保険施設" type="jp.co.ndensan.reams.db.dba.entity.db.relate.tajushochitokureisyakan.TaJushochiTokureisyaKanriRelateEntity">
        <result property="jigyoshaName" column="jigyoshaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler"/>
    </resultMap>
    <select resultOrdered="true" id="get事業者名称_介護保険施設" resultMap="result_get事業者名称_介護保険施設"
            parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.tajushochitokureisyakanri.TaJushochiTokureisyaKanriParameter" fetchSize="500">
        SELECT
        dbT7060."jigyoshaName" AS "jigyoshaName"
        FROM
        rgdb."DbT7060KaigoJigyosha" AS dbT7060
        WHERE
        dbT7060."jigyoshaNo" = #{nyushoShisetsuCode}
        AND dbT7060."yukoKaishiYMD" = (
        SELECT
        MAX(dbT7060Kaigo."yukoKaishiYMD") AS "yukoKaishiYMD"
        FROM
        rgdb."DbT7060KaigoJigyosha" AS dbT7060Kaigo
        WHERE
        dbT7060Kaigo."jigyoshaNo" = #{nyushoShisetsuCode}
        )
    </select>

    <resultMap id="result_get事業者名称_住所地特例対象施設" type="jp.co.ndensan.reams.db.dba.entity.db.relate.tajushochitokureisyakan.TaJushochiTokureisyaKanriRelateEntity">
        <result property="jigyoshaMeisho" column="jigyoshaMeisho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler"/>
    </resultMap>
    <select resultOrdered="true" id="get事業者名称_住所地特例対象施設" resultMap="result_get事業者名称_住所地特例対象施設"
            parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.tajushochitokureisyakanri.TaJushochiTokureisyaKanriParameter" fetchSize="500">
        SELECT
        dbT1005."jigyoshaMeisho" AS "jigyoshaMeisho"
        FROM
        rgdb."DbT1005KaigoJogaiTokureiTaishoShisetsu" AS dbT1005
        WHERE
        dbT1005."jigyoshaShubetsu" = #{juushotiTokureitaishouShisetu}
        AND dbT1005."jigyoshaNo" = #{nyushoShisetsuCode}
        AND dbT1005."yukoKaishiYMD" = (
        SELECT
        MAX(dbT1005Kaigo."yukoKaishiYMD") AS "yukoKaishiYMD"
        FROM
        rgdb."DbT1005KaigoJogaiTokureiTaishoShisetsu" AS dbT1005Kaigo
        WHERE
        dbT1005Kaigo."jigyoshaShubetsu" = #{juushotiTokureitaishouShisetu}
        AND	dbT1005Kaigo."jigyoshaNo" = #{nyushoShisetsuCode}
        )

    </select>
    <select resultOrdered="true" id="select宛名情報" resultMap="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.UaFt200FindShikibetsuTaishoEntity"
            parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.tajushochitokureisyakanri.TaJushochiTokureisyaKanriParameter" fetchSize="500">
        SELECT
        <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.columns_ShikibetsuTaisho" />
        FROM
        <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.tableName_PsmShikibetsuTaisho" />
        AS <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.as_ShikibetsuTaisho" />
    </select>


    <select resultOrdered="true" id="select施設入退所情報リスト件数取得"
            resultType="java.lang.Integer"
            parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.tajushochitokureisya.TaJushochiTokureisyaKanriParameter">
        SELECT
        COUNT(*)
        FROM
        rgdb."DbT1003TashichosonJushochiTokurei" AS tokurei
        WHERE
        NOT
        (
        (#{nyuusyoYMD} <![CDATA[>]]> tokurei."tekiyoYMD" AND #{nyuusyoYMD} <![CDATA[>=]]> tokurei."kaijoYMD")
        OR
        (#{tayishoYMD} <![CDATA[<=]]> tokurei."tekiyoYMD" AND #{tayishoYMD} <![CDATA[<]]> tokurei."kaijoYMD")
        )
    </select>
    
    
    <select resultOrdered="true" id="get他市町村住所地特例" resultMap="ResultMap_TashichosonRelateEntity"
            parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.tajushochitokureisyakanri.TaJushochiTokureisyaKanriParameter" fetchSize="500">
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1003TashichosonJushochiTokureiMapper.allColumns_DbT1003TashichosonJushochiTokurei"/>,
           <include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1004ShisetsuNyutaishoMapper.allColumns_DbT1004ShisetsuNyutaisho"/> 
        FROM
        (
        SELECT
        dbT1003Tashichoson.* 
        FROM
                 (SELECT
                    *,
                    ROW_NUMBER() OVER (PARTITION BY T1."shikibetsuCode", T1."tekiyoYMD" ORDER BY 
                    T1."shikibetsuCode" ASC,
                    T1."tekiyoYMD" ASC,
                    T1."idoYMD" DESC,
                    T1."edaNo" DESC) AS rrkno
             FROM
                    rgdb."DbT1003TashichosonJushochiTokurei" AS T1
             WHERE
                    T1."shikibetsuCode" = #{shikibetsuCode}
                    AND T1."logicalDeletedFlag" = FALSE) AS dbT1003Tashichoson
        WHERE
            dbT1003Tashichoson."rrkno" = 1
        ) AS "DbT1003TashichosonJushochiTokurei"
        LEFT JOIN rgdb."DbT1004ShisetsuNyutaisho" AS "DbT1004ShisetsuNyutaisho"
        ON
        "DbT1004ShisetsuNyutaisho"."shikibetsuCode" = "DbT1003TashichosonJushochiTokurei"."shikibetsuCode"
         AND         "DbT1004ShisetsuNyutaisho"."daichoShubetsu" = #{psmShikibetsuTaisho}
           AND
           (("DbT1003TashichosonJushochiTokurei"."kaijoYMD" IS NULL AND ("DbT1004ShisetsuNyutaisho"."taishoYMD" IS NULL OR "DbT1003TashichosonJushochiTokurei"."tekiyoYMD" <![CDATA[<=]]> "DbT1004ShisetsuNyutaisho"."taishoYMD"))
        OR (("DbT1003TashichosonJushochiTokurei"."kaijoYMD" IS NOT NULL
        AND (("DbT1004ShisetsuNyutaisho"."taishoYMD" IS NULL AND "DbT1004ShisetsuNyutaisho"."nyushoYMD" <![CDATA[<]]> "DbT1003TashichosonJushochiTokurei"."kaijoYMD")
        OR ("DbT1004ShisetsuNyutaisho"."nyushoYMD" <![CDATA[<]]> "DbT1003TashichosonJushochiTokurei"."kaijoYMD" AND "DbT1004ShisetsuNyutaisho"."taishoYMD" <![CDATA[>]]> "DbT1003TashichosonJushochiTokurei"."tekiyoYMD")))))
        LEFT JOIN rgur."UrT0507Hokenja" AS urT0507
        ON
        urT0507."hokenjaNo" = "DbT1003TashichosonJushochiTokurei"."sochiHokenshaNo"
                   AND urT0507."hokenjaShubetsu" = '08'
        ORDER BY
        "DbT1003TashichosonJushochiTokurei"."tekiyoYMD" DESC
        , "DbT1003TashichosonJushochiTokurei"."idoYMD" DESC,
           "DbT1003TashichosonJushochiTokurei"."edaNo" DESC
           , "DbT1004ShisetsuNyutaisho"."nyushoYMD" DESC, 
           "DbT1004ShisetsuNyutaisho"."taishoYMD" DESC
    </select>
    <resultMap id="ResultMap_TashichosonRelateEntity" type="jp.co.ndensan.reams.db.dba.entity.db.relate.tajushochitokureisyakan.TashichosonRelateEntity" autoMapping="true">
        <association property="住所地特例EntityList" resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1003TashichosonJushochiTokureiMapper.ResultMap_DbT1003TashichosonJushochiTokureiEntity"/>
        <association property="施設入退所EntityLsit" resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1004ShisetsuNyutaishoMapper.ResultMap_DbT1004ShisetsuNyutaishoEntity"/>
    </resultMap>
</mapper>