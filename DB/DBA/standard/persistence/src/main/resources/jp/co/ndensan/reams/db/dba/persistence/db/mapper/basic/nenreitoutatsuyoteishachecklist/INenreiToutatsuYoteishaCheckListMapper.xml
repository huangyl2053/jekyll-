<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.co.ndensan.reams.db.dba.persistence.db.mapper.basic.nenreitoutatsuyoteishachecklist.INenreiToutatsuYoteishaCheckListMapper">

    <resultMap id="resultMap_NenreiToutatsuYoteishaCheckListEntity" type="jp.co.ndensan.reams.db.dba.entity.db.nenreitoutatsuyoteishachecklist.NenreiToutatsuYoteishaCheckListEntity" autoMapping="true">
        <result property="shikibetsuCode"                  column="PSM_shikibetsuCode"		typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler" />
	<result property="meisho"    column="PSM_meisho"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="kanaMeisho"    column="PSM_kanaMeisho"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="zenkokuJushoCode"    column="PSM_zenkokuJushoCode"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="jusho"    column="PSM_jusho"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="gyoseikuCode"    column="PSM_gyoseikuCode"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="gyoseikuName"    column="PSM_gyoseikuName"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="seibetsuCode"    column="PSM_seibetsuCode"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="seinengappiYMD"    column="PSM_seinengappiYMD"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
	<result property="juminShubetsuCode"    column="PSM_juminShubetsuCode"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="shichosonCode"    column="DbT1001Hiho_shichosonCode"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="hihokenshaNo"    column="DbT1001Hiho_hihokenshaNo"   typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler" />
	<result property="jushochiTokureiFlag"    column="DbT1001Hiho_jushochiTokureiFlag" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="hihokennshaKubunCode"    column="DbT1001Hiho_hihokennshaKubunCode"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
    </resultMap>
    
    <select id="getTorokuNenreiToutatsuYoteishaCheckList"
            resultMap="resultMap_NenreiToutatsuYoteishaCheckListEntity" 
            parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.torokunenreitoutatsuyoteishacheck.NenreiToutatsuYoteishaCheckListMybatisParameter" fetchSize="500">
        SELECT									
	    PSM."shikibetsuCode" AS "PSM_shikibetsuCode",							
	    PSM."meisho" AS "PSM_meisho",								
	    PSM."kanaMeisho"	AS  "PSM_kanaMeisho",
            PSM."zenkokuJushoCode" AS "PSM_zenkokuJushoCode",
            PSM."jusho" AS "PSM_jusho",
            PSM."gyoseikuCode" AS "PSM_gyoseikuCode",
            PSM."gyoseikuName" AS "PSM_gyoseikuName",
            PSM."seibetsuCode" AS "PSM_seibetsuCode",
            PSM."seinengappiYMD" AS "PSM_seinengappiYMD",
            PSM."juminShubetsuCode" AS "PSM_juminShubetsuCode",
            DbT1001Hiho."shichosonCode" AS "DbT1001Hiho_shichosonCode",
            DbT1001Hiho."hihokenshaNo" AS "DbT1001Hiho_hihokenshaNo",
            DbT1001Hiho."jushochiTokureiFlag" AS "DbT1001Hiho_jushochiTokureiFlag"
	FROM									
	    rgdb."DbT1001HihokenshaDaicho" AS DbT1001Hiho							
	INNER JOIN									
	    rgua.${psmShikibetsuTaisho} AS PSM								
	ON									
	    DbT1001Hiho."shikibetsuCode" = PSM."shikibetsuCode"								
	WHERE	DbT1001Hiho."shikibetsuCode"  IN 
            (
                SELECT
                    "shikibetsuCode"
                FROM 
                    rgua.${psmShikibetsuTaisho2}
            )		
        AND
            DbT1001Hiho."logicalDeletedFlag" <![CDATA[<>]]> TRUE					
    </select>
    
    <select id="getTorokuNenreiToutatsuYoteishaCheckList2"
        resultMap="resultMap_NenreiToutatsuYoteishaCheckListEntity" 
        parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.torokunenreitoutatsuyoteishacheck.NenreiToutatsuYoteishaCheckListMybatisParameter"    fetchSize="500">
        SELECT									
            PSM."shikibetsuCode" AS "PSM_shikibetsuCode",							
            PSM."meisho" AS "PSM_meisho",								
            PSM."kanaMeisho"	AS  "PSM_kanaMeisho",
            PSM."zenkokuJushoCode" AS "PSM_zenkokuJushoCode",
            PSM."jusho" AS "PSM_jusho",
            PSM."gyoseikuCode" AS "PSM_gyoseikuCode",
            PSM."gyoseikuName" AS "PSM_gyoseikuName",
            PSM."seibetsuCode" AS "PSM_seibetsuCode",
            PSM."seinengappiYMD" AS "PSM_seinengappiYMD",
            PSM."juminShubetsuCode" AS "PSM_juminShubetsuCode",
            DbT1001Hiho."shichosonCode" AS "DbT1001Hiho_shichosonCode",
            DbT1001Hiho."hihokenshaNo" AS "DbT1001Hiho_hihokenshaNo",
            DbT1001Hiho."jushochiTokureiFlag" AS "DbT1001Hiho_jushochiTokureiFlag",
            DbT1001Hiho."hihokennshaKubunCode" AS "DbT1001Hiho_hihokennshaKubunCode"
        FROM									
            rgdb."DbT1001HihokenshaDaicho" AS DbT1001Hiho							
        INNER JOIN									
            rgua.${psmShikibetsuTaisho} AS PSM									
        ON									
            DbT1001Hiho."shikibetsuCode" = PSM."shikibetsuCode"								
        WHERE	
            DbT1001Hiho."logicalDeletedFlag" <![CDATA[<>]]> TRUE
        AND
            DbT1001Hiho."jushochiTokureiFlag" = '1'	
        AND
            DbT1001Hiho."shikakuSoshitsuYMD" IS NULL
        AND
            DbT1001Hiho."hihokennshaKubunCode" = '2'
    </select>
    
    <select id="getZenbuNenreiToutatsuYoteishaCheckList"
            resultMap="resultMap_NenreiToutatsuYoteishaCheckListEntity" 
            parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.torokunenreitoutatsuyoteishacheck.NenreiToutatsuYoteishaCheckListMybatisParameter"
            fetchSize="500">
        SELECT									
	    PSM."shikibetsuCode" AS "PSM_shikibetsuCode",							
	    PSM."meisho" AS "PSM_meisho",								
            PSM."kanaMeisho"	AS  "PSM_kanaMeisho",
            PSM."zenkokuJushoCode" AS "PSM_zenkokuJushoCode",
            PSM."jusho" AS "PSM_jusho",
            PSM."gyoseikuCode" AS "PSM_gyoseikuCode",
            PSM."gyoseikuName" AS "PSM_gyoseikuName",
            PSM."seibetsuCode" AS "PSM_seibetsuCode",
            PSM."seinengappiYMD" AS "PSM_seinengappiYMD",
            PSM."juminShubetsuCode" AS "PSM_juminShubetsuCode",
            DbT1001Hiho."shichosonCode" AS "DbT1001Hiho_shichosonCode",
            DbT1001Hiho."hihokenshaNo" AS "DbT1001Hiho_hihokenshaNo",
            DbT1001Hiho."jushochiTokureiFlag" AS "DbT1001Hiho_jushochiTokureiFlag"
	FROM	
            rgua.${psmShikibetsuTaisho} AS PSM
	LEFT JOIN									
	    rgdb."DbT1001HihokenshaDaicho" AS DbT1001Hiho								
	ON									
	    DbT1001Hiho."shikibetsuCode" = PSM."shikibetsuCode"								
	AND 
            DbT1001Hiho."logicalDeletedFlag" <![CDATA[<>]]> TRUE					
	WHERE	DbT1001Hiho."shikibetsuCode"  IN 
            (
                SELECT
                    "shikibetsuCode"
                FROM 
                    rgua.${psmShikibetsuTaisho2}
            )							
    </select>
    
    <select id="getZenbuNenreiToutatsuYoteishaCheckList2"
        resultMap="resultMap_NenreiToutatsuYoteishaCheckListEntity" 
        parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.torokunenreitoutatsuyoteishacheck.NenreiToutatsuYoteishaCheckListMybatisParameter"
            fetchSize="500">
        SELECT									
            PSM."shikibetsuCode" AS "PSM_shikibetsuCode",							
            PSM."meisho" AS "PSM_meisho",								
            PSM."kanaMeisho"	AS  "PSM_kanaMeisho",
            PSM."zenkokuJushoCode" AS "PSM_zenkokuJushoCode",
            PSM."jusho" AS "PSM_jusho",
            PSM."gyoseikuCode" AS "PSM_gyoseikuCode",
            PSM."gyoseikuName" AS "PSM_gyoseikuName",
            PSM."seibetsuCode" AS "PSM_seibetsuCode",
            PSM."seinengappiYMD" AS "PSM_seinengappiYMD",
            PSM."juminShubetsuCode" AS "PSM_juminShubetsuCode",
            DbT1001Hiho."shichosonCode" AS "DbT1001Hiho_shichosonCode",
            DbT1001Hiho."hihokenshaNo" AS "DbT1001Hiho_hihokenshaNo",
            DbT1001Hiho."jushochiTokureiFlag" AS "DbT1001Hiho_jushochiTokureiFlag",
            DbT1001Hiho."hihokennshaKubunCode" AS "DbT1001Hiho_hihokennshaKubunCode"
        FROM	
            rgua.${psmShikibetsuTaisho} AS PSM
	LEFT JOIN									
	    rgdb."DbT1001HihokenshaDaicho" AS DbT1001Hiho								
	ON									
	    DbT1001Hiho."shikibetsuCode" = PSM."shikibetsuCode"							
        WHERE	
            DbT1001Hiho."logicalDeletedFlag" <![CDATA[<>]]> TRUE
        AND
            DbT1001Hiho."hihokennshaKubunCode" = '2'
        UNION
        SELECT									
            PSM."shikibetsuCode" AS "PSM_shikibetsuCode",							
            PSM."meisho" AS "PSM_meisho",								
            PSM."kanaMeisho"	AS  "PSM_kanaMeisho",
            PSM."zenkokuJushoCode" AS "PSM_zenkokuJushoCode",
            PSM."jusho" AS "PSM_jusho",
            PSM."gyoseikuCode" AS "PSM_gyoseikuCode",
            PSM."gyoseikuName" AS "PSM_gyoseikuName",
            PSM."seibetsuCode" AS "PSM_seibetsuCode",
            PSM."seinengappiYMD" AS "PSM_seinengappiYMD",
            PSM."juminShubetsuCode" AS "PSM_juminShubetsuCode",
            DbT1001Hiho."shichosonCode" AS "DbT1001Hiho_shichosonCode",
            DbT1001Hiho."hihokenshaNo" AS "DbT1001Hiho_hihokenshaNo",
            DbT1001Hiho."jushochiTokureiFlag" AS "DbT1001Hiho_jushochiTokureiFlag",
            DbT1001Hiho."hihokennshaKubunCode" AS "DbT1001Hiho_hihokennshaKubunCode"
        FROM	
            rgua.${psmShikibetsuTaisho2} AS PSM
	LEFT JOIN									
	    rgdb."DbT1001HihokenshaDaicho" AS DbT1001Hiho								
	ON									
	    DbT1001Hiho."shikibetsuCode" = PSM."shikibetsuCode"							
        WHERE	
            DbT1001Hiho."logicalDeletedFlag" <![CDATA[<>]]> TRUE
        AND 
            DbT1001Hiho."jushochiTokureiFlag" = '1'
        AND 
            DbT1001Hiho."hihokennshaKubunCode" = '2'
	UNION
	SELECT									
            PSM."shikibetsuCode" AS "PSM_shikibetsuCode",							
            PSM."meisho" AS "PSM_meisho",								
            PSM."kanaMeisho"	AS  "PSM_kanaMeisho",
            PSM."zenkokuJushoCode" AS "PSM_zenkokuJushoCode",
            PSM."jusho" AS "PSM_jusho",
            PSM."gyoseikuCode" AS "PSM_gyoseikuCode",
            PSM."gyoseikuName" AS "PSM_gyoseikuName",
            PSM."seibetsuCode" AS "PSM_seibetsuCode",
            PSM."seinengappiYMD" AS "PSM_seinengappiYMD",
            PSM."juminShubetsuCode" AS "PSM_juminShubetsuCode",
            DbT1001Hiho."shichosonCode" AS "DbT1001Hiho_shichosonCode",
            DbT1001Hiho."hihokenshaNo" AS "DbT1001Hiho_hihokenshaNo",
            DbT1001Hiho."jushochiTokureiFlag" AS "DbT1001Hiho_jushochiTokureiFlag",
            DbT1001Hiho."hihokennshaKubunCode" AS "DbT1001Hiho_hihokennshaKubunCode"
        FROM	
            rgua.${psmShikibetsuTaisho3} AS PSM
	LEFT JOIN									
	    rgdb."DbT1001HihokenshaDaicho" AS DbT1001Hiho								
	ON									
	    DbT1001Hiho."shikibetsuCode" = PSM."shikibetsuCode"							
        WHERE	
            DbT1001Hiho."logicalDeletedFlag" <![CDATA[<>]]> TRUE
        AND
            PSM."seinengappiYMD" IS NOT NULL

    </select>
  
    <resultMap id="resultMap_DbT1009ShikakuShutokuJogaishaEntity" type="jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT1009ShikakuShutokuJogaishaEntity" autoMapping="true">
        <result property="shikibetsuCode"   column="DbT1009Shikaku_shikibetsuCode"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler" />
    </resultMap>
    <select id="getShikakuShutokuJogaiList"
        resultMap="resultMap_DbT1009ShikakuShutokuJogaishaEntity" fetchSize="500">
        SELECT
            "DbT1009Shikaku_shikibetsuCode"
        FROM (
                SELECT									
                    "shikibetsuCode" AS "DbT1009Shikaku_shikibetsuCode",
                    row_number() over(partition by "shikibetsuCode" order by "rirekiNo" DESC, "shikakuShutokuJogaiYMD" DESC) as rank_number
                FROM	
                    rgdb."DbT1009ShikakuShutokuJogaisha"
            ) AS DBT1009
        where DBT1009.rank_number = 1
    </select>
      
    <resultMap id="resultMap_DbT1002TekiyoJogaishaEntity" type="jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT1002TekiyoJogaishaEntity" autoMapping="true">
        <result property="shikibetsuCode"   column="DbT1002Tekiyo_shikibetsuCode"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler" />
	<result property="tekiyoYMD"    column="DbT1002Tekiyo_tekiyoYMD"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="kaijoYMD"    column="DbT1002Tekiyo_kaijoYMD"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
    </resultMap>
    <select id="getTekiyoJogaiList"
        resultMap="resultMap_DbT1002TekiyoJogaishaEntity" fetchSize="500">
        SELECT
            "DbT1002Tekiyo_shikibetsuCode",
            "DbT1002Tekiyo_tekiyoYMD",
             "DbT1002Tekiyo_kaijoYMD"
        FROM (
                SELECT									
                    DbT1002Tekiyo."shikibetsuCode" AS "DbT1002Tekiyo_shikibetsuCode",
                    DbT1002Tekiyo."tekiyoYMD" AS "DbT1002Tekiyo_tekiyoYMD",
                    DbT1002Tekiyo."kaijoYMD" AS "DbT1002Tekiyo_kaijoYMD",
                    row_number() over(partition by "shikibetsuCode" order by "tekiyoYMD" DESC, "idoYMD" DESC) as rank_number
                FROM	
                    rgdb."DbT1002TekiyoJogaisha" AS DbT1002Tekiyo
                WHERE	
                    "logicalDeletedFlag" <![CDATA[<>]]> TRUE
              ) AS DbT1002
        WHERE DbT1002.rank_number = 1
        
    </select>
    
    <resultMap id="resultMap_DbT1003TashichosonJushochiTokureiEntity" type="jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT1003TashichosonJushochiTokureiEntity" autoMapping="true">
        <result property="shikibetsuCode"   column="DbT1003Tashicho_shikibetsuCode"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler" />
	<result property="tekiyoYMD"    column="DbT1003Tashicho_tekiyoYMD"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="kaijoYMD"    column="DbT1003Tashicho_kaijoYMD"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
    </resultMap>
    <select id="getTashichosonJushochi"
        resultMap="resultMap_DbT1003TashichosonJushochiTokureiEntity" fetchSize="500">
        SELECT 
            "DbT1003Tashicho_shikibetsuCode",
            "DbT1003Tashicho_tekiyoYMD",
            "DbT1003Tashicho_kaijoYMD"
        FROM (
                SELECT									
                    DbT1003Tashicho."shikibetsuCode" AS "DbT1003Tashicho_shikibetsuCode",
                    DbT1003Tashicho."tekiyoYMD" AS "DbT1003Tashicho_tekiyoYMD",
                    DbT1003Tashicho."kaijoYMD" AS "DbT1003Tashicho_kaijoYMD",
                    row_number() over(partition by "shikibetsuCode" order by "tekiyoYMD" DESC, "idoYMD" DESC) as rank_number
                FROM	
                    rgdb."DbT1003TashichosonJushochiTokurei" AS DbT1003Tashicho
                WHERE	
                    DbT1003Tashicho."logicalDeletedFlag" <![CDATA[<>]]> TRUE
             ) AS DbT1003
         WHERE DbT1003.rank_number = 1
    </select>
    
    <resultMap id="resultMap_UrT0508SeikatsuHogoJukyushaEntity" type="jp.co.ndensan.reams.ur.urd.entity.db.basic.seikatsuhogo.UrT0508SeikatsuHogoJukyushaEntity" autoMapping="true">
        <result property="shikibetsuCode"   column="UrT0508Seika_shikibetsuCode"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler" />
	<result property="jukyuKaishiYMD"    column="UrT0508Seika_jukyuKaishiYMD"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="jukyuHaishiYMD"    column="UrT0508Seika_jukyuHaishiYMD"   typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
    </resultMap>
    <select id="getSeikatsuHogojyu"
        resultMap="resultMap_UrT0508SeikatsuHogoJukyushaEntity" parameterType="jp.co.ndensan.reams.uz.uza.biz.ShikibetsuCode" fetchSize="500">
               SELECT									
                    UrT0508Seika."shikibetsuCode" AS "UrT0508Seika_shikibetsuCode",
                    UrT0508Seika."jukyuKaishiYMD" AS "UrT0508Seika_jukyuKaishiYMD",
                    UrT0508Seika."jukyuHaishiYMD" AS "UrT0508Seika_jukyuHaishiYMD"
                FROM	
                    rgur."UrT0508SeikatsuHogoJukyusha" AS UrT0508Seika
                WHERE	
                    UrT0508Seika."shikibetsuCode" = #{shikibetsuCode}
    </select>
   
       <!--処理日付管理マスタインサート処理-->
    <insert id="getInsert" parameterType="jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT7022ShoriDateKanriEntity" >
        INSERT INTO
        rgdb."DbT7022ShoriDateKanri"
        ("subGyomuCode",
        "shichosonCode",
        "shoriName",
        "shoriEdaban",
        "nendo",
        "nendoNaiRenban",
        "taishoKaishiYMD",
        "taishoShuryoYMD")
        VALUES(
        'DBA',
        '000000',
        #{shoriName},
        TO_CHAR(TO_NUMBER((SELECT MAX("shoriEdaban") FROM rgdb."DbT7022ShoriDateKanri"),  '0009') + 1, 'FM0009'),
        TO_CHAR(NOW(),'yyyy'),
        TO_CHAR(TO_NUMBER((SELECT MAX("nendoNaiRenban") FROM rgdb."DbT7022ShoriDateKanri"),  '0009') + 1, 'FM0009'),
        #{taishoKaishiYMD},
        #{taishoShuryoYMD})
    </insert>
</mapper>