<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 被保険者台帳管理のマッピング用XMLです。 -->
<!--@reamsid_L DBA-1610-030 lishengli-->
<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dba.persistence.db.mapper.relate.hanyolisthihokenshadaicho.IHanyoListHihokenshadaichoMapper">
    
    <resultMap id="resultMap_HanyoListHihokenshadaichoRelateEntity" type="jp.co.ndensan.reams.db.dba.entity.db.relate.hanyolisthihokenshadaicho.HanyoListHihokenshadaichoRelateEntity" autoMapping="true">
        <result property="hihokenshaNo" column="DbT1001_hihokenshaNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shichosonCode" column="DbT1001_shichosonCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler"/>
        <result property="shikakuShutokuJiyuCode" column="DbT1001_shikakuShutokuJiyuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler"/>
        <result property="shikakuShutokuYMD" column="DbT1001_shikakuShutokuYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shikakuShutokuTodokedeYMD" column="DbT1001_shikakuShutokuTodokedeYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shikakuSoshitsuJiyuCode" column="DbT1001_shikakuSoshitsuJiyuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler"/>
        <result property="shikakuSoshitsuYMD" column="DbT1001_shikakuSoshitsuYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shikakuSoshitsuTodokedeYMD" column="DbT1001_shikakuSoshitsuTodokedeYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="hihokennshaKubunCode" column="DbT1001_hihokennshaKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="jushochiTokureiFlag" column="DbT1001_jushochiTokureiFlag"/>
        <result property="koikinaiJushochiTokureiFlag" column="DbT1001_koikinaiJushochiTokureiFlag"/>
        <result property="koikinaiTokureiSochimotoShichosonCode" column="DbT1001_koikinaiTokureiSochimotoShichosonCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler"/>
        <association property="psmEntity" resultMap="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.UaFt200FindShikibetsuTaishoEntity"/>
    </resultMap>
    <select id="get汎用リスト被保険者台帳データの取得" resultMap="resultMap_HanyoListHihokenshadaichoRelateEntity" 
            parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.hanyolisthihokenshadaicho.HanyoListHihokenshadaichoMyBatisParameter" fetchSize="500">
        SELECT
            DbT1001."hihokenshaNo" AS "DbT1001_hihokenshaNo",
            DbT1001."shichosonCode" AS "DbT1001_shichosonCode",
            DbT1001."shikakuShutokuJiyuCode" AS "DbT1001_shikakuShutokuJiyuCode",
            DbT1001."shikakuShutokuYMD" AS "DbT1001_shikakuShutokuYMD",
            DbT1001."shikakuShutokuTodokedeYMD" AS "DbT1001_shikakuShutokuTodokedeYMD",
            DbT1001."shikakuSoshitsuJiyuCode" AS "DbT1001_shikakuSoshitsuJiyuCode",
            DbT1001."shikakuSoshitsuYMD" AS "DbT1001_shikakuSoshitsuYMD",
            DbT1001."shikakuSoshitsuTodokedeYMD" AS "DbT1001_shikakuSoshitsuTodokedeYMD",
            DbT1001."hihokennshaKubunCode" AS "DbT1001_hihokennshaKubunCode",
            DbT1001."jushochiTokureiFlag" AS "DbT1001_jushochiTokureiFlag",
            DbT1001."koikinaiJushochiTokureiFlag" AS "DbT1001_koikinaiJushochiTokureiFlag",
            DbT1001."koikinaiTokureiSochimotoShichosonCode" AS "DbT1001_koikinaiTokureiSochimotoShichosonCode",
            <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.columns_ShikibetsuTaisho" />
        FROM rgdb."DbT1001HihokenshaDaicho" As DbT1001
        <if test="isEmpty">
        LEFT OUTER JOIN rgdb."DbT4001JukyushaDaicho" As DbT4001
            ON DbT4001."hihokenshaNo" = DbT1001."hihokenshaNo"
            AND DbT4001."ninteiYukoKikanKaishiYMD" <![CDATA[<=]]> #{kijunni}
            AND DbT4001."ninteiYukoKikanShuryoYMD" <![CDATA[>=]]> #{kijunni}
            AND DbT4001."yokaigoJotaiKubunCode" <![CDATA[<>]]> '01'
            AND DbT4001."yukoMukoKubun" = '1'
            AND DbT4001."logicalDeletedFlag" = False
        </if>
        INNER JOIN rgua.${psmShikibetsuTaisho} AS "ShikibetsuTaisho"
            ON "ShikibetsuTaisho"."shikibetsuCode" = DbT1001."shikibetsuCode"
        <if test="is年齢">
            <if test="has年齢開始">
                AND "ShikibetsuTaisho"."seinengappiYMD"  <![CDATA[<=]]> #{宛名抽出年齢開始}
            </if>
            <if test="has年齢終了">
                AND "ShikibetsuTaisho"."seinengappiYMD"  <![CDATA[>=]]> #{宛名抽出年齢終了}
            </if>
        </if>
        <if test="is生年月日">
            <if test="has生年月日開始">
                AND "ShikibetsuTaisho"."seinengappiYMD"  <![CDATA[>=]]> #{psmSeinengappiYMD_Start}
            </if>
            <if test="has生年月日終了">
                AND "ShikibetsuTaisho"."seinengappiYMD"  <![CDATA[<=]]> #{psmSeinengappiYMD_End}
            </if>
        </if>
        <if test="is住所">
            AND "ShikibetsuTaisho"."zenkokuJushoCode"  <![CDATA[>=]]> #{psmJusho_From}
            AND "ShikibetsuTaisho"."zenkokuJushoCode"  <![CDATA[<=]]> #{psmJusho_To}
        </if>
        <if test="is行政区">
            AND "ShikibetsuTaisho"."gyoseikuCode"  <![CDATA[>=]]> #{psmGyoseiku_From}
            AND "ShikibetsuTaisho"."gyoseikuCode"  <![CDATA[<=]]> #{psmGyoseiku_To}
        </if>
        <if test="is地区">
            AND "ShikibetsuTaisho"."chikuCode1"  <![CDATA[>=]]> #{psmChiku1_From}
            AND "ShikibetsuTaisho"."chikuCode1"  <![CDATA[<=]]> #{psmChiku1_To}
        </if>
        WHERE 1 = 1
        <if test="is直近">
            AND DbT1001."hihokenshaNo" IN ( SELECT dbT1001."hihokenshaNo"
                                            FROM(SELECT T1001.*,	
                                                    ROW_NUMBER() OVER (PARTITION BY T1001."hihokenshaNo" ORDER BY T1001."idoYMD" DESC, T1001."edaNo" DESC) AS rrkno	
                                                FROM rgdb."DbT1001HihokenshaDaicho" AS T1001
                                                WHERE	T1001."logicalDeletedFlag" = FALSE) AS dbT1001				
                                            WHERE dbT1001."rrkno" = 1)
        </if>
        <if test="is基準日">
            <if test="is資格取得日">
                AND DbT1001."shikakuShutokuYMD" <![CDATA[<=]]> #{kijunni} AND (DbT1001."shikakuSoshitsuYMD" <![CDATA[>]]> #{kijunni} OR DbT1001."shikakuSoshitsuYMD" IS NULL)
            </if>
            <if test="is資格取得届出日">
                AND DbT1001."shikakuShutokuTodokedeYMD" <![CDATA[<=]]> #{kijunni} AND (DbT1001."shikakuSoshitsuTodokedeYMD" <![CDATA[>=]]> #{kijunni} OR DbT1001."shikakuSoshitsuTodokedeYMD" IS NULL)
            </if>
        </if>
        <if test="is範囲">
            <if test="is取得日">
                AND DbT1001."shikakuShutokuYMD"  <![CDATA[>=]]> #{rangeChushutsuhiFrom}
                AND DbT1001."shikakuShutokuYMD"  <![CDATA[<=]]> #{rangeChushutsuhiTo}
            </if>
            <if test="is取得届出日">
                AND DbT1001."shikakuShutokuTodokedeYMD"  <![CDATA[>=]]> #{rangeChushutsuhiFrom}
                AND DbT1001."shikakuShutokuTodokedeYMD"  <![CDATA[<=]]> #{rangeChushutsuhiTo}
            </if>
            <if test="is喪失日">
                AND DbT1001."shikakuSoshitsuYMD"  <![CDATA[>=]]> #{rangeChushutsuhiFrom}
                AND DbT1001."shikakuSoshitsuYMD"  <![CDATA[<=]]> #{rangeChushutsuhiTo}
            </if>
            <if test="is喪失届出日">
                AND DbT1001."shikakuSoshitsuTodokedeYMD"  <![CDATA[>=]]> #{rangeChushutsuhiFrom}
                AND DbT1001."shikakuSoshitsuTodokedeYMD"  <![CDATA[<=]]> #{rangeChushutsuhiTo}
            </if>
        </if>
        AND( 1 = 1
            <if test="is1号">
                OR DbT1001."hihokennshaKubunCode" = '1'
            </if>
            <if test="is2号">
                OR DbT1001."hihokennshaKubunCode" = '2'
            </if>
            <if test="is自特例者">
                OR DbT1001."jushochiTokureiFlag" = TRUE
            </if>
            <if test="is広域住特">
                OR DbT1001."koikinaiJushochiTokureiFlag" = TRUE
            </if>
        )
        <if test="is資格取得者のみ">
                AND DbT1001."shikakuSoshitsuYMD" IS NULL
        </if>
        <if test="is資格喪失者のみ">
                AND DbT1001."shikakuSoshitsuYMD" IS NOT NULL
        </if>
        AND (
            DbT1001."shikakuShutokuJiyuCode" IN 
            <foreach  
                collection="shutokujiyu"  
                item="code"  
                open="("  
                separator=","  
                close=")">  
                 #{code} 
            </foreach>
            OR DbT1001."shikakuSoshitsuJiyuCode" IN 
            <foreach  
                collection="soshitsujiyu"  
                item="code"  
                open="("  
                separator=","  
                close=")">  
                 #{code} 
            </foreach>
        )
        <if test="isEmpty">
                AND DbT4001."hihokenshaNo" = IS NULL
        </if>
    </select>
</mapper>
