<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->


<mapper namespace="jp.co.ndensan.reams.db.dba.persistence.mapper.tashitaishotsuchisho.ITaShichosonJushochiTokureiShisetsuTaishoTsuchishoMapper">
    <select id="getTaShichosonJushochiTokureiShisetsuTaishoTsuchisho"
            resultType="jp.co.ndensan.reams.db.dba.entity.db.relate.TaShichosonJushochiTokureiShisetsuTaishoTsuchishoRelateEntity"
            parameterType="jp.co.ndensan.reams.db.dba.entity.TatokuKanrenChohyoShijiDataEntity" fetchSize="500">
        SELECT
        B."taishoYMD" AS 退所年月日,
        A."tekiyoJiyuCode" AS 他市町村住所地特例解除事由コード,
        C."jigyoshaMeisho" AS 事業者名称,
        C."telNo"  AS 電話番号,
        C."faxNo"  AS FAX番号,
        C."yubinNo" AS 郵便番号,
        C."jigyoshaJusho" AS 事業者住所
        FROM
        rgdb."DbT1003TashichosonJushochiTokurei"  AS A,
        rgdb."DbT1004ShisetsuNyutaisho"  AS B,
        rgdb."DbT1005KaigoJogaiTokureiTaishoShisetsu"  AS C

        WHERE
        A."shikibetsuCode" = #{識別コード}
        AND  A."idoYMD" = #{idoYMD}
        AND  A."edaNo" =#{edaNo}
        AND  A."logicalDeletedFlag" <![CDATA[<>]]> true
        AND  A."shikibetsuCode" = B."shikibetsuCode"
        AND  NOT(
        (A."tekiyoYMD" <![CDATA[>]]> B."nyushoYMD" AND A."tekiyoYMD" <![CDATA[>=]]> B."taishoYMD")
        AND
        (A."kaijoYMD" <![CDATA[<=]]> B."nyushoYMD" AND A."kaijoYMD" <![CDATA[<]]> B."taishoYMD")
        )
        AND  C."jigyoshaShubetsu" = B."nyushoShisetsuShurui"
        AND  C."jigyoshaNo" = B."nyushoShisetsuCode"
        AND  C."yukoKaishiYMD"<![CDATA[<=]]> B."taishoYMD" AND  B."taishoYMD"<![CDATA[<=]]> C."yukoShuryoYMD"
        LIMIT 1
    </select>
    <select id="selectTaShichosonJushochiTokureiShisetsuTaishoTsuchishoMybatis" resultType="jp.co.ndensan.reams.db.dba.entity.db.relate.TaShichosonJushochiTokureiShisetsuTaishoTsuchishoRelateEntity"
            parameterType="jp.co.ndensan.reams.db.dba.definition.mybatis.param.tashitaishotsuchisho.TaShichosonJushochiTokureiShisetsuTaishoTsuchishoMybatisParameter">
        SELECT
        A."kanaMeisho" AS カナ名称,
        A."meisho" AS 名称,
        A."seinengappiYMD" AS 生年月日,
        A."seibetsuCode" AS 性別コード,
        A."juminJotaiCode" AS 住民状態コード,
        A."tenshutsuKakuteiYubinNo" AS 転出確定郵便番号,
        A."tenshutsuYoteiYubinNo" AS 転出予定郵便番号,
        A."tenshutsuKakuteiJusho" AS 転出確定住所,
        A."tenshutsuYoteiJusho" AS 転出予定住所,
        A."yubinNo" AS 郵便番号,
        A."jusho" AS 住所
        FROM
        <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.tableName_PsmShikibetsuTaisho" />  AS A
    </select>
</mapper>
