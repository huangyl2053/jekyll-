<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBD-1410-020 chenxin -->
<!-- 概要： 要介護認定延期通知書発行一覧表出力用XMLです。 -->

<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.enkitsuchisho.IEnkiTsuchishoMapper">
    
    <select id="get延期通知書発行一覧表情報広域"
        parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.enkitsuchisho.EnkiTsuchishohakenIchiranhyoJyohoMybatisParameter"
        resultMap="ResultMap_EnkiTsuchishoHakkenichiranhyoJyohoEntity" 
        fetchSize="500" resultOrdered="true">
        SELECT
            T5101."koroshoIfShikibetsuCode" AS 厚労省IF識別コード,
            T5101."hihokenshaNo" AS 被保番号,
            T5101."hihokenshaName" AS  氏名,
            T5101."hihokenshaKana" AS  氏名カナ,
            T5101."jusho" AS 住所,
            T5101."ninteiShinseiYMD" AS 申請日,
            T5101."enkiKetteiYMD" AS 延期決定年月日, 
            T5101."enkiRiyu" AS 延期理由, 
            T5101."enkiTsuchiHakkoYMD" AS 延期通知発行年月日, 
            T5101."enkiTsuchiHakkoKaisu" AS 延期通知発行回数, 
            T5101."enkiMikomiKaishiYMD" AS 延期見込期間開始年月日, 
            T5101."enkiMikomiShuryoYMD" AS 延期見込期間終了年月日, 
            T7051."shichosonCode" AS 市町村コード,
            T7051."shichosonMeisho" AS 市町村名称
        FROM
            rgdb."DbT5101NinteiShinseiJoho" AS T5101
        LEFT JOIN   rgdb."DbT7051KoseiShichosonMaster" AS T7051
            ON  T5101."shoKisaiHokenshaNo" = T7051."shoKisaiHokenshaNo"
        WHERE
             <if test="tsuchishohakkonbi != null and !tsuchishohakkonbi.isEmpty()">
                T5101."enkiTsuchiHakkoYMD" = #{tsuchishohakkonbi}
            </if>
            <if test="tsuchishohakkonbi == null or tsuchishohakkonbi.isEmpty()">
                T5101."enkiTsuchiHakkoYMD" IS NULL
            </if>
            <if test="shorimikomibiFrom != null and !shorimikomibiFrom.isEmpty()">
                AND #{shorimikomibiFrom} <![CDATA[<=]]>  T5101."enkiKetteiYMD"
            </if>
            <if test="shorimikomibiTo != null and !shorimikomibiTo.isEmpty()" >
                AND T5101."enkiKetteiYMD" <![CDATA[<=]]> #{shorimikomibiTo}
            </if>
         ORDER BY
            T7051."shichosonCode",
            T5101."hihokenshaKana",
            T5101."ninteiShinseiYMD"    
    </select>
    
    <select id="get延期通知書発行一覧表情報" 
        parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.enkitsuchisho.EnkiTsuchishohakenIchiranhyoJyohoMybatisParameter"
        resultMap="ResultMap_EnkiTsuchishoHakkenichiranhyoJyohoEntity" 
        fetchSize="500" resultOrdered="true">
        SELECT
            T5101."koroshoIfShikibetsuCode" AS 厚労省IF識別コード,
            T5101."hihokenshaNo" AS 被保番号,
            T5101."hihokenshaName" AS 氏名,
            T5101."hihokenshaKana" AS 氏名カナ,
            T5101."jusho" AS 住所,
            T5101."ninteiShinseiYMD" AS 申請日,
            T5101."enkiKetteiYMD" AS 延期決定年月日, 
            T5101."enkiRiyu" AS 延期理由, 
            T5101."enkiTsuchiHakkoYMD" AS 延期通知発行年月日, 
            T5101."enkiTsuchiHakkoKaisu" AS 延期通知発行回数, 
            T5101."enkiMikomiKaishiYMD" AS 延期見込期間開始年月日, 
            T5101."enkiMikomiShuryoYMD" AS 延期見込期間終了年月日, 
            T7051."shichosonCode" AS 市町村コード,
            T7051."shichosonMeisho" AS 市町村名称
        FROM
            rgdb."DbT5101NinteiShinseiJoho" AS T5101
        LEFT JOIN   rgdb."DbT7051KoseiShichosonMaster" AS T7051
            ON  T5101."shoKisaiHokenshaNo" = T7051."shoKisaiHokenshaNo"
        LEFT JOIN   rgdb."DbT5105NinteiKanryoJoho" AS T5105
            ON  T5105."shinseishoKanriNo" = T5101."shinseishoKanriNo"
            
        WHERE
            <if test="tsuchishohakkonbi != null and !tsuchishohakkonbi.isEmpty()">
             T5101."enkiTsuchiHakkoYMD" = #{tsuchishohakkonbi}
            </if>
            <if test="tsuchishohakkonbi == null or tsuchishohakkonbi.isEmpty()">
                T5101."enkiTsuchiHakkoYMD" IS NULL
            </if>
            <if test="shorimikomibiFrom != null and !shorimikomibiFrom.isEmpty()">
                AND #{shorimikomibiFrom} <![CDATA[<=]]>  T5101."enkiKetteiYMD"
            </if>
            <if test="shorimikomibiTo != null and !shorimikomibiTo.isEmpty()" >
                AND T5101."enkiKetteiYMD" <![CDATA[<=]]> #{shorimikomibiTo}
            </if>
            AND not exists (
                SELECT 
                    a."shinseishoKanriNo"
                FROM 
                    rgdb."DbT5102NinteiKekkaJoho" a
                WHERE a."shinseishoKanriNo" = T5101."shinseishoKanriNo"
            )
            AND T5101."logicalDeletedFlag" = FALSE
            AND T5105."ninteiShinseiJohoTorokuKanryoYMD" IS NOT NULL
            AND T5105."ninteiShinsakaiKanryoYMD" IS NULL
        ORDER BY
            T7051."shichosonCode",
            T5101."hihokenshaKana",
            T5101."ninteiShinseiYMD"
    </select>
    
    <resultMap id="ResultMap_EnkiTsuchishoHakkenichiranhyoJyohoEntity" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.enkitsuchisho.EnkiTsuchishoEntity" autoMapping="true">
        <result property="厚労省IF識別コード" column="厚労省IF識別コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler"/>
        <result property="被保番号" column="被保番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="氏名" column="氏名" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler"/>
        <result property="氏名カナ" column="氏名カナ" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaKanaMeishoTypeHandler"/>
        <result property="住所" column="住所" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaJushoTypeHandler"/>
        <result property="申請日" column="申請日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="延期決定年月日" column="延期決定年月日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="延期理由" column="延期理由" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="延期通知発行年月日" column="延期通知発行年月日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="延期通知発行回数" column="延期通知発行回数" />
        <result property="延期見込期間開始年月日" column="延期見込期間開始年月日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="延期見込期間終了年月日" column="延期見込期間終了年月日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="市町村コード" column="市町村コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler"/>
        <result property="市町村名称" column="市町村名称" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>
    
    <select id ="selectBy申請書管理番号リスト"
            resultType="jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT5101NinteiShinseiJohoEntity"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.enkitsuchisho.EnkiTsuchishoJyohoMybatisParameter"
            fetchSize="500" resultOrdered="true">
        SELECT
            A.*
        FROM
            rgdb."DbT5101NinteiShinseiJoho" AS A
        WHERE
            A."shinseishoKanriNo" IN
            <foreach item="shinseishokanribangorisuto" index="index" collection="shinseishokanribangorisuto" open="(" separator="," close=")">
                #{shinseishokanribangorisuto}
            </foreach>  
            AND A."logicalDeletedFlag" = False
        ORDER BY
            A."hihokenshaKana",
            A."ninteiShinseiYMD"
    </select>
</mapper>