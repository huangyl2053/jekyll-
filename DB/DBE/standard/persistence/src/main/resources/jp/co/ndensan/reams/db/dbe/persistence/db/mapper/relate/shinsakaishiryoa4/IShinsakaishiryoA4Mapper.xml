<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- どのマッパーインターフェースと対応するかを指定する -->
<!-- @reamsid_L DBE-0150-020 lishengli -->

<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.shinsakaishiryoa4.IShinsakaishiryoA4Mapper">
    <select resultOrdered="true" id="get審査員一覧取得" resultType="jp.co.ndensan.reams.uz.uza.biz.AtenaMeisho"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.core.shinsakaishiryoa4.ShinsakaishiryoA4Parameter"  fetchSize="500">
        SELECT
            DbT5594ShinsakaiIinJoho."shinsakaiIinShimei" AS "shinsakaiIinShimei"
        FROM
        rgdb."DbT5594ShinsakaiIinJoho" AS DbT5594ShinsakaiIinJoho,
        (SELECT
            DbT5593."shinsakaiIinCode"
         FROM rgdb."DbT5593GogitaiWariateIinJoho" AS DbT5593
         WHERE DbT5593."gogitaiNo" = #{合議体番号}
         AND DbT5593."gogitaiYukoKikanKaishiYMD" <![CDATA[<=]]> #{介護認定審査会開催予定年月日}
         AND #{介護認定審査会開催予定年月日} <![CDATA[<=]]> DbT5593."gogitaiYukoKikanShuryoYMD" ) AS GogitaiWariateIinJoho
        WHERE
            DbT5594ShinsakaiIinJoho."shinsakaiIinCode" = GogitaiWariateIinJoho."shinsakaiIinCode"
            AND (DbT5594ShinsakaiIinJoho."haishiFlag" = false OR (DbT5594ShinsakaiIinJoho."haishiFlag" = TRUE AND #{システム日付} <![CDATA[<=]]> DbT5594ShinsakaiIinJoho."haishiYMD"))
        ORDER BY DbT5594ShinsakaiIinJoho."shinsakaiIinCode"
    </select>
    
    <resultMap id="resultMap_ShinsakaishiryoA4Entity" type="jp.co.ndensan.reams.db.dbe.entity.report.source.shinsakaishiryoa4.ShinsakaishiryoA4Entity" autoMapping="true">
        <result property="shinseishoKanriNo" column="T1_shinseishoKanriNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shinsakaiOrder" column="T1_shinsakaiOrder" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shoKisaiHokenshaNo" column="T1_shoKisaiHokenshaNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="hihokenshaNo" column="T1_hihokenshaNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="hihokenshaName" column="T1_hihokenshaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="age" column="T1_age" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="seibetsu" column="T1_seibetsu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="ichijiHanteiKekkaCode" column="T1_ichijiHanteiKekkaCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="ichijiHnateiKeikokuCode" column="T1_ichijiHnateiKeikokuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="kijunJikan" column="T1_kijunJikan" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>

    <select resultOrdered="true" id="get審査対象者一覧" resultMap="resultMap_ShinsakaishiryoA4Entity"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.core.shinsakaishiryoa4.ShinsakaishiryoA4Parameter"   fetchSize="500">
        SELECT
        T1."shinseishoKanriNo" AS "T1_shinseishoKanriNo",
        T1."shinsakaiOrder" AS "T1_shinsakaiOrder",
        T1."shoKisaiHokenshaNo" AS "T1_shoKisaiHokenshaNo",
        T1."hihokenshaNo" AS "T1_hihokenshaNo",
        T1."hihokenshaName" AS "T1_hihokenshaName",
        T1."age" AS "T1_age",
        T1."seibetsu" AS "T1_seibetsu",
        T1."ichijiHanteiKekkaCode" AS "T1_ichijiHanteiKekkaCode",
        T1."ichijiHnateiKeikokuCode" AS "T1_ichijiHnateiKeikokuCode",
        T1."kijunJikan" AS "T1_kijunJikan"
        FROM
            (SELECT
                ShinsakaiWariateJoho."shinseishoKanriNo",
                ShinsakaiWariateJoho."shinsakaiOrder",
                NinteiShinseiJoho."shoKisaiHokenshaNo",
                NinteiShinseiJoho."hihokenshaNo",
                NinteiShinseiJoho."hihokenshaName",
                NinteiShinseiJoho."age",
                NinteiShinseiJoho."seibetsu",
                NinteiShinseiJoho."ichijiHanteiKekkaCode",
                NinteiShinseiJoho."ichijiHnateiKeikokuCode",
                NinteiShinseiJoho."kijunJikan"
             FROM
                (SELECT
                DbT5502."shinseishoKanriNo",
                DbT5502."shinsakaiOrder"
                FROM rgdb."DbT5502ShinsakaiWariateJoho" AS DbT5502
                WHERE DbT5502."shinsakaiKaisaiNo" = #{介護認定審査会開催番号}
                AND DbT5502."shinsakaiOrderKakuteiFlag" = true
                ORDER BY DbT5502."shinseishoKanriNo") AS ShinsakaiWariateJoho,
                (SELECT
                DbT5101."shinseishoKanriNo",
                DbT5101."shoKisaiHokenshaNo",
                DbT5101."hihokenshaNo",
                DbT5101."hihokenshaName",
                DbT5101."age",
                DbT5101."seibetsu",
                DbT5116."ichijiHanteiKekkaCode",
                DbT5116."ichijiHnateiKeikokuCode",
                DbT5116."kijunJikan"
                FROM rgdb."DbT5101NinteiShinseiJoho" AS DbT5101,
                rgdb."DbT5116IchijiHanteiKekkaJoho" AS DbT5116
                WHERE DbT5101."shinseishoKanriNo" = DbT5116."shinseishoKanriNo"
                ORDER BY DbT5116."shinseishoKanriNo") AS NinteiShinseiJoho
             WHERE ShinsakaiWariateJoho."shinseishoKanriNo" = NinteiShinseiJoho."shinseishoKanriNo") AS T1,
            (SELECT
            MAX(DbT5302."ikenshoIraiRirekiNo") AS "ikenshoIraiRirekiNo",
            DbT5302."shinseishoKanriNo",
            DbT5302."zaitakuShisetsuKubun"
            FROM rgdb."DbT5302ShujiiIkenshoJoho" AS DbT5302
            GROUP BY DbT5302."shinseishoKanriNo", DbT5302."zaitakuShisetsuKubun") AS ShujiiIkenshoJoho
        WHERE T1."shinseishoKanriNo" = ShujiiIkenshoJoho."shinseishoKanriNo"
        ORDER BY T1."shinsakaiOrder"
    </select>
</mapper>
