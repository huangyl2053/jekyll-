<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： DbT1001HihokenshaDaichoEntityのマッピング用XMLです。 -->
<!-- @reamsid_L DBE-0080-160 duanzhanli -->
<!--SelectMethod : getHihokenshaShutokuJyoho-->
<!--ParentResultMap : resultMap_getHihokenshaShutokuJyoho-->
<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.hakkoichiranhyo.INinteiChosaIraiMapper">

    <resultMap id="resultMap_getNinteiChosaIrai" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.hakkoichiranhyo.NinteiChosaIraiRelateEntity" autoMapping="true">
        <result property="iraishoShutsuryokuYMD" column="iraishoShutsuryokuYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="ninteichosaKigenYMD" column="ninteichosaKigenYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="shichosonCode" column="shichosonCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="shichosonMeisho" column="shichosonMeisho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="hihokenshaNo" column="hihokenshaNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="hihokenshaName" column="hihokenshaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="ninteichosaIraiYMD" column="ninteichosaIraiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="ninteichosaItakusakiCode" column="ninteichosaItakusakiCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="jigyoshaMeisho" column="jigyoshaMeisho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="daihyoshaName" column="daihyoshaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="telNo" column="telNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="ninteiChosainNo" column="ninteiChosainCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="chosainShimei" column="chosainShimei" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
    </resultMap>

    <select resultOrdered="true" id="get認定調査依頼発行一覧" resultMap="resultMap_getNinteiChosaIrai"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.hakkoichiranhyo.NinteiChosaIraiMybitisParamter" fetchSize="500">
        SELECT
        dbT5201."iraishoShutsuryokuYMD",
        dbT5201."ninteichosaKigenYMD",
        dbT5101."shichosonCode",
        dbT7051."shichosonMeisho",
        dbT5101."hihokenshaNo",
        dbT5101."hihokenshaName",
        dbT5201."ninteichosaIraiYMD",
        dbT5910."ninteichosaItakusakiCode",
        dbT5910."jigyoshaMeisho",
        dbT5910."daihyoshaName",
        dbT5910."telNo",
        dbT5913."ninteiChosainCode",
        dbT5913."chosainShimei"
        FROM
        rgdb."DbT5201NinteichosaIraiJoho" AS dbT5201
        INNER JOIN
        rgdb."DbT5101NinteiShinseiJoho" AS dbT5101
        ON
        dbT5201."shinseishoKanriNo" = dbT5101."shinseishoKanriNo"
        INNER JOIN
        rgdb."DbT5105NinteiKanryoJoho" AS dbT5105
        ON
        dbT5105."shinseishoKanriNo" = dbT5101."shinseishoKanriNo"
        INNER JOIN
        rgdb."DbT7051KoseiShichosonMaster" AS dbT7051
        ON
        dbT7051."shoKisaiHokenshaNo" = dbT5101."shoKisaiHokenshaNo"
        INNER JOIN
        rgdb."DbT5910NinteichosaItakusakiJoho" AS dbT5910
        ON
        dbT5910."shichosonCode" = dbT5101."shichosonCode"
        AND dbT5910."ninteichosaItakusakiCode" = dbT5101."ninteiChosaItakusakiCode"
        INNER JOIN
        rgdb."DbT5913ChosainJoho" AS dbT5913
        ON
        dbT5913."shichosonCode" = dbT5101."shichosonCode"
        AND dbT5913."ninteiChosaItakusakiCode" = dbT5101."ninteiChosaItakusakiCode"
        AND dbT5913."ninteiChosainCode" = dbT5101."ninteiChosainCode"
        WHERE
        dbT5201."ninteichosaIraiRirekiNo" = (
        SELECT
        MAX("ninteichosaIraiRirekiNo")
        FROM
        rgdb."DbT5201NinteichosaIraiJoho"
        WHERE
        "shinseishoKanriNo" = dbT5201."shinseishoKanriNo"
        AND "logicalDeletedFlag" = false)
        AND dbT5101."shoriJotaiKubun" IN (#{通常},#{延期})
        AND dbT5101."logicalDeletedFlag" = false
        AND (dbT5105."ninteiShinseiJohoTorokuKanryoYMD" IS NOT NULL 
        AND dbT5105."ninteiShinseiJohoTorokuKanryoYMD" <![CDATA[<>]]> '') 
        AND (dbT5105."ninteiShinsakaiWariateKanryoYMD" IS NULL 
        OR dbT5105."ninteiShinsakaiWariateKanryoYMD" = '') 
        AND (dbT5105."ninteiShinsakaiKanryoYMD" IS NULL 
        OR dbT5105."ninteiShinsakaiKanryoYMD" = '') 
        AND (dbT5105."centerSoshinYMD" IS NULL 
        OR dbT5105."centerSoshinYMD" = '') 
        AND (dbt5101."ninteiShinseiShinseijiKubunCode" <![CDATA[<>]]> #{転入}
        AND dbt5101."ninteiShinseiShinseijiKubunCode" <![CDATA[<>]]> #{喪失})
        AND
        <foreach
            collection="ninteiChosaIraiList"
            item="item"
            open="("
            separator="OR"
            close=")">
            (dbT5201."ninteichosaItakusakiCode" =  #{item.ninteichosaItakusakiCode}
            AND dbT5201."ninteiChosainCode" = #{item.ninteiChosainCode}
            AND dbT5101."shoKisaiHokenshaNo" =  #{item.shoKisaiHokenshaNo} )
        </foreach>
        <if test= "is依頼日From">
            AND dbT5201."ninteichosaIraiYMD" <![CDATA[>=]]> #{iraiFromYMD}
        </if>
        <if test= "is依頼日To">
            AND dbT5201."ninteichosaIraiYMD" <![CDATA[<=]]> #{iraiToYMD}
        </if>
        <if test= "is認定調査依頼書未印刷">
            AND (dbT5201."iraishoShutsuryokuYMD" IS NULL 
            OR dbT5201."iraishoShutsuryokuYMD" = '') 
        </if>
        <if test= "is認定調査依頼書印刷済">
            AND (dbT5201."iraishoShutsuryokuYMD" IS NOT NULL 
            AND dbT5201."iraishoShutsuryokuYMD" <![CDATA[<>]]> '') 
        </if>
        <if test= " is認定調査票未印刷">
            AND (dbT5201."chosahyoTouShutsuryokuYMD" IS NULL 
            OR dbT5201."chosahyoTouShutsuryokuYMD" = '') 
        </if>
        <if test= "is認定調査票印刷済">
            AND (dbT5201."chosahyoTouShutsuryokuYMD" IS NOT NULL 
            AND dbT5201."chosahyoTouShutsuryokuYMD" <![CDATA[<>]]> '') 
        </if>
        ORDER BY
        dbT5201."iraishoShutsuryokuYMD",
        dbT5201."ninteichosaKigenYMD",
        dbT5101."shichosonCode",
        dbT5101."hihokenshaNo",
        dbT5201."ninteichosaIraiYMD",
        dbT5910."ninteichosaItakusakiCode",
        dbT5913."ninteiChosainCode"
    </select>
</mapper>