<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 認定調査データ取込（モバイル）用XMLです。 -->

<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.ninteichosadatatorikomi.INinteiChosaDataTorikomiMapper">

    <select id="select認定調査情報" resultMap="resultMap_NinteiChosaJoho"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.ninteichosadatatorikomi.NinteiChosaDataTorikomiMapperParameter"
            resultOrdered="true" fetchSize="1000">
        SELECT
            <include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5101NinteiShinseiJohoMapper.allColumns_DbT5101NinteiShinseiJoho" />,
            <include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5105NinteiKanryoJohoMapper.allColumns_DbT5105NinteiKanryoJoho" />,
            <include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5116IchijiHanteiKekkaJohoMapper.allColumns_DbT5116IchijiHanteiKekkaJoho" />,
            <include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5201NinteichosaIraiJohoMapper.allColumns_DbT5201NinteichosaIraiJoho" />
        FROM
            rgdb."DbT5101NinteiShinseiJoho"
            INNER JOIN rgdb."DbT5105NinteiKanryoJoho"
                ON "DbT5105NinteiKanryoJoho"."shinseishoKanriNo" = "DbT5101NinteiShinseiJoho"."shinseishoKanriNo"
               AND "DbT5105NinteiKanryoJoho"."ninteiShinsakaiKanryoYMD" IS NULL
            LEFT JOIN rgdb."DbT5116IchijiHanteiKekkaJoho"
                ON "DbT5116IchijiHanteiKekkaJoho"."shinseishoKanriNo" = "DbT5101NinteiShinseiJoho"."shinseishoKanriNo"
            LEFT JOIN (SELECT *
                       FROM rgdb."DbT5201NinteichosaIraiJoho" AS "mst"
                       WHERE
                            "mst"."logicalDeletedFlag" = FALSE
                         AND NOT EXISTS (SELECT 'X'
                                         FROM rgdb."DbT5201NinteichosaIraiJoho" AS "slv"
                                         WHERE "mst"."shinseishoKanriNo" = "slv"."shinseishoKanriNo"
                                               AND "mst"."logicalDeletedFlag" = "slv"."logicalDeletedFlag"
                                               AND "mst"."ninteichosaIraiRirekiNo" <![CDATA[<]]> "slv"."ninteichosaIraiRirekiNo"
                                        )
                      ) AS "DbT5201NinteichosaIraiJoho"
                ON "DbT5201NinteichosaIraiJoho"."shinseishoKanriNo" = "DbT5101NinteiShinseiJoho"."shinseishoKanriNo"
        WHERE
            "DbT5101NinteiShinseiJoho"."shoKisaiHokenshaNo" = #{証記載保険者番号}
            AND "DbT5101NinteiShinseiJoho"."hihokenshaNo" = #{被保険者番号}
            AND "DbT5101NinteiShinseiJoho"."ninteiShinseiYMD" = #{認定申請日}
            AND "DbT5101NinteiShinseiJoho"."shoriJotaiKubun" IN
                <foreach open="(" item="code" separator="," close=")" collection="有効処理状態区分">
                    #{code}
                </foreach>
            AND "DbT5101NinteiShinseiJoho"."logicalDeletedFlag" = FALSE
    </select>

    <resultMap id="resultMap_NinteiChosaJoho"
               type="jp.co.ndensan.reams.db.dbe.entity.db.relate.ninteichosadatatorikomi.NinteiChosaDataTorikomiRelateEntity" autoMapping="true">
        <id property="認定申請情報Entity.shinseishoKanriNo" column="dbT5101NinteiShinseiJoho_shinseishoKanriNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ShinseishoKanriNoTypeHandler" />
        <association property="認定申請情報Entity"
                     resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5101NinteiShinseiJohoMapper.ResultMap_DbT5101NinteiShinseiJohoEntity"/>
        <association property="認定完了情報Entity"
                     resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5105NinteiKanryoJohoMapper.ResultMap_DbT5105NinteiKanryoJohoEntity"/>
        <association property="一次判定結果情報Entity"
                     resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5116IchijiHanteiKekkaJohoMapper.ResultMap_DbT5116IchijiHanteiKekkaJohoEntity"/>
        <association property="認定調査依頼情報Entity"
                     resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5201NinteichosaIraiJohoMapper.ResultMap_DbT5201NinteichosaIraiJohoEntity"/>
    </resultMap>
</mapper>
