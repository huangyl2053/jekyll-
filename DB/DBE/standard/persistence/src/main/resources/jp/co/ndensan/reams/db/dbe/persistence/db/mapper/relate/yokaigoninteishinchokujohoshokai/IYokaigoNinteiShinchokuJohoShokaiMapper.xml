<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBE-0210-010 dongyabin -->
<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.yokaigoninteishinchokujohoshokai.IYokaigoNinteiShinchokuJohoShokaiMapper">
    <resultMap id="resultMap_HihokenshaJohoRelateEntity" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.yokaigoninteishinchokujohoshokai.HihokenshaJohoRelateEntity" autoMapping="true">
        <result property="shoKisaiHokenshaNo" column="shoKisaiHokenshaNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="hihokenshaNo" column="hihokenshaNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="hihokenshaName" column="hihokenshaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler" />
    </resultMap>
    <select resultOrdered="true" id="get被保険者情報" resultMap="resultMap_HihokenshaJohoRelateEntity"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.yokaigoninteishinchokujohoshokai.HihokenshaJohoParamter" fetchSize="500">
        SELECT
        DbT5101."shoKisaiHokenshaNo" AS shoKisaiHokenshaNo
        , DbT5101."hihokenshaNo" AS hihokenshaNo
        , DbT5101."hihokenshaName" AS hihokenshaName
        FROM
        rgdb."DbT5101NinteiShinseiJoho" AS DbT5101
        WHERE
        DbT5101."shoKisaiHokenshaNo" = #{証記載保険者番号}
        AND DbT5101."hihokenshaNo" = #{被保険者番号}
        ORDER BY
        DbT5101."ninteiShinseiYMD" DESC
        LIMIT 1
    </select>
    <resultMap id="resultMap_YokaigoNinteiShinchokuJohoShokaiRelateEntity" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.yokaigoninteishinchokujohoshokai.YokaigoNinteiShinchokuJohoShokaiRelateEntity" autoMapping="true">
        <result property="shichosonMeisho" column="shichosonMeisho" typeHandler="RStringTypeHandler" />
        <result property="hihokenshaNo" column="hihokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ShinseishoKanriNoTypeHandler" />
        <result property="hihokenshaName" column="hihokenshaName" typeHandler="RStringTypeHandler" />
        <result property="hihokenshaKubunCode" column="hihokenshaKubunCode" typeHandler="RStringTypeHandler" />
        <result property="ninteiShinShinseijiKubunCode" column="ninteiShinseiShinseijiKubunCode" typeHandler="RStringTypeHandler" />
        <result property="tokki" column="tokki" typeHandler="RStringTypeHandler" />
        <result property="yubinNo" column="yubinNo" typeHandler="RStringTypeHandler" />
        <result property="jusho" column="jusho" typeHandler="RStringTypeHandler" />
        <result property="seibetsu" column="seibetsu" typeHandler="RStringTypeHandler" />
        <result property="seinengappiYMD" column="seinengappiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="age" column="age" />
        <result property="ninteichosaIraiKanryoYMD" column="ninteichosaIraiKanryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="ninteichosaKanryoYMD" column="ninteichosaKanryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="ikenshoSakuseiIraiKanryoYMD" column="ikenshoSakuseiIraiKanryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="ikenshoTorokuKanryoYMD" column="ikenshoTorokuKanryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="ichijiHanteiKanryoYMD" column="ichijiHanteiKanryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="maskingKanryoYMD" column="maskingKanryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="ninteiShinsaWariateKanryoYMD" column="ninteiShinsakaiWariateKanryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="ninteiShinsakaiKanryoYMD" column="ninteiShinsakaiKanryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="ninteichosaIraiYMD" column="ninteichosaIraiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="ninteichosaJuryoYMD" column="ninteichosaJuryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="jigyoshaMeisho" column="jigyoshaMeisho" typeHandler="RStringTypeHandler" />
        <result property="chosainShimei" column="chosainShimei" typeHandler="RStringTypeHandler" />
        <result property="ikenshoSakuseiIraiYMD" column="ikenshoSakuseiIraiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="ikenshoJuryoYMD" column="ikenshoJuryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="iryoKikanMeisho" column="iryoKikanMeisho" typeHandler="RStringTypeHandler" />
        <result property="shujiiName" column="shujiiName" typeHandler="RStringTypeHandler" />
        <result property="ichijiHanteiYMD" column="ichijiHanteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="ichijiHanteiKekkaCode" column="ichijiHanteiKekkaCode" typeHandler="RStringTypeHandler" />
        <result property="shinsakaiKaisaiYoteiYMD" column="shinsakaiKaisaiYoteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="shinsakaiShiryoSakuseiYMD" column="shinsakaiShiryoSakuseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="shinsakaiKaisaiYMD" column="shinsakaiKaisaiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="shinsakaiKaisaiNo" column="shinsakaiKaisaiNo" typeHandler="RStringTypeHandler" />
        <result property="gogitaiNo" column="gogitaiNo" />
        <result property="gogitaiMei" column="gogitaiMei" typeHandler="RStringTypeHandler" />
        <result property="nijiHanYokaigoJotaiKubunCode" column="nijiHanteiYokaigoJotaiKubunCode" typeHandler="RStringTypeHandler" />
        <result property="shinseishoKanriNo" column="shinseishoKanriNo" typeHandler="RStringTypeHandler" />
        <result property="ninteichosaIraiRirekiNo" column="ninteichosaIraiRirekiNo" />
    </resultMap>

    <select resultOrdered="true" id="get申請者一覧内容"
            resultMap="resultMap_YokaigoNinteiShinchokuJohoShokaiRelateEntity"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.yokaigoninteishinchokujohoshokai.YokaigoNinteiParamter"
            fetchSize="100">
        <include refid="mainTable"/>
        SELECT
        <include refid="selectShinseiIchiran"/>
        FROM
        <include refid="tablesWithParameter"/>
        ORDER BY
        DbT7051."shichosonMeisho",
        DbT5101."hihokenshaNo",
        DbT5101."ninteiShinseiYMD"
        LIMIT #{maximumDisplayNumber}
    </select>

    <sql id="selectShinseiIchiran">
        <!-- SELECT -->
        DbT7051."shichosonMeisho",
        DbT5101."hihokenshaNo",
        DbT5101."hihokenshaName",
        DbT5101."hihokenshaKubunCode",
        DbT5101."ninteiShinseiYMD",
        DbT5101."ninteiShinseiShinseijiKubunCode",
        DbT5105."ninteichosaIraiKanryoYMD",
        DbT5105."ninteichosaKanryoYMD",
        DbT5101.tokki AS "tokki",
        DbT5105."ikenshoSakuseiIraiKanryoYMD",
        DbT5105."ikenshoTorokuKanryoYMD",
        DbT5105."ichijiHanteiKanryoYMD",
        DbT5105."maskingKanryoYMD",
        DbT5105."ninteiShinsakaiWariateKanryoYMD",
        DbT5105."ninteiShinsakaiKanryoYMD",
        DbT5201."ninteichosaIraiYMD",
        DbT5202."ninteichosaJuryoYMD",
        DbT5910."jigyoshaMeisho",
        DbT5913."chosainShimei",
        DbT5301."ikenshoSakuseiIraiYMD",
        DbT5302."ikenshoJuryoYMD",
        DbT5911."iryoKikanMeisho",
        DbT5912."shujiiName",
        DbT5101."ichijiHanteiYMD",
        DbT5101."ichijiHanteiKekkaCode",
        DbT5101."shinsakaiKaisaiYoteiYMD",
        DbT5101."shinsakaiShiryoSakuseiYMD",
        DbT5101."shinsakaiKaisaiYMD",
        DbT5101."shinsakaiKaisaiNo",
        DbT5101."gogitaiNo",
        DbT5101."gogitaiMei",
        DbT5101."nijiHanteiYokaigoJotaiKubunCode",
        DbT5101."yubinNo",
        DbT5101."jusho",
        DbT5101."seibetsu",
        DbT5101."seinengappiYMD",
        DbT5101."age",
        DbT5101."shinseishoKanriNo",
        DbT5201."ninteichosaIraiRirekiNo",
        COUNT(*) OVER() as "totalCount"
    </sql>

    <sql id="mainTable">
        WITH DbT5101 AS (SELECT
        DbT5101.*,
        TB.tokki AS "tokki",
        DbT5116."ichijiHanteiYMD",
        DbT5116."ichijiHanteiKekkaCode",
        DbT5501."shinsakaiKaisaiYoteiYMD",
        DbT5501."shinsakaiShiryoSakuseiYMD",
        DbT5511."shinsakaiKaisaiYMD",
        DbT5511."shinsakaiKaisaiNo",
        DbT5511."gogitaiNo",
        DbT5591."gogitaiYukoKikanKaishiYMD",
        DbT5591."gogitaiYukoKikanShuryoYMD",
        DbT5591."gogitaiMei",
        DbT5102."nijiHanteiYokaigoJotaiKubunCode"
        FROM rgdb."DbT5101NinteiShinseiJoho" AS DbT5101
        LEFT JOIN rgdb."DbT5105NinteiKanryoJoho" AS DbT5105 ON DbT5105."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        LEFT JOIN rgdb."DbT5102NinteiKekkaJoho" AS DbT5102 ON DbT5102."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        LEFT JOIN rgdb."DbT5502ShinsakaiWariateJoho" AS DbT5502 ON DbT5502."shinseishoKanriNo" = DbT5101."shinseishoKanriNo" AND (DbT5502."hanteiKekkaCode"='01' OR DbT5502."hanteiKekkaCode" IS NULL)
        LEFT JOIN rgdb."DbT5511ShinsakaiKaisaiKekkaJoho" AS DbT5511 ON DbT5511."shinsakaiKaisaiNo" = DbT5502."shinsakaiKaisaiNo"
        LEFT JOIN rgdb."DbT5591GogitaiJoho" AS DbT5591 ON DbT5511."gogitaiNo" = DbT5591."gogitaiNo"
        AND DbT5591."gogitaiYukoKikanKaishiYMD" &lt;= DbT5511."shinsakaiKaisaiYMD"
        AND DbT5511."shinsakaiKaisaiYMD" &lt;= DbT5591."gogitaiYukoKikanShuryoYMD"
        LEFT JOIN rgdb."DbT5501ShinsakaiKaisaiYoteiJoho" AS DbT5501 ON DbT5501."shinsakaiKaisaiNo" = DbT5502."shinsakaiKaisaiNo"
        LEFT JOIN rgdb."DbT5116IchijiHanteiKekkaJoho" AS DbT5116 ON DbT5116."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        LEFT JOIN (SELECT DISTINCT "shinseishoKanriNo", '●' AS  tokki from rgdb."DbT5205NinteichosahyoTokkijiko") TB ON TB."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        <where>
            DbT5101."logicalDeletedFlag" = False
            <if test="!kensakuOptionKey0 and !kensakuOptionKey1">
                AND DbT5105."centerSoshinYMD" IS NULL
            </if> 
            <if test="radKensakuHohoKey0">
                <if test="hihokenshaNoFlag">
                    AND DbT5101."hihokenshaNo" = #{hihokenshaNo}
                </if>
                <if test="shikibetsuCodeFlag">
                    AND DbT5101."shikibetsuCode" = #{shikibetsuCode}
                </if>
            </if>
            <if test="radKensakuHohoKey1">
                <if test="hizukeHaniKey0">
                    <if test="!shiteiHizukeForm.isEmpty()">
                        AND DbT5101."ninteiShinseiYMD" <![CDATA[>=]]> #{shiteiHizukeForm}
                    </if>
                    <if test="!shiteiHizukeTo.isEmpty()">
                        AND DbT5101."ninteiShinseiYMD" <![CDATA[<=]]> #{shiteiHizukeTo}
                    </if>
                </if>
                <if test="ninteiChosaTokkiKey0">
                    AND TB."shinseishoKanriNo" IS NOT NULL
                </if>
                <if test="ninteiChosaTokkiKey1">
                    AND TB."shinseishoKanriNo" IS NULL
                </if>
            </if>
            <if test="!kensakuOptionKey1">
                AND DbT5101."shoriJotaiKubun" IN (#{tuujou}, #{ennki})
                AND DbT5101."torisageKubunCode" = #{torisageKubunCode}
            </if>
        </where>
        )
    </sql>

    <sql id="tablesWithParameter">
        <!-- FROM -->
        DbT5101
        LEFT JOIN rgdb."DbT7051KoseiShichosonMaster" AS DbT7051
        ON DbT7051."shoKisaiHokenshaNo" = DbT5101."shoKisaiHokenshaNo"
        LEFT JOIN rgdb."DbT5105NinteiKanryoJoho" AS DbT5105
        ON DbT5105."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        LEFT JOIN rgdb."DbT5911ShujiiIryoKikanJoho" AS DbT5911
        ON DbT5911."shujiiIryokikanCode"=DbT5101."shujiiIryokikanCode"
        AND DbT5911."shichosonCode" = DbT5101."shichosonCode"
        LEFT JOIN rgdb."DbT5912ShujiiJoho" AS DbT5912
        ON DbT5912."shujiiIryokikanCode" = DbT5101."shujiiIryokikanCode"
        AND DbT5912."shujiiCode" = DbT5101."shujiiCode"
        AND DbT5912."shichosonCode" = DbT5101."shichosonCode"
        LEFT JOIN rgdb."DbT5910NinteichosaItakusakiJoho" AS DbT5910
        ON DbT5910."ninteichosaItakusakiCode" = DbT5101."ninteiChosaItakusakiCode"
        AND DbT5910."shichosonCode" = DbT5101."shichosonCode"
        LEFT JOIN rgdb."DbT5913ChosainJoho" AS DbT5913
        ON DbT5913."ninteiChosaItakusakiCode" = DbT5101."ninteiChosaItakusakiCode"
        AND DbT5913."ninteiChosainCode" = DbT5101."ninteiChosainCode"
        AND DbT5913."shichosonCode" = DbT5101."shichosonCode"
        LEFT JOIN rgdb."DbT5201NinteichosaIraiJoho" DbT5201 
        ON DbT5101."shinseishoKanriNo" = DbT5201."shinseishoKanriNo" 
        AND NOT EXISTS ( 
        SELECT
        'X' 
        FROM
        rgdb."DbT5201NinteichosaIraiJoho" xDbT5201 
        WHERE
        DbT5201."shinseishoKanriNo" = xDbT5201."shinseishoKanriNo" 
        AND DbT5201."ninteichosaIraiRirekiNo" <![CDATA[<]]> xDbT5201."ninteichosaIraiRirekiNo"
        ) 
        LEFT JOIN rgdb."DbT5301ShujiiIkenshoIraiJoho" DbT5301 
        ON DbT5101."shinseishoKanriNo" = DbT5301."shinseishoKanriNo" 
        AND NOT EXISTS ( 
        SELECT
        'X' 
        FROM
        rgdb."DbT5301ShujiiIkenshoIraiJoho" xDbT5301 
        WHERE
        DbT5301."shinseishoKanriNo" = xDbT5301."shinseishoKanriNo" 
        AND DbT5301."ikenshoIraiRirekiNo" <![CDATA[<]]> xDbT5301."ikenshoIraiRirekiNo"
        ) 
        LEFT JOIN rgdb."DbT5202NinteichosahyoGaikyoChosa" DbT5202 
        ON DbT5101."shinseishoKanriNo" = DbT5202."shinseishoKanriNo" 
        AND NOT EXISTS ( 
        SELECT
        'X' 
        FROM
        rgdb."DbT5202NinteichosahyoGaikyoChosa" xDbT5202 
        WHERE
        DbT5202."shinseishoKanriNo" = xDbT5202."shinseishoKanriNo" 
        AND DbT5202."ninteichosaRirekiNo" <![CDATA[<]]> xDbT5202."ninteichosaRirekiNo"
        ) 
        LEFT JOIN rgdb."DbT5302ShujiiIkenshoJoho" AS DbT5302
        ON DbT5302."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        AND DbT5302."ikenshoIraiRirekiNo" = DbT5301."ikenshoIraiRirekiNo"
        <where>
            <if test="shoKisaiHokenshaNoFlag">
                AND DbT5101."shoKisaiHokenshaNo" = #{shoKisaiHokenshaNo}
            </if>
            <if test="radKensakuHohoKey1">
                <choose>
                    <when test="hizukeHaniKey1">
                        <if test="!shiteiHizukeForm.isEmpty()">
                            AND DbT5201."ninteichosaIraiYMD" <![CDATA[>=]]> #{shiteiHizukeForm}
                        </if>
                        <if test="!shiteiHizukeTo.isEmpty()">
                            AND DbT5201."ninteichosaIraiYMD" <![CDATA[<=]]> #{shiteiHizukeTo}
                        </if>
                    </when>
                    <when test="hizukeHaniKey2">
                        <if test="!shiteiHizukeForm.isEmpty()">
                            AND DbT5301."ikenshoSakuseiIraiYMD" <![CDATA[>=]]> #{shiteiHizukeForm}
                        </if>
                        <if test="!shiteiHizukeTo.isEmpty()">
                            AND DbT5301."ikenshoSakuseiIraiYMD" <![CDATA[<=]]> #{shiteiHizukeTo}
                        </if>
                    </when>
                </choose>
                <if test="ninteiChosaIraiKey0">
                    AND DbT5105."ninteichosaIraiKanryoYMD" IS NOT NULL
                </if>
                <if test="ninteiChosaIraiKey1">
                    AND DbT5105."ninteichosaIraiKanryoYMD" IS NULL
                </if>
                <if test="ninteiChosaJisshiKey0">
                    AND DbT5105."ninteichosaKanryoYMD" IS NOT NULL
                </if>
                <if test="ninteiChosaJisshiKey1">
                    AND DbT5105."ninteichosaKanryoYMD" IS NULL
                </if>
                <if test="shujiiIkenshoKey0">
                    AND DbT5105."ikenshoSakuseiIraiKanryoYMD" IS NOT NULL
                </if>
                <if test="shujiiIkenshoKey1">
                    AND DbT5105."ikenshoSakuseiIraiKanryoYMD" IS NULL
                </if>
                <if test="shujiiIkenshoJuryoKey0">
                    AND DbT5105."ikenshoTorokuKanryoYMD" IS NOT NULL
                </if>
                <if test="shujiiIkenshoJuryoKey1">
                    AND DbT5105."ikenshoTorokuKanryoYMD" IS NULL
                </if>
                <if test="ichijiHanteiKanryoKey0">
                    AND DbT5105."ichijiHanteiKanryoYMD" IS NOT NULL
                </if>
                <if test="ichijiHanteiKanryoKey1">
                    AND DbT5105."ichijiHanteiKanryoYMD" IS NULL
                </if>
                <if test="maskingKanryoKey0">
                    AND DbT5105."maskingKanryoYMD" IS NOT NULL
                </if>
                <if test="maskingKanryoKey1">
                    AND DbT5105."maskingKanryoYMD" IS NULL
                </if>
                <if test="shinsakaiWaritsukeKey0">
                    AND DbT5105."ninteiShinsakaiWariateKanryoYMD" IS NOT NULL
                </if>
                <if test="shinsakaiWaritsukeKey1">
                    AND DbT5105."ninteiShinsakaiWariateKanryoYMD" IS NULL
                </if>
                <if test="shinsakaiJisshiKey0">
                    AND DbT5105."ninteiShinsakaiKanryoYMD" IS NOT NULL
                </if>
                <if test="shinsakaiJisshiKey1">
                    AND DbT5105."ninteiShinsakaiKanryoYMD" IS NULL
                </if>
            </if>
        </where>
    </sql>

</mapper>
