<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBE-1590-020 zhangzhiming -->
<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.kojinirainaiyoukoshin.IKojinIraiNaiyouKoshinMapper">
    <resultMap id="resultMap_ChousaIraiJouhou" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.kojinirainaiyoukoshin.KojinIraiNaiyouRelateEntity" autoMapping="true">
	<result property="認定調査依頼区分コード" column="T5201_ninteichosaIraiKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
        <result property="認定調査実施場所コード" column="T5202_chosaJisshiBashoCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
	<result property="認定調査実施年月日" column="T5202_ninteichosaJisshiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="地区コード" column="T5913_chikuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="名称" column="UZT0007_codeMeisho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="認定調査委託先コード" column="T5910_ninteichosaItakusakiCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
    	<result property="事業者名称" column="T5910_jigyoshaMeisho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="調査委託区分" column="T5910_chosaItakuKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="認定調査員コード" column="T5913_ninteiChosainCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="調査員氏名" column="T5913_chosainShimei" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="調査員資格" column="T5913_chosainShikaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="電話番号" column="T5913_telNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.TelNoTypeHandler" />
    	<result property="番号" column="T5913_faxNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.TelNoTypeHandler" />
        <result property="家庭訪問の有無" column="T5101_kateiHomonFlag" />
    </resultMap>
    
   <select resultOrdered="true" id="getChousaIraiJouhou" resultMap="resultMap_ChousaIraiJouhou" 
            parameterType="jp.co.ndensan.reams.db.dbx.definition.core.valueobject.domain.ShinseishoKanriNo" fetchSize="500">
   SELECT
        T5201."ninteichosaIraiKubunCode" AS "T5201_ninteichosaIraiKubunCode"
        , T5202."chosaJisshiBashoCode" AS "T5202_chosaJisshiBashoCode"
        , T5202."ninteichosaJisshiYMD" AS "T5202_ninteichosaJisshiYMD"
        , T5913."chikuCode" AS "T5913_chikuCode"
        , UZT0007."codeMeisho" AS "UZT0007_codeMeisho"
        , T5910."ninteichosaItakusakiCode" AS "T5910_ninteichosaItakusakiCode"
        , T5910."jigyoshaMeisho" AS "T5910_jigyoshaMeisho"
        , T5910."chosaItakuKubun" AS "T5910_chosaItakuKubun"
        , T5913."ninteiChosainCode" AS "T5913_ninteiChosainCode"
        , T5913."chosainShimei" AS "T5913_chosainShimei"
        , T5913."chosainShikaku" AS "T5913_chosainShikaku"
        , T5913."telNo" AS "T5913_telNo"
        , T5913."faxNo" AS "T5913_faxNo"
        , T5101."kateiHomonFlag" AS "T5101_kateiHomonFlag" 
   FROM
        rgdb."DbT5101NinteiShinseiJoho" AS T5101 
        INNER JOIN rgdb."DbT5201NinteichosaIraiJoho" AS T5201 
          ON T5101."shinseishoKanriNo" = T5201."shinseishoKanriNo" 
          AND T5201."logicalDeletedFlag" = FALSE 
        INNER JOIN ( 
          SELECT
            MAX(Dbt5201."ninteichosaIraiRirekiNo") AS 最大履歴番号
            , Dbt5201."shinseishoKanriNo" AS 申請書管理番号 
          FROM
            rgdb."DbT5201NinteichosaIraiJoho" AS Dbt5201 
          WHERE
            Dbt5201."logicalDeletedFlag" = FALSE 
          GROUP BY
            Dbt5201."shinseishoKanriNo"
        ) AS 履歴書最大番号 
          ON 履歴書最大番号."申請書管理番号" = T5201."shinseishoKanriNo" 
          AND 履歴書最大番号."最大履歴番号" = T5201."ninteichosaIraiRirekiNo" 
        INNER JOIN rgdb."DbT7051KoseiShichosonMaster" AS T7051 
          ON T7051."shoKisaiHokenshaNo" = T5101."shoKisaiHokenshaNo" 
        INNER JOIN rgdb."DbT5910NinteichosaItakusakiJoho" AS T5910 
          ON T5910."shichosonCode" = T7051."shichosonCode" 
          AND T5910."ninteichosaItakusakiCode" = T5201."ninteichosaItakusakiCode" 
        INNER JOIN rgdb."DbT5913ChosainJoho" AS T5913 
          ON T5913."shichosonCode" = T7051."shichosonCode" 
          AND T5913."ninteiChosaItakusakiCode" = T5201."ninteichosaItakusakiCode" 
          AND T5913."ninteiChosainCode" = T5201."ninteiChosainCode" 
        LEFT JOIN rgdb."UzT0007Code" AS UzT0007 
          ON UzT0007."schemaName" = 'rgdb' 
          AND UzT0007."subGyomuCode" = 'DBE' 
          AND UzT0007."codeShubetsu" = '5002' 
          AND UzT0007."code" = T5913."chikuCode" 
        LEFT JOIN rgdb."DbT5202NinteichosahyoGaikyoChosa" AS T5202 
          ON T5201."shinseishoKanriNo" = T5202."shinseishoKanriNo" 
          AND T5201."ninteichosaIraiRirekiNo" = T5202."ninteichosaRirekiNo" 
          AND T5202."gaikyoChosaTextImageKubun" = ( 
            SELECT
              UzT0002CustomConfig."configValue" AS イメージ区分 
            FROM
              rgdb."UzT0002CustomConfig" AS UzT0002CustomConfig 
            WHERE
              UzT0002CustomConfig."schemaName" = 'rgdb' 
              AND UzT0002CustomConfig."subGyomuCode" = 'DBE' 
              AND UzT0002CustomConfig."configName" = '概況調査テキストイメージ区分'
          ) 
      WHERE T5101."shinseishoKanriNo" = #{申請書管理番号}
   </select>
   
   <resultMap id="resultMap_SyujiIraiJouhou" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.kojinirainaiyoukoshin.KojinIraiNaiyouRelateEntity" autoMapping="true">
	<result property="申請書管理番号" column="T5301_shinseishoKanriNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ShinseishoKanriNoTypeHandler" />
        <result property="主治医意見書作成依頼履歴番号" column="T5301_ikenshoIraiRirekiNo" />
	<result property="主治医意見書依頼区分" column="T5301_ikenshoIraiKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="主治医意見書作成回数" column="T5301_ikenshoIraiKaisu" />
        <result property="医師区分コード" column="T5301_ishiKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
	<result property="主治医意見書作成依頼年月日" column="T5301_ikenshoSakuseiIraiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="主治医意見書記入年月日" column="T5302_ikenshoKinyuYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="認定情報提供希望フラグ" column="T5301_ninteiJohoTeikyoKiboFlag" />
        <result property="主治医コード" column="T5912_shujiiCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
    	<result property="主治医氏名" column="T5912_shujiiName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="主治医医療機関コード" column="T5911_shujiiIryokikanCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="医療機関名称" column="T5911_iryoKikanMeisho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="郵便番号" column="T5911_yubinNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.YubinNoTypeHandler" />
        <result property="住所" column="T5911_jusho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="電話番号" column="T5911_telNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.TelNoTypeHandler" />
    	<result property="番号" column="T5911_faxNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.TelNoTypeHandler" />
        <result property="代表者名" column="T5911_daihyoshaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
    </resultMap>
    
   <select resultOrdered="true" id="getSyujiIraiJouhou" resultMap="resultMap_SyujiIraiJouhou" 
            parameterType="jp.co.ndensan.reams.db.dbx.definition.core.valueobject.domain.ShinseishoKanriNo" fetchSize="500">
    SELECT
        T5301."shinseishoKanriNo" AS "T5301_shinseishoKanriNo"
        , T5301."ikenshoIraiRirekiNo" AS "T5301_ikenshoIraiRirekiNo"
        , T5301."ikenshoIraiKubun" AS "T5301_ikenshoIraiKubun"
        , T5301."ikenshoIraiKaisu" AS "T5301_ikenshoIraiKaisu"
        , T5301."ishiKubunCode" AS "T5301_ishiKubunCode"
        , T5301."ikenshoSakuseiIraiYMD" AS "T5301_ikenshoSakuseiIraiYMD"
        , T5302."ikenshoKinyuYMD" AS "T5302_ikenshoKinyuYMD"
        , T5301."ninteiJohoTeikyoKiboFlag" AS "T5301_ninteiJohoTeikyoKiboFlag"
        , T5912."shujiiCode" AS "T5912_shujiiCode"
        , T5912."shujiiName" AS "T5912_shujiiName"
        , T5911."shujiiIryokikanCode" AS "T5911_shujiiIryokikanCode"
        , T5911."iryoKikanMeisho" AS "T5911_iryoKikanMeisho"
        , T5911."yubinNo" AS "T5911_yubinNo"
        , T5911."jusho" AS "T5911_jusho"
        , T5911."telNo" AS "T5911_telNo"
        , T5911."faxNo" AS "T5911_faxNo"
        , T5911."daihyoshaName" AS "T5911_daihyoshaName" 
      FROM
        rgdb."DbT5101NinteiShinseiJoho" AS T5101 
        INNER JOIN rgdb."DbT5301ShujiiIkenshoIraiJoho" AS T5301 
          ON T5101."shinseishoKanriNo" = T5301."shinseishoKanriNo" 
          AND T5301."logicalDeletedFlag" = FALSE 
        INNER JOIN ( 
          SELECT
            MAX(Dbt5301."ikenshoIraiRirekiNo") AS 最大履歴番号
            , Dbt5301."shinseishoKanriNo" AS 申請書管理番号 
          FROM
            rgdb."DbT5301ShujiiIkenshoIraiJoho" AS Dbt5301 
          WHERE
            Dbt5301."logicalDeletedFlag" = FALSE 
          GROUP BY
            Dbt5301."shinseishoKanriNo"
        ) AS 履歴書最大番号 
          ON 履歴書最大番号."申請書管理番号" = T5301."shinseishoKanriNo" 
          AND 履歴書最大番号."最大履歴番号" = T5301."ikenshoIraiRirekiNo" 
        INNER JOIN rgdb."DbT5302ShujiiIkenshoJoho" AS T5302 
          ON T5301."shinseishoKanriNo" = T5302."shinseishoKanriNo" 
          AND T5301."ikenshoIraiRirekiNo" = T5302."ikenshoIraiRirekiNo" 
        INNER JOIN rgdb."DbT7051KoseiShichosonMaster" AS T7051 
          ON T7051."shoKisaiHokenshaNo" = T5101."shoKisaiHokenshaNo" 
        INNER JOIN rgdb."DbT5912ShujiiJoho" AS T5912 
          ON T5912."shichosonCode" = T7051."shichosonCode" 
          AND T5912."shujiiIryokikanCode" = T5302."shujiiIryoKikanCode" 
          AND T5912."shujiiCode" = T5302."shujiiCode" 
        INNER JOIN rgdb."DbT5911ShujiiIryoKikanJoho" AS T5911 
          ON T5911."shichosonCode" = T7051."shichosonCode" 
          AND T5911."shujiiIryokikanCode" = T5302."shujiiIryoKikanCode" 
      WHERE
        T5101."shinseishoKanriNo" = #{申請書管理番号}
   </select>
</mapper>
