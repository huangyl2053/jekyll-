<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： DbT5115Imageマスタとエンティティのマッピング用XMLです。 -->
<!-- 作者： nXXXX ○○○○ -->

<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.basic.shujiijoho.IShujiiMasterJohoMapper">
<!--    <resultMap id="resultMap_ShujiiJohoRelateEntity" type="jp.co.ndensan.reams.db.dbe.entity.basic.shujiijoho.ShujiiMasterRelateEntity" autoMapping="true">
	<id property="shichosonCode" column="DbT5912Shuji_shichosonCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler" />
        <result property="shichosonMeisho" column="DbT7051Kosei_shichosonMeisho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="shujiiName" column="DbT5912Shuji_shujiiName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoHandler" />
	<result property="shujiiKana" column="DbT5912Shuji_shujiiKana" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <id property="shujiiCode" column="DbT5912Shuji_shujiiCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <id property="shujiiIryokikanCode" column="DbT5911Shuji_shujiiIryokikanCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="iryoKikanMeisho" column="DbT5911Shuji_iryoKikanMeisho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="shinryokaName" column="DbT5912Shuji_shinryokaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="shiteiiFlag" column="DbT5912Shuji_shiteiiFlag" />
        <result property="jokyoFlag" column="DbT5912Shuji_jokyoFlag" />
	<result property="yubinNo" column="DbT5912Shuji_yubinNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.YubinNoTypeHandler" />
	<result property="jusho" column="DbT5912Shuji_jusho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
	<result property="telNo" column="DbT5912Shuji_telNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.TelNoTypeHandler" />
	<result property="faxNo" column="DbT5912Shuji_faxNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.TelNoTypeHandler" />
	<result property="seibetsu" column="DbT5912Shuji_seibetsu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
   </resultMap>
    
    <select id="selectShujiiIchiranList"
            resultMap="resultMap_ShujiiJohoRelateEntity" 
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatis.param.shujiijoho.ShujiiMasterMapperParameter" fetchSize="500">
        SELECT
	    DbT5912Shuji."shichosonCode" AS "DbT5912Shuji_shichosonCode",
	    DbT5912Shuji."shichosonCode" AS "DbT5912Shuji_shichosonCode",
	    DbT7051Kosei."shichosonMeisho" AS "DbT7051Kosei_shichosonMeisho",
	    DbT5912Shuji."shujiiName" AS "DbT5912Shuji_shujiiName",
	    DbT5912Shuji."shujiiKana" AS "DbT5912Shuji_shujiiKana",
	    DbT5912Shuji."shujiiCode" AS "DbT5912Shuji_shujiiCode",
	    DbT5911Shuji."shujiiIryokikanCode" AS "DbT5911Shuji_shujiiIryokikanCode",	    
	    DbT5911Shuji."iryoKikanMeisho" AS "DbT5911Shuji_iryoKikanMeisho",
	    DbT5912Shuji."shinryokaName" AS "DbT5912Shuji_shinryokaName",
	    DbT5912Shuji."shiteiiFlag" AS "DbT5912Shuji_shiteiiFlag",
	    DbT5912Shuji."jokyoFlag" AS "DbT5912Shuji_jokyoFlag",
	    DbT5912Shuji."yubinNo" AS "DbT5912Shuji_yubinNo",
	    DbT5912Shuji.jusho AS DbT5912Shuji_jusho,
	    DbT5912Shuji."telNo" AS "DbT5912Shuji_telNo",
	    DbT5912Shuji."faxNo" AS "DbT5912Shuji_faxNo",
	    DbT5912Shuji.seibetsu AS DbT5912Shuji_seibetsu
	FROM
	    rgdb."DbT5912ShujiiJoho" AS DbT5912Shuji
	INNER JOIN 
	    rgdb."DbT7051KoseiShichosonMaster" AS DbT7051Kosei
	ON 
	    DbT5912Shuji."shichosonCode" = DbT5912Shuji."shichosonCode"
	INNER JOIN 
	    rgdb."DbT5911ShujiiIryoKikanJoho" AS DbT5911Shuji
	ON 
	    DbT5911Shuji."shichosonCode" = DbT5912Shuji."shichosonCode"
	AND 
	    DbT5911Shuji."shujiiIryokikanCode" = DbT5912Shuji."shujiiIryokikanCode"
    <where>
	    1 =1
	<if test="uses市町村コード">
	    AND
	    DbT5912Shuji."shichosonCode" = #{市町村コード}
	</if>
	<if test="状況フラグ">
	    AND
	    DbT5912Shuji."jokyoFlag" = true
	</if>
	<if test="!状況フラグ">
	    AND
	    DbT5912Shuji."jokyoFlag" = false
	</if>
	<if test="uses主治医医療機関コードFrom">
	    AND
	    DbT5912Shuji."shujiiIryokikanCode" <![CDATA[>=]]> #{主治医医療機関コードFrom}
	</if>
	<if test="uses主治医医療機関コードTo">
	    AND
	    DbT5912Shuji."shujiiIryokikanCode" <![CDATA[<=]]> #{主治医医療機関コードTo}
	</if>
	<if test="uses主治医医療機関名称">
	    AND
	    DbT5911Shuji."iryoKikanMeisho"  LIKE '%' || #{主治医医療機関名称} || '%'
	</if>
	<if test="uses主治医医療機関カナ名称">
	    AND
	   DbT5911Shuji."iryoKikanMeishoKana"  LIKE '%' || #{主治医医療機関カナ名称} || '%'
	</if>
	
	<if test="uses主治医コードFrom">
	    AND
	    DbT5912Shuji."shujiiCode" <![CDATA[>=]]> #{主治医コードFrom}
	</if>
	<if test="uses主治医コードTo">
	    AND
	    DbT5912Shuji."shujiiCode" <![CDATA[<=]]> #{主治医コードTo}
	</if>
	<if test="uses主治医氏名">
	    AND
	    DbT5912Shuji."shujiiName"  LIKE '%' || #{主治医氏名} || '%'
	</if>
	<if test="uses主治医カナ氏名">
	    AND
	    DbT5912Shuji."shujiiKana"  LIKE '%' || #{主治医カナ氏名} || '%'
	</if>
    </where>
    ORDER BY
	DbT5912Shuji."shichosonCode",
	DbT5912Shuji."shujiiIryokikanCode",	
	DbT5912Shuji."shujiiCode";
    </select>
    主治医情報の重複チェック
    <select id="selectShujiiJohoCount"
            resultMap="int"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatis.param.shujiijoho.ShujiiMasterMapperParameter" fetchSize="500">
       SELECT														
	    COUNT(0)													
	FROM 														
	    rgdb."DbT5912ShujiiJoho" AS DbT5912
	WHERE 														
	    DbT5912."shichosonCode" = #{市町村コード}
	AND 
	    DbT5912."shujiiIryokikanCode" = #{主治医医療機関コード}
	AND 
	    DbT5912."shujiiCode" = #{主治医コード}
    </select>	
    
    主治医情報の削除処理
   <select id="selectNinteiShinseiJohoCount"
            resultMap="int"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatis.param.shujiijoho.ShujiiMasterMapperParameter">
	SELECT															
	    COUNT(0)														
	FROM 															
	    rgdb."DbT5101NinteiShinseiJoho" AS DbT5101Nintei
       INNER JOIN
	    rgdb."DbT7051KoseiShichosonMaster" AS DbT7051Kosei
       ON 
	    DbT7051Kosei."shoKisaiHokenshaNo" = DbT5101Nintei."shoKisaiHokenshaNo"
	WHERE
	    DbT7051Kosei."shichosonCode" = #{市町村コード}
	AND
	    DbT5101Nintei."shujiiIryokikanCode" = #{主治医医療機関コード}
	AND
	    DbT5101Nintei."shujiiCode" = #{主治医コード}  
    </select>
    
    <select id="selectIkenshoIraiJohoCount"
            resultMap="int"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatis.param.shujiijoho.ShujiiMasterMapperParameter">
	SELECT
	    COUNT(0)
	FROM 													
	    rgdb."DbT5301ShujiiIkenshoIraiJoho"	AS DbT5301Shuji						
	INNER JOIN 
	    rgdb."DbT5101NinteiShinseiJoho" AS DbT5101Nintei 						
	ON 
	    DbT5301Shuji."shinseishoKanriNo" = DbT5101Nintei."shinseishoKanriNo"	
	INNER JOIN 
	    rgdb."DbT7051KoseiShichosonMaster" AS DbT7051Kosei						
	ON 
	    DbT7051Kosei."shoKisaiHokenshaNo" = DbT5101Nintei."shoKisaiHokenshaNo"	
	WHERE 														
	    DbT7051Kosei."shichosonCode" = #{市町村コード}							
	AND 
	    DbT5301Shuji."shujiiIryokikanCode" = #{主治医医療機関コード}				
	AND 
	    DbT5301Shuji."shujiiCode" = #{主治医コード}			
    </select>
    
    <select id="selectShujiiJohoList"  
        parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatis.param.shujiijoho.ShujiiMasterMapperParameter" 
        resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5912ShujiiJohoMapper.ResultMap_DbT5912ShujiiJohoEntity"  fetchSize="500" >
        SELECT
        DbT5912ShujiiJoho.*
        FROM
        (<include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5912ShujiiJohoMapper.noDeleted_DbT5912ShujiiJoho" />) AS DbT5912ShujiiJoho
        INNER JOIN
        (<include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT7051KoseiShichosonMasterMapper.noDeleted_DbT7051KoseiShichosonMaster" />) AS DbT7051KoseiShichosonMaster
        ON
        DbT5912ShujiiJoho."dbT5912ShujiiJoho_shichosonCode"  =  DbT7051KoseiShichosonMaster."dbT7051KoseiShichosonMaster_shichosonCode" 
        INNER JOIN
        (<include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5911ShujiiIryoKikanJohoMapper.noDeleted_DbT5911ShujiiIryoKikanJoho" />) AS DbT5911ShujiiIryoKikanJoho
        ON
        DbT5912ShujiiJoho."dbT5912ShujiiJoho_shichosonCode" = DbT5911ShujiiIryoKikanJoho."dbT5911ShujiiIryoKikanJoho_shichosonCode" 
        AND DbT5912ShujiiJoho."dbT5912ShujiiJoho_shujiiIryokikanCode" = DbT5911ShujiiIryoKikanJoho."dbT5911ShujiiIryoKikanJoho_shujiiIryokikanCode" 
    <where>
	    <if test="uses市町村コード">
	    AND
	    DbT5912Shuji."shichosonCode" = #{市町村コード}
	</if>
	<if test="状況フラグ">
	    AND
	    DbT5912Shuji."jokyoFlag" = true
	</if>
	<if test="!状況フラグ">
	    AND
	    DbT5912Shuji."jokyoFlag" = false
	</if>
	<if test="uses主治医医療機関コードFrom">
	    AND
	    DbT5912Shuji."shujiiIryokikanCode" <![CDATA[>=]]> #{主治医医療機関コードFrom}
	</if>
	<if test="uses主治医医療機関コードTo">
	    AND
	    DbT5912Shuji."shujiiIryokikanCode" <![CDATA[<=]]> #{主治医医療機関コードTo}
	</if>
	<if test="uses主治医医療機関名称">
	    AND
	    DbT5911Shuji."iryoKikanMeisho"  LIKE '%' || #{主治医医療機関名称} || '%'
	</if>
	<if test="uses主治医医療機関カナ名称">
	    AND
	   DbT5911Shuji."iryoKikanMeishoKana"  LIKE '%' || #{主治医医療機関カナ名称} || '%'
	</if>
	
	<if test="uses主治医コードFrom">
	    AND
	    DbT5912Shuji."shujiiCode" <![CDATA[>=]]> #{主治医コードFrom}
	</if>
	<if test="uses主治医コードTo">
	    AND
	    DbT5912Shuji."shujiiCode" <![CDATA[<=]]> #{主治医コードTo}
	</if>
	<if test="uses主治医氏名">
	    AND
	    DbT5912Shuji."shujiiName"  LIKE '%' || #{主治医氏名} || '%'
	</if>
	<if test="uses主治医カナ氏名">
	    AND
	    DbT5912Shuji."shujiiKana"  LIKE '%' || #{主治医カナ氏名} || '%'
	</if>
    </where>
    ORDER BY
	DbT5912Shuji."shichosonCode",
	DbT5912Shuji."shujiiIryokikanCode",	
	DbT5912Shuji."shujiiCode";
    </select>
    
    <select id="selectShujiiIryoKikanJoho"  
              resultType="jp.co.ndensan.reams.uz.uza.lang.RString"
              parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatis.param.ninteichosainmaster.NinteiChosainMasterSearchParameter">
      SELECT
          "DbT5911ShujiiIryoKikanJoho"."iryoKikanMeisho"
       FROM
         rgdb."DbT5911ShujiiIryoKikanJoho"
      WHERE
         "DbT5911ShujiiIryoKikanJoho"."isDeleted" = FALSE
       AND  "DbT5911ShujiiIryoKikanJoho"."shichosonCode" = #{市町村コード}
       AND  "DbT5911ShujiiIryoKikanJoho"."shujiiIryokikanCode" = #{主治医医療機関コード}
     </select>-->
</mapper>
