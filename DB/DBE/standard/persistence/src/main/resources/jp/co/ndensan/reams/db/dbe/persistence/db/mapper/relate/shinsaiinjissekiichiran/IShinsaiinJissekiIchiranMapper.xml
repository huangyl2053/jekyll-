<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBE-1700-010 wanghuafeng -->
<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.shinsaiinjissekiichiran.IShinsaiinJissekiIchiranMapper">
    <select id="get介護認定審査会委員報酬集計表"
            resultType="jp.co.ndensan.reams.db.dbe.entity.db.relate.shinsaiinjissekiichiran.ShinsaiinJissekiIchiranRelateEntity"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.shinsaiinjissekiichiran.ShinsaiinJissekiIchiranMybitisParamter" fetchSize="500"  resultOrdered="true">
        SELECT
        T5503."shinsakaiIinCode" AS コード
        , T5594."shinsakaiIinShimei" AS 氏名
        , T5503."kaigoninteiShinsakaiGichoKubunCode" AS 議長区分コード
        , T5594."shinsakaiIinShikakuCode" AS 審査員資格コード
        , T5503."shussekiFlag" AS 出欠
        , T5911."iryokikanCode" AS 医療機関コード
        , T5911."iryoKikanMeisho" AS 医療機関名称
        , T5910."ninteichosaItakusakiCode" AS 調査委託先コード
        , T5910."jigyoshaMeisho" AS 調査委託先名称
        , T5914."sonotaKikanCode" AS その他機関コード
        , T5914."kikanMeisho" AS その他機関名称
        , CAST(UzT0007.code AS TEXT) AS 審査会地区コード
        , UzT0007."codeMeisho"  AS 審査会地区
        , T5511."shinsakaiKaisaiNo" AS 審査会番号
        , T5511."shinsakaiKaisaiYMD" AS 実施日
        , T5511."shinsakaiKaishiTime" AS 開始
        , T5511."shinsakaiShuryoTime" AS 終了
        , CAST(T5033A.tanka AS TEXT) AS 単価_委員
        , CAST(T5033B.tanka AS TEXT) AS 単価_医師
        <include refid="core" />
        GROUP BY T5503."shinsakaiIinCode"
        , T5594."shinsakaiIinShimei"
        , T5503."kaigoninteiShinsakaiGichoKubunCode"
        , T5594."shinsakaiIinShikakuCode"
        , T5503."shussekiFlag"
        , T5911."iryokikanCode"
        , T5911."iryoKikanMeisho"
        , T5910."ninteichosaItakusakiCode"
        , T5910."jigyoshaMeisho"
        , T5914."sonotaKikanCode"
        , T5914."kikanMeisho"
        , CAST(UzT0007.code AS TEXT)
        , UzT0007."codeMeisho"
        , T5511."shinsakaiKaisaiNo"
        , T5511."shinsakaiKaisaiYMD"
        , T5511."shinsakaiKaishiTime"
        , T5511."shinsakaiShuryoTime"
        , CAST(T5033A.tanka AS TEXT)
        , CAST(T5033B.tanka AS TEXT)
        ORDER BY T5503."shinsakaiIinCode", T5511."shinsakaiKaisaiNo"
        <if test="件数Flag">
            LIMIT #{件数}
        </if>
    </select>
    
    <select id="getTotalCount"
            resultType="int"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.shinsaiinjissekiichiran.ShinsaiinJissekiIchiranMybitisParamter" fetchSize="500"  resultOrdered="true" >
        SELECT
        COUNT(*)
        <include refid="core" />
    </select>
    <sql id="core">
        FROM
        rgdb."DbT5503ShinsakaiWariateIinJoho" AS T5503
        INNER JOIN rgdb."DbT5594ShinsakaiIinJoho" AS T5594 
        ON T5503."shinsakaiIinCode" = T5594."shinsakaiIinCode"
        INNER JOIN rgdb."DbT5511ShinsakaiKaisaiKekkaJoho" AS T5511
        ON T5503."shinsakaiKaisaiNo" = T5511."shinsakaiKaisaiNo"
        INNER JOIN rgdb."DbT5595KaigoNinteiShinsakaiIinShozokuKikanJoho" AS T5595 
        ON T5594."shinsakaiIinCode" = T5595."shinsakaiIinCode" 
        AND T5595."remban" = 1 
        INNER JOIN rgdb."DbT5592ShinsakaiKaisaiBashoJoho" AS T5592 
        ON T5592."shinsakaiKaisaiBashoCode" = T5511."shinsakaiKaisaiBashoCode"
        LEFT JOIN rgdb."UzT0007Code" AS UzT0007 
        ON UzT0007."schemaName" = 'rgdb' 
        AND UzT0007."subGyomuCode" = 'DBE' 
        AND UzT0007."codeShubetsu" = '5001' 
        AND UzT0007."code" = T5592."shinsakaiKaisaiChikuCode" 
        AND ((UzT0007."yukoKaishiYMD" <![CDATA[<=]]> T5511."shinsakaiKaisaiYMD" AND T5511."shinsakaiKaisaiYMD" <![CDATA[<=]]> UzT0007."yukoShuryoYMD" )
        OR (UzT0007."yukoKaishiYMD" <![CDATA[<=]]> T5511."shinsakaiKaisaiYMD" AND UzT0007."yukoShuryoYMD" IS NULL))
        INNER JOIN rgdb."DbT7051KoseiShichosonMaster" AS T7051 
        ON T7051."shoKisaiHokenshaNo" = T5595."shoKisaiHokenshaNo" 
        LEFT JOIN rgdb."DbT5911ShujiiIryoKikanJoho" AS T5911 
        ON T5911."shichosonCode" = T7051."shichosonCode" 
        AND T5911."shujiiIryokikanCode" = T5595."shujiiIryokikanCode"
        LEFT JOIN rgdb."DbT5910NinteichosaItakusakiJoho" AS T5910 
        ON T5910."shichosonCode" = T7051."shichosonCode" 
        AND T5910."ninteichosaItakusakiCode" = T5595."ninteichosaItakusakiCode" 
        LEFT JOIN rgdb."DbT5914SonotaKikanJoho" AS T5914 
        ON T5914."shoKisaiHokenshaNo" = T5595."shoKisaiHokenshaNo" 
        AND T5914."sonotaKikanCode" = T5595."sonotaKikanCode" 
        LEFT JOIN rgdb."DbT5033ShinsakaiIinHoshuTanka" AS T5033A
        ON
        ( CASE T5503."kaigoninteiShinsakaiGichoKubunCode"
        WHEN '1' THEN T5033A."kaigoNinteiShinsaIinShubetsu" = '11'
        ELSE T5033A."kaigoNinteiShinsaIinShubetsu" = '12'
        END )
        AND T5033A."kaishiYM" <![CDATA[<=]]> SUBSTRING(T5511."shinsakaiKaisaiYMD", 1, 6)
        AND SUBSTRING(T5511."shinsakaiKaisaiYMD", 1, 6) <![CDATA[<=]]> T5033A."shuryoYM"
        LEFT JOIN rgdb."DbT5033ShinsakaiIinHoshuTanka" AS T5033B
        ON
        ( CASE T5503."kaigoninteiShinsakaiGichoKubunCode"
        WHEN '01' THEN T5033B."kaigoNinteiShinsaIinShubetsu" = '21'
        WHEN '02' THEN T5033B."kaigoNinteiShinsaIinShubetsu" = '21'
        ELSE T5033B."kaigoNinteiShinsaIinShubetsu" = '22'
        END )
        AND T5033B."kaishiYM" <![CDATA[<=]]> SUBSTRING(T5511."shinsakaiKaisaiYMD", 1, 6)
        AND SUBSTRING(T5511."shinsakaiKaisaiYMD", 1, 6) <![CDATA[<=]]> T5033B."shuryoYM" 
        WHERE
        1 = 1  
        <if test="審査会開催日FROMFlag">
            AND #{審査会開催日FROM} <![CDATA[<=]]> T5511."shinsakaiKaisaiYMD" 
        </if>
        <if test="審査会開催日TOFlag">
            AND T5511."shinsakaiKaisaiYMD" <![CDATA[<=]]> #{審査会開催日TO}
        </if>
        <if test="batchFlag">
            AND
            <foreach collection="keyJoho" item="item" open="("  
                     separator="OR"  
                     close=")">
                (
                T5503."shinsakaiIinCode" = #{item.shinsakaiIinCode}
                AND T5511."shinsakaiKaisaiNo" = #{item.shinsakaiKaisaiNo}
                AND T5511."shinsakaiKaisaiYMD" = #{item.shinsakaiKaisaiYMD}
                )
            </foreach>
        </if>        
    </sql>                
</mapper>