<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 判定結果情報出力（保険者）のマッピング用XMLです。 -->
<!-- @reamsid_L DBE-0190-010 lizhuoxuan -->

<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.hanteikekkajouhoushuturyoku.IHanteiKekkaJouhouShuturyokuMapper">
    <resultMap id="resultMap_HanteiKekkaJouhouShuturyokuRelateEntity" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.hanteikekkajouhoushuturyoku.HanteiKekkaJouhouShuturyokuRelateEntity" autoMapping="true">
        <result property="shinseishoKanriNo" column="DbT5101_shinseishoKanriNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="hihokenshaNo" column="DbT5101_hihokenshaNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="hihokenshaName" column="DbT5101_hihokenshaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="hihokenshaKana" column="DbT5101_hihokenshaKana" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="seibetsu" column="DbT5101_seibetsu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="seinengappiYMD" column="DbT5101_seinengappiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="ninteiShinseiYMD" column="DbT5101_ninteiShinseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="ninteiShinseiShinseijiKubunCode" column="DbT5101_ninteiShinseiShinseijiKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="nijiHanteiYokaigoJotaiKubunCode" column="DbT5102_nijiHanteiYokaigoJotaiKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="shinsakaiKaisaiNo" column="DbT5501_shinsakaiKaisaiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="shinsakaiKaisaiYoteiYMD" column="DbT5501_shinsakaiKaisaiYoteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="shinsakaiKaisaiYMD" column="DbT5511_shinsakaiKaisaiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="shinsakaiKekkaJohoChushutsuYMD" column="DbT7211_shinsakaiKekkaJohoChushutsuYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
    </resultMap>
    <select id="getNinteiChousaSukeList"
                resultMap="resultMap_HanteiKekkaJouhouShuturyokuRelateEntity" 
                parameterType="jp.co.ndensan.reams.db.dbe.definition.core.hanteikekkajouhoushuturyoku.HanteiKekkaJouhouShuturyokuParameter" fetchSize="500">
        SELECT 
        DbT5101."shinseishoKanriNo" as "DbT5101_shinseishoKanriNo"
        ,DbT5101."hihokenshaNo" as "DbT5101_hihokenshaNo"
        ,DbT5101."hihokenshaName" as "DbT5101_hihokenshaName"
        ,DbT5101."hihokenshaKana" as "DbT5101_hihokenshaKana"
        ,DbT5101."seibetsu" as "DbT5101_seibetsu"
        ,DbT5101."seinengappiYMD" as "DbT5101_seinengappiYMD"
        ,DbT5101."ninteiShinseiYMD" as "DbT5101_ninteiShinseiYMD"
        ,DbT5101."ninteiShinseiShinseijiKubunCode" as "DbT5101_ninteiShinseiShinseijiKubunCode"
        ,DbT5102."nijiHanteiYokaigoJotaiKubunCode" as "DbT5102_nijiHanteiYokaigoJotaiKubunCode"
        ,DbT5501."shinsakaiKaisaiNo" as "DbT5501_shinsakaiKaisaiNo"
        ,DbT5501."shinsakaiKaisaiYoteiYMD" as "DbT5501_shinsakaiKaisaiYoteiYMD"
        ,DbT5511."shinsakaiKaisaiYMD" as "DbT5511_shinsakaiKaisaiYMD"
        ,DbT7211."shinsakaiKekkaJohoChushutsuYMD" as "DbT7211_shinsakaiKekkaJohoChushutsuYMD"
        FROM
        rgdb."DbT5101NinteiShinseiJoho" as DbT5101
        INNER JOIN 
        rgdb."DbT5502ShinsakaiWariateJoho" as DbT5502
        ON DbT5502."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        AND 
        DbT5502."hanteiKekkaCode" = '01'
        INNER JOIN 
        rgdb."DbT5511ShinsakaiKaisaiKekkaJoho" as DbT5511
        ON DbT5511."shinsakaiKaisaiNo" = DbT5502."shinsakaiKaisaiNo"
        INNER JOIN 
        rgdb."DbT5501ShinsakaiKaisaiYoteiJoho" as DbT5501
        ON DbT5501."shinsakaiKaisaiNo" = DbT5502."shinsakaiKaisaiNo"
        INNER JOIN 
        rgdb."DbT7211GaibuRenkeiDataoutputJoho" as DbT7211
        ON DbT7211."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        INNER JOIN 
        rgdb."DbT5102NinteiKekkaJoho" as DbT5102
        ON DbT5102."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        INNER JOIN 
        rgdb."DbT5105NinteiKanryoJoho" as DbT5105
        ON DbT5105."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        AND 
        DbT5105."ninteiShinseiJohoTorokuKanryoYMD" IS NOT NULL
        AND 
        DbT5105."ninteichosaIraiKanryoYMD" IS NOT NULL
        AND 
        DbT5105."ninteichosaKanryoYMD" IS NOT NULL
        AND 
        DbT5105."ikenshoSakuseiIraiKanryoYMD" IS NOT NULL
        AND 
        DbT5105."ikenshoTorokuKanryoYMD" IS NOT NULL
        AND 
        DbT5105."ichijiHanteiKanryoYMD" IS NOT NULL
        AND 
        DbT5105."ninteiShinsakaiWariateKanryoYMD" IS NOT NULL
        AND 
        DbT5105."ninteiShinsakaiKanryoYMD" IS NOT NULL
        WHERE
        DbT5101."shoriJotaiKubun"  IN (#{通常},#{延期})
        AND
        DbT5101."logicalDeletedFlag" = False
        <if test="二次判定日Fromフラグ">
            AND
            DbT5102."nijiHanteiYMD" <![CDATA[>=]]> #{二次判定日From}
        </if>
        <if test="二次判定日Toフラグ">
            AND 
            DbT5102."nijiHanteiYMD" <![CDATA[<=]]> #{二次判定日To} 
        </if>
        <if test="未出力のみフラグ">
            AND
            DbT7211."shinsakaiKekkaJohoChushutsuYMD" IS NULL 
        </if>
        <if test="被保険者番号フラグ">
            AND 
            DbT5101."hihokenshaNo" = #{被保険者番号} 
        </if>
        <if test="保険者フラグ">
            AND 
            DbT5101."shoKisaiHokenshaNo" = #{保険者} 
        </if>
        <if test="支所フラグ">
            AND 
            DbT5101."shishoCode" = #{支所} 
        </if>
        <if test="被保険者氏名フラグ">
            <if test="前方一致フラグ">
            AND 
            (DbT5101."hihokenshaName" LIKE #{被保険者氏名} || '%'
            OR
            DbT5101."hihokenshaKana" LIKE #{被保険者氏名} || '%')
            </if>
            <if test="完全一致フラグ">
            AND 
            (DbT5101."hihokenshaName" = #{被保険者氏名}
            OR
            DbT5101."hihokenshaKana" = #{被保険者氏名})
            </if>
            <if test="部分一致フラグ">
            AND 
            (DbT5101."hihokenshaName" LIKE '%' || #{被保険者氏名} || '%'
            OR
            DbT5101."hihokenshaKana" LIKE '%' || #{被保険者氏名} || '%')
            </if>
            <if test="後方一致フラグ">
            AND 
            (DbT5101."hihokenshaName" LIKE '%' || #{被保険者氏名}
            OR
            DbT5101."hihokenshaKana" LIKE '%' || #{被保険者氏名})
            </if>
        </if>
        <if test="見做申請フラグ">
            AND 
            DbT5101."minashiNigoEtcTaishoFlag" = TRUE
        </if>
        <if test="認定申請日Fromフラグ">
            AND
            DbT5101."ninteiShinseiYMD" <![CDATA[>=]]> #{認定申請日From}
        </if>
        <if test="認定申請日Toフラグ">
            AND 
            DbT5101."ninteiShinseiYMD" <![CDATA[<=]]> #{認定申請日To} 
        </if>
        <if test="生年月日Fromフラグ">
            AND
            DbT5101."seinengappiYMD" <![CDATA[>=]]> #{生年月日From}
        </if>
        <if test="生年月日Toフラグ">
            AND 
            DbT5101."seinengappiYMD" <![CDATA[<=]]> #{生年月日To} 
        </if>
        <if test="申請区分_申請時フラグ">
            AND 
            DbT5101."ninteiShinseiShinseijiKubunCode" = #{申請区分_申請時} 
        </if>
        
        <if test="性別区分フラグ">
            AND 
            DbT5101."seibetsu" IN
        <foreach
             collection="kaisaiNoList"
             item="item"
             open="("
             separator=","
             close=")">
             #{item}
        </foreach>
         </if>
        ORDER BY
        DbT5101."ninteiShinseiYMD"
        <if test="usesSaidaiHyojiKensu">
            LIMIT #{saidaiHyojiKensu}
        </if>
    </select>
</mapper>
