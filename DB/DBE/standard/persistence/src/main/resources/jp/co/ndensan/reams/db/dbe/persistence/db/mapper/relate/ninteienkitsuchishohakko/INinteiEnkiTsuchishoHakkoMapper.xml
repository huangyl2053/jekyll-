<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBD-1410-010 wangjie2 -->


<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.ninteienkitsuchishohakko.INinteiEnkiTsuchishoHakkoMapper">

    <resultMap id="resultMap_発行対象者一覧情報" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.ninteienkitsuchishohakko.NinteiEnkiTsuchishoHakkoEntity" autoMapping="true">
        <result property="申請書管理番号" column="申請書管理番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="被保番号" column="被保番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="認定申請年月日" column="認定申請年月日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="申請区分_申請時_コード" column="申請区分_申請時_コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
        <result property="氏名" column="氏名" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="氏名カナ" column="氏名カナ" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="延期決定日" column="延期決定日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="延期理由" column="延期理由" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <result property="通知書発行日" column="通知書発行日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="延期回数" column="延期回数" />
        <result property="延期見込み期間開始日" column="延期見込み期間開始日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="延期見込み期間終了日" column="延期見込み期間終了日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="調査実施日" column="調査実施日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="意見書受領日" column="意見書受領日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="一次判定日" column="一次判定日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="審査会予定日" column="審査会予定日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler" />
        <result property="保険者名" column="保険者名" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
    </resultMap>
    <select resultOrdered="true" id="get発行対象者一覧情報_広域"
            resultMap = "resultMap_発行対象者一覧情報"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.ninteienkitsuchishohakko.NinteiEnkiTsuchishoHakkoParameter"
            fetchSize="500">
        SELECT 
            T5101."shinseishoKanriNo" AS 申請書管理番号,
            T5101."hihokenshaNo" AS 被保番号,
            T5101."ninteiShinseiYMD" AS 認定申請年月日,
            T5101."ninteiShinseiShinseijiKubunCode" AS 申請区分_申請時_コード,
            T5101."hihokenshaName" AS 氏名,
            T5101."hihokenshaKana" AS 氏名カナ,
            T5101."enkiKetteiYMD" AS 延期決定日,
            T5101."enkiRiyu" AS 延期理由,
            T5101."enkiTsuchiHakkoYMD" AS 通知書発行日,
            T5101."enkiTsuchiHakkoKaisu" AS 延期回数,
            T5101."enkiMikomiKaishiYMD" AS 延期見込み期間開始日,
            T5101."enkiMikomiShuryoYMD" AS 延期見込み期間終了日,
            
            T5202."ninteichosaJisshiYMD" AS 調査実施日,
            T5302."ikenshoJuryoYMD" AS 意見書受領日,
            T5116."ichijiHanteiYMD" AS 一次判定日,
            T5501."shinsakaiKaisaiYoteiYMD" AS 審査会予定日,
            T7051."shichosonMeisho" AS 保険者名
        FROM 
            rgdb."DbT5101NinteiShinseiJoho" AS T5101
            
        LEFT JOIN rgdb."DbT5202NinteichosahyoGaikyoChosa" T5202
             ON T5101."shinseishoKanriNo" = T5202."shinseishoKanriNo"
             AND T5202."ninteichosaRirekiNo" = (
                                            SELECT MAX("ninteichosaRirekiNo")
                                            FROM rgdb."DbT5202NinteichosahyoGaikyoChosa" B1
                                            WHERE T5101."shinseishoKanriNo" = B1."shinseishoKanriNo"
                                                  AND B1."isDeleted" = FALSE
                                           )
        LEFT JOIN rgdb."DbT5302ShujiiIkenshoJoho" T5302
             ON T5101."shinseishoKanriNo" = T5302."shinseishoKanriNo"
                AND T5302."ikenshoIraiRirekiNo" = (
                                               SELECT MAX("ikenshoIraiRirekiNo")
                                               FROM rgdb."DbT5302ShujiiIkenshoJoho"
                                               WHERE "shinseishoKanriNo" = T5101."shinseishoKanriNo"
                                                     AND "isDeleted" = FALSE
                                              )
        LEFT JOIN rgdb."DbT5116IchijiHanteiKekkaJoho" T5116
             ON T5101."shinseishoKanriNo" = T5116."shinseishoKanriNo"
        LEFT JOIN rgdb."DbT5502ShinsakaiWariateJoho" T5502
             ON T5101."shinseishoKanriNo" = T5502."shinseishoKanriNo"
             AND T5502."hanteiKekkaCode" is null
        LEFT JOIN rgdb."DbT5501ShinsakaiKaisaiYoteiJoho" T5501
             ON T5502."shinsakaiKaisaiNo" = T5501."shinsakaiKaisaiNo"
        LEFT JOIN rgdb."DbT7051KoseiShichosonMaster" T7051
             ON T5101."shoKisaiHokenshaNo" = T7051."shoKisaiHokenshaNo"
        WHERE
            T5101."ninteiShinseiYMD" <![CDATA[<=]]> #{認定申請年月日}
        <include refid="検索条件" />
        ORDER BY
            T5101."hihokenshaKana",T5101."ninteiShinseiYMD"
    </select>

    <select resultOrdered="true" id="get発行対象者一覧情報_単一"
            resultMap = "resultMap_発行対象者一覧情報"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.ninteienkitsuchishohakko.NinteiEnkiTsuchishoHakkoParameter"
            fetchSize="500">
        SELECT 
            T5101."shinseishoKanriNo" AS 申請書管理番号,
            T5101."hihokenshaNo" AS 被保番号,
            T5101."ninteiShinseiYMD" AS 認定申請年月日,
            T5101."ninteiShinseiShinseijiKubunCode" AS 申請区分_申請時_コード,
            T5101."hihokenshaName" AS 氏名,
            T5101."hihokenshaKana" AS 氏名カナ,
            T5101."enkiKetteiYMD" AS 延期決定日,
            T5101."enkiRiyu" AS 延期理由,
            T5101."enkiTsuchiHakkoYMD" AS 通知書発行日,
            T5101."enkiTsuchiHakkoKaisu" AS 延期回数,
            T5101."enkiMikomiKaishiYMD" AS 延期見込み期間開始日,
            T5101."enkiMikomiShuryoYMD" AS 延期見込み期間終了日,
            T5202."ninteichosaJisshiYMD" AS 調査実施日,
            T5302."ikenshoJuryoYMD" AS 意見書受領日,
            T5116."ichijiHanteiYMD" AS 一次判定日,
            T5501."shinsakaiKaisaiYoteiYMD" AS 審査会予定日,
            T7051."shichosonMeisho" AS 保険者名
        FROM 
            rgdb."DbT5101NinteiShinseiJoho" AS T5101
        LEFT JOIN rgdb."DbT5202NinteichosahyoGaikyoChosa" T5202
             ON T5101."shinseishoKanriNo" = T5202."shinseishoKanriNo"
             AND T5202."ninteichosaRirekiNo" = (
                                            SELECT MAX("ninteichosaRirekiNo")
                                            FROM rgdb."DbT5202NinteichosahyoGaikyoChosa" B1
                                            WHERE T5101."shinseishoKanriNo" = B1."shinseishoKanriNo"
                                                  AND B1."isDeleted" = FALSE
                                           )
        LEFT JOIN rgdb."DbT5302ShujiiIkenshoJoho" T5302
             ON T5101."shinseishoKanriNo" = T5302."shinseishoKanriNo"
                AND T5302."ikenshoIraiRirekiNo" = (
                                               SELECT MAX("ikenshoIraiRirekiNo")
                                               FROM rgdb."DbT5302ShujiiIkenshoJoho"
                                               WHERE "shinseishoKanriNo" = T5101."shinseishoKanriNo"
                                                     AND "isDeleted" = FALSE
                                              )
        LEFT JOIN rgdb."DbT5116IchijiHanteiKekkaJoho" T5116
             ON T5101."shinseishoKanriNo" = T5116."shinseishoKanriNo"
             
        LEFT JOIN rgdb."DbT5502ShinsakaiWariateJoho" T5502
             ON T5101."shinseishoKanriNo" = T5502."shinseishoKanriNo"
             AND T5502."hanteiKekkaCode" is null
        LEFT JOIN rgdb."DbT5501ShinsakaiKaisaiYoteiJoho" T5501
             ON T5502."shinsakaiKaisaiNo" = T5501."shinsakaiKaisaiNo"
             
        LEFT JOIN rgdb."DbT5105NinteiKanryoJoho" F
             ON T5101."shinseishoKanriNo" = F."shinseishoKanriNo"
             
             
        LEFT JOIN rgdb."DbT7051KoseiShichosonMaster" T7051
             ON T5101."shoKisaiHokenshaNo" = T7051."shoKisaiHokenshaNo"
        WHERE 
            T5101."logicalDeletedFlag" = FALSE
            AND F."ninteiShinseiJohoTorokuKanryoYMD" IS NOT NULL
            AND F."ninteiShinsakaiKanryoYMD" IS NULL
            AND T5101."ninteiShinseiYMD" <![CDATA[<=]]> #{認定申請年月日}
            AND not exists(
                            SELECT "shinseishoKanriNo" FROM rgdb."DbT5102NinteiKekkaJoho" a where a."shinseishoKanriNo" = T5101."shinseishoKanriNo"
                          )
        <include refid="検索条件" />
        ORDER BY
            T5101."hihokenshaKana",T5101."ninteiShinseiYMD"
    </select>
    
    <sql id="検索条件">
        <if test="is申請区分_新規申請のみチェックON">
            AND  T5101."ninteiShinseiShinseijiKubunCode" = #{申請区分_新規申請}
        </if>
        <if test="is申請区分_更新申請のみチェックON">
            AND  T5101."ninteiShinseiShinseijiKubunCode" = #{申請区分_更新申請}
        </if>
        <if test="is申請区分_区分変更申請のみチェックON">
            AND  T5101."ninteiShinseiShinseijiKubunCode" = #{申請区分_区分変更申請}
        </if>
        <if test="is申請区分_新規申請かつ更新申請チェックON">
            AND  (T5101."ninteiShinseiShinseijiKubunCode" = #{申請区分_新規申請} OR T5101."ninteiShinseiShinseijiKubunCode" = #{申請区分_更新申請})
        </if>
        <if test="is申請区分_新規申請かつ区分変更申請チェックON">
            AND  (T5101."ninteiShinseiShinseijiKubunCode" = #{申請区分_新規申請} OR T5101."ninteiShinseiShinseijiKubunCode" = #{申請区分_区分変更申請})
        </if>
        <if test="is申請区分_更新申請かつ区分変更申請チェックON">
            AND  (T5101."ninteiShinseiShinseijiKubunCode" = #{申請区分_更新申請} OR T5101."ninteiShinseiShinseijiKubunCode" = #{申請区分_区分変更申請})
        </if>
        <if test="is発行有無_発行未チェックON">
            AND  (T5101."enkiTsuchiHakkoYMD" IS NULL)
        </if>
        <if test="is発行有無_発行済チェックON">
            AND  (T5101."enkiTsuchiHakkoYMD" IS NOT NULL)
        </if>
        <if test="!isみなし二号等対象フラグ">
            AND T5101."minashiNigoEtcTaishoFlag" = #{isみなし二号等対象フラグ}
        </if>
        <if test="is処理見込み日Fromが入力">
            AND  T5101."enkiMikomiKaishiYMD" <![CDATA[>=]]> #{処理見込み日From}
        </if>
        <if test="is処理見込み日Toが入力">
            AND  T5101."enkiMikomiShuryoYMD" <![CDATA[<=]]> #{処理見込み日To}
        </if>
        <if test="is延期の理由が選択">
            AND  T5101."enkiRiyu" = #{延期の理由}
        </if>
        <if test="is保険者が選択">
            AND  T7051."shichosonCode" = #{市町村コード}
        </if>
        
        
        <if test="is認定調査_調査未チェックON">
            <if test="is単一">
                AND  (F."ninteichosaKanryoYMD" IS NULL)
            </if>
            <if test="!is単一">
                AND  T5202."ninteichosaJisshiYMD" IS NULL
            </if>
        </if>
        <if test="is認定調査_調査済チェックON">
            <if test="is単一">
                AND  (F."ninteichosaKanryoYMD" IS NOT NULL)
            </if>
            <if test="!is単一">
                AND  T5202."ninteichosaJisshiYMD" IS NOT NULL
            </if>
        </if>
        <if test="is意見書受領_受領未チェックON">
            <if test="is単一">
                AND  (F."ikenshoTorokuKanryoYMD" IS NULL)
            </if>
            <if test="!is単一">
                AND  T5302."ikenshoJuryoYMD" IS NULL
            </if>
        </if>
        <if test="is意見書受領_受領済チェックON">
            <if test="is単一">
                AND  (F."ikenshoTorokuKanryoYMD" IS NOT NULL)
            </if>
            <if test="!is単一">
                AND  T5302."ikenshoJuryoYMD" IS NOT NULL
            </if>
        </if>
        <if test="is一次判定_判定未チェックON">
            <if test="is単一">
                AND  (F."ichijiHanteiKanryoYMD" IS NULL)
            </if>
            <if test="!is単一">
                AND  T5116."ichijiHanteiYMD" IS NULL
            </if>
        </if>
        <if test="is一次判定_判定済チェックON">
            <if test="is単一">
                AND  (F."ichijiHanteiKanryoYMD" IS NOT NULL)
            </if>
            <if test="!is単一">
                AND  T5116."ichijiHanteiYMD" IS NOT NULL
            </if>
        </if>
        <if test="is審査会割付_割付未チェックON">
            <if test="is単一">
                AND  (F."ninteiShinsakaiWariateKanryoYMD" IS NULL)
            </if>
            <if test="!is単一">
                AND  T5501."shinsakaiKaisaiYoteiYMD" IS NULL
            </if>
        </if>
        <if test="is審査会割付_割付済チェックON">
            <if test="is単一">
                AND  (F."ninteiShinsakaiWariateKanryoYMD" IS NOT NULL)
            </if>
            <if test="!is単一">
                AND  T5501."shinsakaiKaisaiYoteiYMD" IS NOT NULL
            </if>
        </if>
    </sql>


</mapper>
