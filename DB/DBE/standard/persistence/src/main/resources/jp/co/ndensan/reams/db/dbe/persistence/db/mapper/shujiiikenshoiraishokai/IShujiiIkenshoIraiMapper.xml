<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- どのマッパーインターフェースと対応するかを指定する -->

<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.shujiiikenshoiraishokai.IShujiiIkenshoIraiMapper">
    <resultMap id="resultMap_ShujiiIkenshoIraiEntity" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.shujiiikenshoirai.ShujiiIkenshoIraiEntity" autoMapping="true">
        <result property="ninteiShinseiYMD" column="DbT5101_ninteiShinseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="ninteiShinseiCode" column="DbT5101_ninteiShinseiShinseijiKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler"/>
        <result property="torisageYMD" column="DbT5101_torisageYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="nijiHanteiYMD" column="DbT4102_nijiHanteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="nijiHanteiYokaigoJotaiCode" column="DbT4102_nijiHanteiYokaigoJotaiKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler"/>
        <result property="nijiHanteiNinteiYukoKikan" column="DbT4102_nijiHanteiNinteiYukoKikan" />
        <result property="shujiiIryokikanCode" column="DbT5101_shujiiIryokikanCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="iryoKikanMeisho" column="DbT5911_iryoKikanMeisho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shujiiCode" column="DbT5101_shujiiCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shujiiName" column="DbT5912_shujiiName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler"/>
        <result property="ikenshoJuryoYMD" column="DbT5302_ikenshoJuryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="ikenshoKinyuYMD" column="DbT5302_ikenshoKinyuYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="ikenshoIraiKubun" column="DbT5301_ikenshoIraiKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>
    <select id="selectNinnteiChousa" resultMap="resultMap_ShujiiIkenshoIraiEntity"
            parameterType="jp.co.ndensan.reams.db.dbx.definition.core.valueobject.domain.HihokenshaNo" fetchSize="500">
        SELECT
            DbT5101Nintei."ninteiShinseiYMD" AS DbT5101_ninteiShinseiYMD
            , DbT5101Nintei."ninteiShinseiShinseijiKubunCode" AS DbT5101_ninteiShinseiShinseijiKubunCode
            , DbT5101Nintei."torisageYMD" AS DbT5101_torisageYMD
            , DbT4102Nintei."nijiHanteiYMD" AS DbT4102_nijiHanteiYMD
            , DbT4102Nintei."nijiHanteiYokaigoJotaiKubunCode" AS DbT4102_nijiHanteiYokaigoJotaiKubunCode
            , DbT4102Nintei."nijiHanteiNinteiYukoKikan" AS DbT4102_nijiHanteiNinteiYukoKikan
            , DbT5101Nintei."shujiiIryokikanCode" AS DbT5101_shujiiIryokikanCode
            , DbT5911Shujii."iryoKikanMeisho" AS DbT5911_iryoKikanMeisho
            , DbT5101Nintei."shujiiCode" AS DbT5101_shujiiCode
            , DbT5912Shujii."shujiiName" AS DbT5912_shujiiName
            , DbT5302Shujii."ikenshoJuryoYMD" AS DbT5302_ikenshoJuryoYMD
            , DbT5302Shujii."ikenshoKinyuYMD" AS DbT5302_ikenshoKinyuYMD
            , DbT5301Shujii."ikenshoIraiKubun" AS DbT5301_ikenshoIraiKubun
          FROM
            rgdb."DbT5101NinteiShinseiJoho" AS DbT5101Nintei 
            INNER JOIN rgdb."DbT4102NinteiKekkaJoho" AS DbT4102Nintei 
              ON DbT4102Nintei."shinseishoKanriNo" = DbT5101Nintei."shinseishoKanriNo" 
            INNER JOIN ( 
              SELECT
                DbT5301."shinseishoKanriNo" AS shinseisho
                ,MAX(DbT5301."ikenshoIraiRirekiNo") AS ikensho
              FROM
                rgdb."DbT5301ShujiiIkenshoIraiJoho" DbT5301 
              WHERE
                DbT5301."logicalDeletedFlag" = false 
              GROUP BY
                DbT5301."shinseishoKanriNo"
            ) TB 
              ON TB."shinseisho" = DbT5101Nintei."shinseishoKanriNo" 
            INNER JOIN rgdb."DbT7051KoseiShichosonMaster" AS DbT7051Kosei 
              ON DbT7051Kosei."shoKisaiHokenshaNo" = DbT5101Nintei."shoKisaiHokenshaNo" 
            INNER JOIN rgdb."DbT5301ShujiiIkenshoIraiJoho" AS DbT5301Shujii 
              ON DbT5301Shujii."shinseishoKanriNo" = DbT5101Nintei."shinseishoKanriNo" 
              AND DbT5301Shujii."ikenshoIraiRirekiNo" = TB."ikensho" 
            INNER JOIN rgdb."DbT5302ShujiiIkenshoJoho" AS DbT5302Shujii 
              ON DbT5302Shujii."shinseishoKanriNo" = DbT5101Nintei."shinseishoKanriNo" 
              AND DbT5302Shujii."ikenshoIraiRirekiNo" = TB."ikensho" 
            LEFT JOIN rgdb."DbT5911ShujiiIryoKikanJoho" AS DbT5911Shujii 
              ON DbT5911Shujii."shujiiIryokikanCode" = DbT5101Nintei."shujiiIryokikanCode" 
              AND DbT5911Shujii."shichosonCode" = DbT7051Kosei."shichosonCode" 
            LEFT JOIN rgdb."DbT5912ShujiiJoho" AS DbT5912Shujii 
              ON DbT5912Shujii."shujiiIryokikanCode" = DbT5101Nintei."shujiiIryokikanCode" 
              AND DbT5912Shujii."shujiiCode" = DbT5101Nintei."shujiiCode" 
              AND DbT5912Shujii."shichosonCode" = DbT7051Kosei."shichosonCode" 
          WHERE
            DbT5101Nintei."hihokenshaNo" = #{hihokenshaNo}
            AND DbT5101Nintei."zenYokaigoKubunCode" IN('01','04')
          ORDER BY
            DbT5101Nintei."ninteiShinseiYMD"
    </select>
</mapper>