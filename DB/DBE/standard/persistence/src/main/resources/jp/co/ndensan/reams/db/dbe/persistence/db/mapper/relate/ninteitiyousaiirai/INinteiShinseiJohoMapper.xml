<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--概要： 要介護認定申請情報のマッピング用XMLです。-->

<!--どのマッパーインターフェースと対応するかを指定する-->
<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.ninteitiyousaiirai.INinteiShinseiJohoMapper">
<!--    <select id="getNinteiShinseiJohoEntity"
            resultMap="resultMap_NinteiKekkaJohoEntity"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatis.param.ikensho.ninteishinseijoho.NinteiShinseiJohoMapperParameter" fetchSize="500">
        SELECT
        dbT5101NinteiShinseiJoho.*,
        dbT5201NinteichosaIraiJoho.*
        FROM
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5101NinteiShinseiJohoMapper.allColumns_DbT5101NinteiShinseiJoho" />
        FROM
        rgdb."DbT5101NinteiShinseiJoho"
        WHERE
        rgdb."DbT5101NinteiShinseiJoho"."shinseishoKanriNo" = #{shinseishoKanriNo}
        ) AS dbT5101NinteiShinseiJoho
        LEFT OUTER JOIN
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.basic.IDbT5201NinteichosaIraiJohoMapper.allColumns_DbT5201NinteichosaIraiJoho" />
        FROM
        rgdb."DbT5201NinteichosaIraiJoho"
        ) AS dbT5201NinteichosaIraiJoho
        ON dbT5101NinteiShinseiJoho."dbT5101NinteiShinseiJoho_shinseishoKanriNo" = dbT5201NinteichosaIraiJoho."dbT5201NinteichosaIraiJoho_shinseishoKanriNo"

    </select>-->
    <!--    <resultMap id="resultMap_NinteiKekkaJohoEntity" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.ninteichosairaijoho.ninteishinseijoho.NinteiShinseiJohoRelateEntity" autoMapping="true">
        <id column="dbT5101NinteiShinseiJoho_shinseishoKanriNo"/>
        <association property="DbT5101Entity" resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5101NinteiShinseiJohoMapper.ResultMap_DbT5101NinteiShinseiJohoEntity"/>
        <collection  property="DbT5201Entity" ofType="jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT5201NinteichosaIraiJohoEntity"
                     resultMap="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.basic.IDbT5201NinteichosaIraiJohoMapper.ResultMap_DbT5201NinteichosaIraiJohoEntity"/>
    </resultMap>-->

    <select id="countGaitouDataKenSu13" resultType="int" parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatis.param.ninteichosatokusokujohakko.CountGaitouDataKenSu13Parameter"  fetchSize="500">
        SELECT
        COUNT(0)
        FROM
        ((SELECT
        T5201shinseishoKanriNo,
        DbT5101."shinseishoKanriNo" AS DBT5101shinseishoKanriNo,
        DbT5101."shoKisaiHokenshaNo" AS DBT5101shoKisaiHokenshaNo,
        "shoriJotaiKubun",
        MAX FROM
        rgdb."DbT5101NinteiShinseiJoho" AS DbT5101
        INNER JOIN rgdb."DbT7051KoseiShichosonMaster" AS DbT7051
        ON
        DbT7051."shoKisaiHokenshaNo" = DbT5101."shoKisaiHokenshaNo"
        INNER JOIN
        (
        SELECT
        T5201."shinseishoKanriNo" AS T5201shinseishoKanriNo,
        MAX(T5201."ninteichosaIraiRirekiNo")
        FROM
        rgdb."DbT5201NinteichosaIraiJoho" AS T5201
        WHERE
        T5201."logicalDeletedFlag" = FALSE
        GROUP BY T5201."shinseishoKanriNo"
        ) AS TB1
        ON
        TB1.T5201shinseishoKanriNo = DbT5101."shinseishoKanriNo") AS TB2
        INNER JOIN rgdb."DbT5201NinteichosaIraiJoho" AS DbT5201
        ON
        DbT5201."shinseishoKanriNo" = TB2.DBT5101shinseishoKanriNo
        AND DbT5201."ninteichosaIraiRirekiNo" = TB2.MAX
        AND DbT5201."ninteichosaKigenYMD" &lt; #{temp_ninteichosaKigenYMD}) AS TB3
        <if test="temp_taishoumono_Equal_1" >
            AND (DbT5201."ninteichosaTokusokuYMD" = ''
            OR DbT5201."ninteichosaTokusokuYMD" IS NULL)
        </if>
        INNER JOIN rgdb."DbT5105NinteiKanryoJoho" AS DbT5105
        ON
        DbT5105."shinseishoKanriNo" = TB3.T5201shinseishoKanriNo
        AND DbT5105."ninteiShinseiJohoTorokuKanryoYMD" != ''
        AND DbT5105."ninteiShinseiJohoTorokuKanryoYMD" IS NOT NULL
        AND DbT5105."ninteichosaIraiKanryoYMD" != ''
        AND DbT5105."ninteichosaIraiKanryoYMD" IS NOT NULL
        AND (DbT5105."ninteichosaKanryoYMD" = '' OR DbT5105."ninteichosaKanryoYMD" IS NULL)
        AND (DbT5105."ninteiShinsakaiWariateKanryoYMD" = '' OR DbT5105."ninteiShinsakaiWariateKanryoYMD" IS NULL)
        AND (DbT5105."ninteiShinsakaiKanryoYMD" = '' OR DbT5105."ninteiShinsakaiKanryoYMD" IS NULL)
        AND (DbT5105."centerSoshinYMD" = '' OR DbT5105."centerSoshinYMD" IS NULL)
        WHERE
        1 = 1
        <if test="temp_hokennshaCode_isNotEmpty" >
            AND TB3.DBT5101shoKisaiHokenshaNo = #{temp_hokennshaCode}
        </if>
        <if test="temp_itakusakiCode_isNotEmpty" >
            AND TB3.ninteiChosaItakusakiCode = #{temp_ninteiChosaItakusakiCode}
        </if>
        <if test="temp_chosainCode_isNotEmpty" >
            AND TB3."ninteiChosainCode" = #{temp_ninteiChosainCode}
        </if>
        AND TB3."shoriJotaiKubun" != '2'
        AND TB3."shoriJotaiKubun" != '1'
    </select>

    <select id="countGaitouDataKenSu2" resultType="int" parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatis.param.ninteichosatokusokujohakko.CountGaitouDataKenSu2Parameter" fetchSize="500">
        SELECT
        COUNT(0)
        FROM
        (rgdb."DbT5101NinteiShinseiJoho" AS DbT5101
        INNER JOIN rgdb."DbT7051KoseiShichosonMaster" AS DbT7051
        ON DbT7051."shoKisaiHokenshaNo" = DbT5101."shoKisaiHokenshaNo"
        INNER JOIN
        (
        SELECT
        T5201."shinseishoKanriNo",
        MAX(T5201."ninteichosaIraiRirekiNo")
        FROM
        rgdb."DbT5201NinteichosaIraiJoho" AS T5201
        WHERE
        T5201."logicalDeletedFlag" = FALSE
        GROUP BY T5201."shinseishoKanriNo"
        )AS TB1
        ON TB1."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        INNER JOIN rgdb."DbT5201NinteichosaIraiJoho" AS DbT5201
        ON
        DbT5201."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        AND DbT5201."ninteichosaIraiRirekiNo" = TB1.max

        <if test="temp_kaishishuryoubi_NotNull">
            AND DbT5201."ninteichosaTokusokuYMD"
            BETWEEN #{temp_insatuKikanKaishibi} AND #{temp_insatuKikanShuryoubi}
        </if>

        <if test="temp_kaishiNotNull_huryouNull">
            AND DbT5201."ninteichosaTokusokuYMD" &gt;= #{temp_insatuKikanKaishibi}
        </if>

        <if test="temp_kaishiNull_huryouNotNull">
            AND DbT5201."ninteichosaTokusokuYMD" &lt;= #{temp_insatuKikanShuryoubi}
        </if>

        INNER JOIN rgdb."DbT5105NinteiKanryoJoho" AS DbT5105
        ON
        DbT5105."shinseishoKanriNo" = DbT5101."shinseishoKanriNo"
        AND DbT5105."ninteiShinseiJohoTorokuKanryoYMD" != ''
        AND DbT5105."ninteiShinseiJohoTorokuKanryoYMD" IS NOT NULL
        AND DbT5105."ninteichosaIraiKanryoYMD" != ''
        AND DbT5105."ninteichosaIraiKanryoYMD" IS NOT NULL
        AND (DbT5105."ninteichosaKanryoYMD" = '' OR DbT5105."ninteichosaKanryoYMD" IS NULL)
        AND (DbT5105."ninteiShinsakaiWariateKanryoYMD" = '' OR DbT5105."ninteiShinsakaiWariateKanryoYMD" IS NULL)
        AND (DbT5105."ninteiShinsakaiKanryoYMD" = '' OR DbT5105."ninteiShinsakaiKanryoYMD" IS NULL)
        AND (DbT5105."centerSoshinYMD" = '' OR DbT5105."centerSoshinYMD" IS NULL)) AS TB2
        WHERE
        1=1
        <if test="temp_hokennshaCode_isNotEmpty">
            AND TB2."ninteichosaIraiRirekiNo" = #{temp_hokennshaCode}
        </if>

        <if test="temp_itakusakiCode_isNotEmpty">
            AND TB2."ninteiChosaItakusakiCode" = #{temp_ninteiChosaItakusakiCode}
        </if>

        <if test="temp_chosainCode_isNotEmpty">
            AND TB2."ninteiChosainCode" = #{temp_ninteiChosainCode}
        </if>
        AND TB2."shoriJotaiKubun" != '2'
        AND TB2."shoriJotaiKubun" != '1'
    </select>
</mapper>
