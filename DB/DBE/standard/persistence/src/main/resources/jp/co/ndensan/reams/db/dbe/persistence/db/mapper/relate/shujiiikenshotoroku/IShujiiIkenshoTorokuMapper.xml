<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 主治医意見書のマッピング用XMLです。 -->
<!-- @reamsid_L DBE-0070-010 chengsanyuan -->

<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbe.persistence.db.mapper.relate.shujiiikenshotoroku.IShujiiIkenshoTorokuMapper">
     <select resultOrdered="true" id="getShujiiIkenshoForLoad" resultMap="resultMap_ShujiiIkenshoTorokuRelateEntity"
             parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.shujiiikenshotoroku.ShujiiIkenshoTorokuMapperParameter" 
             fetchSize="500">
          SELECT
                DbT5301ShujiiIkenshoIraiJoho."shinseishoKanriNo",
                DbT5301ShujiiIkenshoIraiJoho."ikenshoIraiRirekiNo",
                DbT5301ShujiiIkenshoIraiJoho."ikenshoIraiKubun",
                DbT5302ShujiiIkenshoJoho."ikenshoDoiFlag",        
                (case DbT5912ShujiiJoho_Ikensho."shujiiCode"
                    WHEN null THEN DbT5912ShujiiJoho."shujiiCode"
                    WHEN '' THEN DbT5912ShujiiJoho."shujiiCode"
                    ELSE DbT5912ShujiiJoho_Ikensho."shujiiCode"
                END) AS "shujiiCode",
                (case DbT5912ShujiiJoho_Ikensho."shujiiName"
                    WHEN null THEN DbT5912ShujiiJoho."shujiiName"
                    WHEN '' THEN DbT5912ShujiiJoho."shujiiName"
                    ELSE DbT5912ShujiiJoho_Ikensho."shujiiName"
                END) AS"shujiiName",
                DbT5302ShujiiIkenshoJoho."ikenshoKinyuYMD",
                (case DbT5911ShujiiIryoKikanJoho_Ikensho."shujiiIryokikanCode" 
                    WHEN null THEN  DbT5911ShujiiIryoKikanJoho."shujiiIryokikanCode" 
                    WHEN '' THEN  DbT5911ShujiiIryoKikanJoho."shujiiIryokikanCode" 
                    ELSE DbT5911ShujiiIryoKikanJoho_Ikensho."shujiiIryokikanCode" 
                END) AS "shujiiIryokikanCode",
                (case DbT5911ShujiiIryoKikanJoho_Ikensho."iryoKikanMeisho"
                    WHEN null THEN  DbT5911ShujiiIryoKikanJoho."iryoKikanMeisho"
                    WHEN '' THEN  DbT5911ShujiiIryoKikanJoho."iryoKikanMeisho" 
                    ELSE DbT5911ShujiiIryoKikanJoho_Ikensho."iryoKikanMeisho"
                END) AS "iryoKikanMeisho",
                (case DbT5911ShujiiIryoKikanJoho_Ikensho."telNo"
                    WHEN null THEN  DbT5911ShujiiIryoKikanJoho."telNo"
                    WHEN '' THEN  DbT5911ShujiiIryoKikanJoho."telNo" 
                    ELSE DbT5911ShujiiIryoKikanJoho_Ikensho."telNo"
                END) AS "telNo",
               (case DbT5911ShujiiIryoKikanJoho_Ikensho."jusho"
                    WHEN null THEN  DbT5911ShujiiIryoKikanJoho."jusho"
                    WHEN '' THEN  DbT5911ShujiiIryoKikanJoho."jusho"
                    ELSE DbT5911ShujiiIryoKikanJoho_Ikensho."jusho"
                END) AS "jusho",
                (case DbT5911ShujiiIryoKikanJoho_Ikensho."faxNo"
                    WHEN null THEN  DbT5911ShujiiIryoKikanJoho."faxNo"
                    WHEN '' THEN  DbT5911ShujiiIryoKikanJoho."faxNo"
                    ELSE DbT5911ShujiiIryoKikanJoho_Ikensho."faxNo"
                END) AS "faxNo",
                DbT5302ShujiiIkenshoJoho."saishuShinryoYMD",
                DbT5302ShujiiIkenshoJoho."ikenshoSakuseiKaisuKubun",
                DbT5302ShujiiIkenshoJoho."existTakaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existNaikaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existSeishinkaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existGekaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existSeikeigekaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existNoshinkeigekaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existHifukaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existHinyokikaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existFujinkaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existGankaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existJibiinkokaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existRehabilitationkaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existShikaJushinFlag",
                DbT5302ShujiiIkenshoJoho."existSonotaJushinkaFlag",
                DbT5302ShujiiIkenshoJoho."sonotaJushinKaMei",
                DbT5302ShujiiIkenshoJoho."ikenshoMemo",
                DbT5101NinteiShinseiJoho."koroshoIfShikibetsuCode",
                DbT5302ShujiiIkenshoJoho."nijiHanteiKekkaRenrakuFlag"
          FROM
                rgdb."DbT5301ShujiiIkenshoIraiJoho" AS DbT5301ShujiiIkenshoIraiJoho
          LEFT JOIN
                rgdb."DbT5302ShujiiIkenshoJoho" AS DbT5302ShujiiIkenshoJoho
          ON
                DbT5301ShujiiIkenshoIraiJoho."shinseishoKanriNo" = DbT5302ShujiiIkenshoJoho."shinseishoKanriNo"
                AND DbT5301ShujiiIkenshoIraiJoho."ikenshoIraiRirekiNo" = DbT5302ShujiiIkenshoJoho."ikenshoIraiRirekiNo"
          LEFT JOIN 
                rgdb."DbT5912ShujiiJoho" AS DbT5912ShujiiJoho
          ON 
                DbT5301ShujiiIkenshoIraiJoho."shujiiIryokikanCode" = DbT5912ShujiiJoho."shujiiIryokikanCode"
                AND DbT5301ShujiiIkenshoIraiJoho."shujiiCode" = DbT5912ShujiiJoho."shujiiCode"
                AND DbT5912ShujiiJoho."shichosonCode" = #{市町村コード}
          LEFT JOIN 
                rgdb."DbT5912ShujiiJoho" AS DbT5912ShujiiJoho_Ikensho
          ON 
                DbT5302ShujiiIkenshoJoho."shujiiIryoKikanCode" = DbT5912ShujiiJoho_Ikensho."shujiiIryokikanCode"
                AND DbT5302ShujiiIkenshoJoho."shujiiCode" = DbT5912ShujiiJoho_Ikensho."shujiiCode"
                AND DbT5912ShujiiJoho_Ikensho."shichosonCode" = #{市町村コード}
          LEFT JOIN 
                rgdb."DbT5911ShujiiIryoKikanJoho" AS DbT5911ShujiiIryoKikanJoho
          ON 
                DbT5301ShujiiIkenshoIraiJoho."shujiiIryokikanCode" = DbT5911ShujiiIryoKikanJoho."shujiiIryokikanCode"
                AND DbT5911ShujiiIryoKikanJoho."shichosonCode" = #{市町村コード}
         LEFT JOIN 
                rgdb."DbT5911ShujiiIryoKikanJoho" AS DbT5911ShujiiIryoKikanJoho_Ikensho
          ON 
                DbT5302ShujiiIkenshoJoho."shujiiIryoKikanCode" = DbT5911ShujiiIryoKikanJoho_Ikensho."shujiiIryokikanCode"
                AND DbT5911ShujiiIryoKikanJoho."shichosonCode" = #{市町村コード}
         LEFT JOIN
               rgdb."DbT5101NinteiShinseiJoho" AS DbT5101NinteiShinseiJoho
         ON
                DbT5301ShujiiIkenshoIraiJoho."shinseishoKanriNo" =  DbT5101NinteiShinseiJoho."shinseishoKanriNo"
          <!--INNER JOIN
                rgdb."DbT5105NinteiKanryoJoho" AS DbT5105NinteiKanryoJoho
          ON
                DbT5301ShujiiIkenshoIraiJoho."shinseishoKanriNo" = DbT5105NinteiKanryoJoho."shinseishoKanriNo"
                AND DbT5105NinteiKanryoJoho."ninteiShinseiJohoTorokuKanryoYMD" IS NOT NULL
                AND DbT5105NinteiKanryoJoho."ikenshoSakuseiIraiKanryoYMD" IS NOT NULL
                AND DbT5105NinteiKanryoJoho."ninteiShinsakaiWariateKanryoYMD" IS NULL
                AND DbT5105NinteiKanryoJoho."ninteiShinsakaiKanryoYMD" IS NULL
                AND DbT5105NinteiKanryoJoho."centerSoshinYMD" IS NULL-->
          WHERE
                DbT5301ShujiiIkenshoIraiJoho."shinseishoKanriNo" = #{管理番号}
                AND DbT5301ShujiiIkenshoIraiJoho."logicalDeletedFlag" = false
          ORDER BY DbT5301ShujiiIkenshoIraiJoho."ikenshoIraiRirekiNo" DESC
          LIMIT 1
                <!--AND DbT5301ShujiiIkenshoIraiJoho"ikenshoIraiRirekiNo" = #{履歴番号}-->
    </select>
    
    <select resultOrdered="true" id="getShujiiIkenshoKensu"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.shujiiikenshotoroku.ShujiiIkenshoTorokuMapperParameter"
            resultType="int" fetchSize="500">
        SELECT
        count(0)
        FROM
        rgdb."DbT5302ShujiiIkenshoJoho" AS DbT5302ShujiiIkenshoJoho
        WHERE
          DbT5302ShujiiIkenshoJoho."shinseishoKanriNo" = #{管理番号}
          AND  DbT5302ShujiiIkenshoJoho."ikenshoIraiRirekiNo" = #{履歴番号}
    </select>
    
    <select resultOrdered="true" id="getIchijiHantei"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.shujiiikenshotoroku.ShujiiIkenshoTorokuMapperParameter"
            resultType="int" fetchSize="500">
        SELECT
        count(0)
        FROM
        rgdb."DbT5116IchijiHanteiKekkaJoho" AS DbT5116IchijiHanteiKekkaJoho
        WHERE
        DbT5116IchijiHanteiKekkaJoho."shinseishoKanriNo" = #{管理番号}
    </select>
    
    <select resultOrdered="true" id="getIchijiHanteiKanryo"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.shujiiikenshotoroku.ShujiiIkenshoTorokuMapperParameter"
            resultType="int" fetchSize="500">
        SELECT
        count(0)
        FROM
        rgdb."DbT5105NinteiKanryoJoho" AS DbT5105NinteiKanryoJoho
        WHERE
        DbT5105NinteiKanryoJoho."shinseishoKanriNo" = #{管理番号}
        AND NOT("ichijiHanteiKanryoYMD" is NUll OR "ichijiHanteiKanryoYMD" = '')
    </select>
    
    <select resultOrdered="true" id="getIchijiHanteiMikanryo"
            parameterType="jp.co.ndensan.reams.db.dbe.definition.mybatisprm.shujiiikenshotoroku.ShujiiIkenshoTorokuMapperParameter"
            resultType="int" fetchSize="500">
        SELECT
        count(0)
        FROM
        rgdb."DbT5105NinteiKanryoJoho" AS DbT5105NinteiKanryoJoho
        WHERE
        DbT5105NinteiKanryoJoho."shinseishoKanriNo" = #{管理番号}
        AND ("ichijiHanteiKanryoYMD" is NUll OR "ichijiHanteiKanryoYMD" = '')
    </select>

    <resultMap id="resultMap_ShujiiIkenshoTorokuRelateEntity" type="jp.co.ndensan.reams.db.dbe.entity.db.relate.shujiiikenshotoroku.ShujiiIkenshoTorokuRelateEntity" autoMapping="true">
        <id column="shinseishoKanriNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ShinseishoKanriNoTypeHandler"/>
        <id column="ikenshoIraiRirekiNo" />
        <association property="dbt5301Entity" resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5301ShujiiIkenshoIraiJohoMapper.ResultMap_DbT5301ShujiiIkenshoIraiJohoEntity"/>
        <association property="dbt5302Entity" resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5302ShujiiIkenshoJohoMapper.ResultMap_DbT5302ShujiiIkenshoJohoEntity"/>
        <association property="dbt5912Entity" resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5912ShujiiJohoMapper.ResultMap_DbT5912ShujiiJohoEntity"/>
        <association property="dbt5911Entity" resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT5911ShujiiIryoKikanJohoMapper.ResultMap_DbT5911ShujiiIryoKikanJohoEntity"/>
    </resultMap>
    
</mapper>
