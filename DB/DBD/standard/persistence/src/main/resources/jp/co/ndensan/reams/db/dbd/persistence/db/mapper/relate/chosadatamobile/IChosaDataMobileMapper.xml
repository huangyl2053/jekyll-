<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBD-2030-010 x_youyj -->


<mapper namespace="jp.co.ndensan.reams.db.dbd.persistence.db.mapper.relate.chosadatamobile.IChosaDataMobileMapper">

    <select resultOrdered="true" id="get調査データの取得"
            resultType = "jp.co.ndensan.reams.db.dbd.entity.db.relate.dbd5010001.ChosaDataMobileEntity"
            parameterType = "jp.co.ndensan.reams.db.dbd.definition.mybatisprm.dbd5010001.ChosaDataMobileMybatisParameter"
            fetchSize="500">
        SELECT 
            要介護認定申請情報."shinseishoKanriNo" AS 申請書管理番号,
            要介護認定申請情報."koroshoIfShikibetsuCode" AS 厚労省IF識別コード,
            要介護認定申請情報."shoKisaiHokenshaNo" AS 証記載保険者番号,
            要介護認定申請情報."hihokenshaNo" AS 被保険者番号,
            要介護認定申請情報."ninteiShinseiYMD" AS 認定申請年月日,
            要介護認定申請情報."ninteiShinseiShinseijiKubunCode" AS 認定申請区分申請時コード,
            要介護認定申請情報."hihokenshaName" AS 被保険者氏名,
            要介護認定申請情報."hihokenshaKana" AS 被保険者氏名カナ,
            要介護認定申請情報."seinengappiYMD" AS 生年月日,
            要介護認定申請情報."age" AS 年齢,
            要介護認定申請情報."seibetsu" AS 性別,
            要介護認定申請情報."yubinNo" AS 郵便番号,
            要介護認定申請情報."jusho" AS 住所,
            要介護認定申請情報."telNo" AS 電話番号,
            要介護認定申請情報."ninteiChosaItakusakiCode" AS 認定調査委託先コード,
            要介護認定申請情報."ninteiChosainCode" AS 認定調査員コード,
            構成市町村マスタ."shichosonMeisho" AS 保険者名,
            要介護認定完了情報."ninteichosaIraiKanryoYMD" AS 認定調査依頼完了年月日,
            認定調査依頼情報."ninteichosaIraiRirekiNo" AS 認定調査依頼履歴番号,
            認定調査委託先情報."jigyoshaMeisho" AS 調査委託先,
            認定調査委託先情報."jigyoshaMeishoKana" AS 委託先の事業者名称カナ,
            認定調査委託先情報."yubinNo" AS 委託先の郵便番号,
            認定調査委託先情報."jusho" AS 委託先の住所,
            認定調査委託先情報."telNo" AS 委託先の電話番号,
            認定調査委託先情報."faxNo" AS 委託先のFAX番号,
            認定調査委託先情報."daihyoshaName" AS 委託先の代表者名,
            認定調査委託先情報."daihyoshaNameKana" AS 委託先の代表者名カナ,
            認定調査委託先情報."chosaItakuKubun" AS 委託先の調査委託区分,
            認定調査委託先情報."tokuteiChosainDisplayFlag" AS 委託先の特定調査員表示フラグ,
            認定調査委託先情報."waritsukeTeiin" AS 委託先の割付定員,
            認定調査委託先情報."waritsukeChiku" AS 委託先の割付地区,
            認定調査委託先情報."autoWaritsukeFlag" AS 委託先の自動割付,
            認定調査委託先情報."kikanKubun" 委託先の機関の区分,
            調査員情報."chosainShimei" AS 調査員氏名,
            調査員情報."chosainKanaShimei" AS 調査員の調査員氏名カナ,
            調査員情報."seibetsu" AS 調査員の性別,
            調査員情報."chosainShikaku" AS 調査員の調査員資格,
            調査員情報."chikuCode" AS 調査員の地区コード,
            調査員情報."chosaKanoNinzuPerMonth" AS 調査員の調査可能人数月,
            調査員情報."yubinNo" AS 調査員の郵便番号,
            調査員情報."jusho" AS 調査員の住所,
            調査員情報."telNo" AS 調査員の電話番号,
            調査員情報."faxNo" AS 調査員のFAX番号,
            調査員情報."shozokuKikanName" AS 調査員の所属機関名称,
            認定調査票概況調査."gaikyoChosaTextImageKubun" AS 概況特記テキストイメージ区分コード,
            認定調査票概況調査."ninteichousaIraiKubunCode" AS 認定調査依頼区分コード,
            認定調査票概況調査."ninteichosaIraiKaisu" AS 認定調査回数,
            認定調査票概況調査."ninteichosaJisshiYMD" AS 認定調査実施年月日,
            認定調査票概況調査."ninteichosaJuryoYMD" AS 認定調査受領年月日,
            認定調査票概況調査."ninteiChosaKubunCode" AS 認定調査区分コード,
            認定調査票概況調査."chosaJisshiBashoCode" AS 認定調査実施場所コード,
            認定調査票概況調査."chosaJisshiBashoMeisho" AS 認定調査実施場所名称,
            認定調査票概況調査."serviceKubunCode" AS 認定調査サービス区分コード,
            認定調査票概況調査."riyoShisetsuShimei" AS 利用施設名,
            認定調査票概況調査."riyoShisetsuJusho" AS 利用施設住所,
            認定調査票概況調査."riyoShisetsuTelNo" AS 利用施設電話番号,
            認定調査票概況調査."riyoShisetsuYubinNo" AS 利用施設郵便番号,
            認定調査票概況調査."tokki" AS 特記,
            認定調査票概況調査."tokkijikoUketsukeYMD" AS 認定調査特記事項受付年月日,
            認定調査票概況調査."tokkijikoJuryoYMD" AS 認定調査特記事項受領年月日,
            認定調査票概況特記."jutakuKaishu" AS 住宅改修改修箇所,
            認定調査票概況特記."tokubetsuKyufuService" AS 市町村特別給付サービス種類名,
            認定調査票概況特記."zaitakuService" AS 介護保険給付以外の在宅サービス種類名,
            認定調査票概況特記."shuso" AS 概況特記事項主訴,
            認定調査票概況特記."kazokuJokyo" AS 概況特記事項家族状況,
            認定調査票概況特記."kyojuKankyo" AS 概況特記事項居住環境,
            認定調査票概況特記."kikaiKiki" AS 概況特記事項機器器械,
            認定調査票特記情報."ninteichosaTokkijikoNo" AS 認定調査特記事項番号,
            認定調査票特記情報."ninteichosaTokkijikoRemban" AS 認定調査特記事項連番,
            認定調査票特記情報."genponMaskKubun" AS 原本マスク区分コード,
            認定調査票特記情報."tokkiJiko" AS 特記事項,
            認定調査票概況調査サービスの状況."remban" AS サービスの状況連番,
            認定調査票概況調査サービスの状況."serviceJokyo" AS サービスの状況,
            認定調査票概況調査サービスの状況フラグ."remban" AS サービスの状況フラグ連番,
            認定調査票概況調査サービスの状況フラグ."serviceJokyoFlag" AS サービスの状況フラグ,
            認定調査票概況調査記入項目."remban" AS 記入項目連番,
            認定調査票概況調査記入項目."serviceJokyoKinyu" AS サービスの状況記入,
            認定調査票概況調査施設利用."remban" AS 施設利用連番,
            認定調査票概況調査施設利用."shisetsuRiyoFlag" AS 施設利用フラグ,
            認定調査票基本調査."ninchishoNichijoSeikatsuJiritsudoCode" AS 認定調査認知症高齢者の日常生活自立度コード,
            認定調査票基本調査."shogaiNichijoSeikatsuJiritsudoCode" AS 認定調査障害高齢者の日常生活自立度コード,
            認定調査票基本調査調査項目."remban" AS 調査項目連番,
            認定調査票基本調査調査項目."researchItem" AS 内容
        FROM rgdb."DbT4101NinteiShinseiJoho" AS 要介護認定申請情報
        INNER JOIN rgdb."DbT5105NinteiKanryoJoho" AS 要介護認定完了情報
            ON 要介護認定申請情報."shinseishoKanriNo" = 要介護認定完了情報."shinseishoKanriNo"
        INNER JOIN rgdb."DbT7051KoseiShichosonMaster" AS 構成市町村マスタ
            ON 構成市町村マスタ."shoKisaiHokenshaNo" = 要介護認定申請情報."shoKisaiHokenshaNo"
        LEFT JOIN rgdb."DbT4201NinteichosaIraiJoho" AS 認定調査依頼情報
            ON 認定調査依頼情報."shinseishoKanriNo" = 要介護認定申請情報."shinseishoKanriNo"
            AND 認定調査依頼情報."logicalDeletedFlag" = FALSE
            AND NOT EXISTS (SELECT 'X'
				FROM rgdb."DbT4201NinteichosaIraiJoho" AS A
				WHERE 認定調査依頼情報."shinseishoKanriNo" = A."shinseishoKanriNo"
				AND A."logicalDeletedFlag" = FALSE
				AND 認定調査依頼情報."ninteichosaIraiRirekiNo" &lt; A."ninteichosaIraiRirekiNo"
				)
        LEFT JOIN rgdb."DbT4910NinteichosaItakusakiJoho" AS 認定調査委託先情報
            ON 要介護認定申請情報."ninteiChosaItakusakiCode" = 認定調査委託先情報."ninteichosaItakusakiCode"
	    AND 認定調査委託先情報."shichosonCode" = 構成市町村マスタ."shichosonCode"
	    AND 認定調査委託先情報."jokyoFlag" = TRUE
        LEFT JOIN rgdb."DbT4913ChosainJoho" AS 調査員情報
            ON 調査員情報."ninteiChosaItakusakiCode" = 要介護認定申請情報."ninteiChosaItakusakiCode"
	    AND 調査員情報."ninteiChosainCode" = 要介護認定申請情報."ninteiChosainCode"
	    AND 調査員情報."shichosonCode" = 構成市町村マスタ."shichosonCode"
	    AND 調査員情報."jokyoFlag" = TRUE
        LEFT JOIN rgdb."DbT4202NinteichosahyoGaikyoChosa" AS 認定調査票概況調査
            ON 認定調査票概況調査."shinseishoKanriNo" = 要介護認定申請情報."shinseishoKanriNo"
            AND 認定調査票概況調査."gaikyoChosaTextImageKubun" = #{概況調査テキストイメージ区分}
            AND 要介護認定申請情報."koroshoIfShikibetsuCode" = 認定調査票概況調査."koroshoIfShikibetsuCode"
            AND NOT EXISTS (SELECT 'X'
                                FROM rgdb."DbT4202NinteichosahyoGaikyoChosa" AS B
                                WHERE 認定調査票概況調査."shinseishoKanriNo" = B."shinseishoKanriNo"
                                AND 認定調査票概況調査."koroshoIfShikibetsuCode" = B."koroshoIfShikibetsuCode"
                                AND 認定調査票概況調査."ninteichosaRirekiNo" &lt; B."ninteichosaRirekiNo"
                                )
        LEFT JOIN rgdb."DbT4206GaikyoTokki" AS 認定調査票概況特記
            ON 認定調査票概況特記."shinseishoKanriNo" = 要介護認定申請情報."shinseishoKanriNo"
	    AND 認定調査票概況特記."gaikyoTokkiTextImageKubun" = #{概況調査テキストイメージ区分}
	    AND NOT EXISTS (SELECT 'X' 
                                FROM rgdb."DbT4206GaikyoTokki" AS C
                                WHERE 認定調査票概況特記."shinseishoKanriNo" = C."shinseishoKanriNo"
                                AND 認定調査票概況特記."gaikyoTokkiTextImageKubun" &lt; C."gaikyoTokkiTextImageKubun"
                                )
        LEFT JOIN rgdb."DbT4207NinteichosahyoServiceJokyo" AS 認定調査票概況調査サービスの状況
            ON 認定調査票概況調査サービスの状況."shinseishoKanriNo" = 要介護認定申請情報."shinseishoKanriNo"
            AND 要介護認定申請情報."koroshoIfShikibetsuCode" = 認定調査票概況調査サービスの状況."koroshoIfShikibetsuCode"
            AND NOT EXISTS (SELECT 'X' 
                                FROM rgdb."DbT4207NinteichosahyoServiceJokyo" AS D
                                WHERE 認定調査票概況調査サービスの状況."shinseishoKanriNo" = D."shinseishoKanriNo"
                                AND 認定調査票概況調査サービスの状況."koroshoIfShikibetsuCode" = D."koroshoIfShikibetsuCode"
                                AND 認定調査票概況調査サービスの状況."ninteichosaRirekiNo" &lt; D."ninteichosaRirekiNo"
                                )
        LEFT JOIN rgdb."DbT4208NinteichosahyoServiceJokyoFlag" AS 認定調査票概況調査サービスの状況フラグ
            ON 認定調査票概況調査サービスの状況フラグ."shinseishoKanriNo" = 要介護認定申請情報."shinseishoKanriNo"
            AND 要介護認定申請情報."koroshoIfShikibetsuCode" = 認定調査票概況調査サービスの状況フラグ."koroshoIfShikibetsuCode"
            AND NOT EXISTS (SELECT 'X' 
                                FROM rgdb."DbT4208NinteichosahyoServiceJokyoFlag" AS E
                                WHERE 認定調査票概況調査サービスの状況フラグ."shinseishoKanriNo" = E."shinseishoKanriNo"
                                AND 認定調査票概況調査サービスの状況フラグ."koroshoIfShikibetsuCode" = E."koroshoIfShikibetsuCode"
                                AND 認定調査票概況調査サービスの状況フラグ."ninteichosaRirekiNo" &lt; E."ninteichosaRirekiNo"
                                )
        LEFT JOIN rgdb."DbT4209NinteichosahyoKinyuItem" AS 認定調査票概況調査記入項目
            ON 認定調査票概況調査記入項目."shinseishoKanriNo" = 要介護認定申請情報."shinseishoKanriNo"
            AND 要介護認定申請情報."koroshoIfShikibetsuCode" = 認定調査票概況調査記入項目."koroshoIfShikibetsuCode"
                        AND NOT EXISTS (SELECT 'X' 
                                FROM rgdb."DbT4209NinteichosahyoKinyuItem" AS F
                                WHERE 認定調査票概況調査記入項目."shinseishoKanriNo" = F."shinseishoKanriNo"
                                AND 認定調査票概況調査記入項目."koroshoIfShikibetsuCode" = F."koroshoIfShikibetsuCode"
                                AND 認定調査票概況調査記入項目."ninteichosaRirekiNo" &lt; F."ninteichosaRirekiNo"
                                )
        LEFT JOIN rgdb."DbT4210NinteichosahyoShisetsuRiyo" AS 認定調査票概況調査施設利用
            ON 認定調査票概況調査施設利用."shinseishoKanriNo" = 要介護認定申請情報."shinseishoKanriNo"
            AND 要介護認定申請情報."koroshoIfShikibetsuCode" = 認定調査票概況調査施設利用."koroshoIfShikibetsuCode"
            AND NOT EXISTS (SELECT 'X' 
                                FROM rgdb."DbT4210NinteichosahyoShisetsuRiyo" AS G
                                WHERE 認定調査票概況調査施設利用."shinseishoKanriNo" = G."shinseishoKanriNo"
                                AND 認定調査票概況調査施設利用."koroshoIfShikibetsuCode" = G."koroshoIfShikibetsuCode"
                                AND 認定調査票概況調査施設利用."ninteichosaRirekiNo" &lt; G."ninteichosaRirekiNo"
                                )
        LEFT JOIN rgdb."DbT4203NinteichosahyoKihonChosa" AS 認定調査票基本調査
            ON 認定調査票基本調査."shinseishoKanriNo" = 要介護認定申請情報."shinseishoKanriNo"
            AND 要介護認定申請情報."koroshoIfShikibetsuCode" = 認定調査票基本調査."koroshoIfShikibetsuCode"
            AND NOT EXISTS (SELECT 'X' 
                                FROM rgdb."DbT4203NinteichosahyoKihonChosa" AS H
                                WHERE 認定調査票基本調査."shinseishoKanriNo" = H."shinseishoKanriNo"
                                AND 認定調査票基本調査."koroshoIfShikibetsuCode" = H."koroshoIfShikibetsuCode"
                                AND 認定調査票基本調査."ninteichosaRirekiNo" &lt; H."ninteichosaRirekiNo"
                                )
        LEFT JOIN rgdb."DbT4211NinteichosahyoChosaItem" AS 認定調査票基本調査調査項目
            ON 認定調査票基本調査調査項目."shinseishoKanriNo" = 要介護認定申請情報."shinseishoKanriNo"
            AND 要介護認定申請情報."koroshoIfShikibetsuCode" = 認定調査票基本調査調査項目."koroshoIfShikibetsuCode"
            AND NOT EXISTS (SELECT 'X'
                                FROM rgdb."DbT4211NinteichosahyoChosaItem" AS I
                                WHERE 認定調査票基本調査調査項目."shinseishoKanriNo" = I."shinseishoKanriNo"
                                AND 認定調査票基本調査調査項目."koroshoIfShikibetsuCode" = I."koroshoIfShikibetsuCode"
                                AND 認定調査票基本調査調査項目."ninteichosaRirekiNo" &lt; I."ninteichosaRirekiNo"
                                )
        LEFT JOIN rgdb."DbT4205NinteichosahyoTokkijiko" AS 認定調査票特記情報
            ON 認定調査票特記情報."shinseishoKanriNo" = 要介護認定申請情報."shinseishoKanriNo"
            AND 認定調査票特記情報."tokkijikoTextImageKubun" = #{特記事項テキストイメージ区分}
            AND NOT EXISTS (SELECT 'X'
                                FROM rgdb."DbT4205NinteichosahyoTokkijiko" AS J
                                WHERE 認定調査票特記情報."shinseishoKanriNo" =J."shinseishoKanriNo"
                                AND 認定調査票特記情報."ninteichosaRirekiNo" &lt; J."ninteichosaRirekiNo"
                                )
        WHERE
	    要介護認定完了情報."ninteiShinseiJohoTorokuKanryoYMD" IS NOT null
            AND	要介護認定完了情報."ninteiShinsakaiWariateKanryoYMD" IS null
            AND	要介護認定完了情報."ninteiShinsakaiKanryoYMD" IS null
            AND	要介護認定完了情報."centerSoshinYMD" IS null
            AND	要介護認定申請情報."shinseishoKanriNo" IN 
            <foreach item="申請書番号" index="index" collection="申請書管理番号" open="(" separator="," close=")">
                #{申請書番号}
            </foreach>
            AND	要介護認定申請情報."shoriJotaiKubun" IN ('0','3')
            AND	要介護認定申請情報."logicalDeletedFlag" = FALSE
        ORDER BY 被保険者氏名カナ, 認定申請年月日, 証記載保険者番号,	
                        サービスの状況連番, サービスの状況フラグ連番, 記入項目連番, 施設利用連番, 調査項目連番, 認定調査特記事項番号, 認定調査特記事項連番
    </select>

    <select resultOrdered="true" id="get認定調査依頼情報の取得"
            resultType = "jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT4201NinteichosaIraiJohoEntity"
            parameterType = "jp.co.ndensan.reams.uz.uza.lang.RString"
            fetchSize="500">
        SELECT A.*
        FROM rgdb."DbT4201NinteichosaIraiJoho" AS A 
        WHERE 
        A."shinseishoKanriNo" = #{shinseishoKanriNo}
        AND A."ninteichosaIraiRirekiNo" = 
              (SELECT MAX(B."ninteichosaIraiRirekiNo") FROM rgdb."DbT4201NinteichosaIraiJoho" AS B WHERE B."shinseishoKanriNo" = #{shinseishoKanriNo})
        AND A."logicalDeletedFlag" = FALSE
    </select>

    <select resultOrdered="true" id="get要介護認定申請情報の取得"
            resultType = "jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT4101NinteiShinseiJohoEntity"
            parameterType = "jp.co.ndensan.reams.uz.uza.lang.RString"
            fetchSize="500">
        SELECT A.*
        FROM rgdb."DbT4101NinteiShinseiJoho" AS A 
        WHERE 
        A."shinseishoKanriNo" = #{shinseishoKanriNo}
    </select>
    
    <select resultOrdered="true" id="get受給者台帳情報"
            resultType = "jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT4001JukyushaDaichoEntity"
            parameterType = "jp.co.ndensan.reams.uz.uza.lang.RString"
            fetchSize="500">
        SELECT A.*
        FROM rgdb."DbV4001JukyushaDaicho" AS A 
        WHERE 
        A."shinseishoKanriNo" = #{shinseishoKanriNo}
    </select>
</mapper>
