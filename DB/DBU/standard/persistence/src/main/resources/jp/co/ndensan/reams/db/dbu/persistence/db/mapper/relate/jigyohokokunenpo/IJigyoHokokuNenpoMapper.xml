<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- @reamsid_L DBU-1060-050 zhengshukai -->
<mapper namespace="jp.co.ndensan.reams.db.dbu.persistence.db.mapper.relate.jigyohokokunenpo.IJigyoHokokuNenpoMapper">

    <resultMap id="getJigyoHokokuNenpoListResultMap" type="jp.co.ndensan.reams.db.dbu.entity.db.basic.DbT7021JigyoHokokuTokeiDataEntity" autoMapping="true">
        <id property="hokokuYSeireki" column="hokokuYSeireki"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler" />
        <id property="hokokuM" column="hokokuM"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <id property="shukeiTaishoYSeireki" column="shukeiTaishoYSeireki"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler" />
        <id property="shukeiTaishoM" column="shukeiTaishoM"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <id property="toukeiTaishoKubun" column="toukeiTaishoKubun"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <id property="shichosonCode" column="shichosonCode"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler" />
        <id property="hyoNo" column="hyoNo"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
        <id property="shukeiNo" column="shukeiNo"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
    </resultMap>

    <select resultOrdered="true" id="getJigyoHokokuNenpoList" resultMap="getJigyoHokokuNenpoListResultMap"
            parameterType="jp.co.ndensan.reams.db.dbu.definition.mybatisprm.jigyohokokunenpo.JigyoHokokuNenpoParameter" fetchSize="500">
        SELECT
        DISTINCT
        jigyoHokokuTokeiData."hokokuYSeireki" AS "hokokuYSeireki",
        jigyoHokokuTokeiData."hokokuM" AS "hokokuM",
        jigyoHokokuTokeiData."shukeiTaishoYSeireki" AS "shukeiTaishoYSeireki",
        jigyoHokokuTokeiData."shukeiTaishoM" AS "shukeiTaishoM",
        jigyoHokokuTokeiData."toukeiTaishoKubun" AS "toukeiTaishoKubun",
        jigyoHokokuTokeiData."shichosonCode" AS "shichosonCode",
        jigyoHokokuTokeiData."hyoNo" AS "hyoNo",
        jigyoHokokuTokeiData."shukeiNo" AS "shukeiNo"
        FROM
        rgdb."DbT7021JigyoHokokuTokeiData" AS jigyoHokokuTokeiData
        WHERE
        jigyoHokokuTokeiData."isDeleted" = false
        AND
        jigyoHokokuTokeiData."hokokuM" = '00'
        <choose>
            <when test="usehokokuYSeireki">
                AND jigyoHokokuTokeiData."hokokuYSeireki" = #{hokokuYSeireki}
            </when>
        </choose>
        <choose>
            <when test="usehokensilyakbn">
                AND jigyoHokokuTokeiData."toukeiTaishoKubun" = #{hokensilyakbn}
                <if test="usehokensilyakbnShichoson">
                    AND (
                    (
                    jigyoHokokuTokeiData."hyoNo" = '01'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" = '0400'
                    )
                    OR(
                    jigyoHokokuTokeiData."hyoNo" = '02'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" IN ('0601', '0602', '0603')
                    )
                    OR(
                    jigyoHokokuTokeiData."hyoNo" = '08'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" IN ('0100', '0200')
                    )
                    )
                </if>
                <if test="usehokensilyakbnKyuShichoson">
                    AND (
                    (
                    jigyoHokokuTokeiData."hyoNo" = '11'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" = '0400'
                    )
                    OR(
                    jigyoHokokuTokeiData."hyoNo" = '12'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" IN ('0601', '0602', '0603')
                    )
                    OR(
                    jigyoHokokuTokeiData."hyoNo" = '18'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" IN ('0100', '0200')
                    )
                    )
                </if>
            </when>
        </choose>
        <choose>
            <when test="useshichosonCode">
                AND jigyoHokokuTokeiData."shichosonCode" = #{shichosonCode}
            </when>
        </choose>
        GROUP BY "hokokuYSeireki","hokokuM","shukeiTaishoYSeireki","shukeiTaishoM","toukeiTaishoKubun","shichosonCode","hyoNo", "shukeiNo"
        ORDER BY
        jigyoHokokuTokeiData."shichosonCode" ASC,
        jigyoHokokuTokeiData."hokokuYSeireki" DESC,
        jigyoHokokuTokeiData."shukeiNo" ASC
    </select>
</mapper>