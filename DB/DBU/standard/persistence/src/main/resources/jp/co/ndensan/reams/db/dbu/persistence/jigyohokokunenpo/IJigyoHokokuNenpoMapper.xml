<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="jp.co.ndensan.reams.db.dbu.persistence.jigyohokokunenpo.IJigyoHokokuNenpoMapper">

    <resultMap id="getJigyoHokokuNenpoListResultMap" type="jp.co.ndensan.reams.db.dbu.entity.db.basic.DbT7021JigyoHokokuTokeiDataEntity" autoMapping="true">
        <id property="hokokuYSeireki" column="hokokuYSeireki"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler" />
        <id property="hokokuM" column="hokokuM"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <id property="shukeiTaishoYSeireki" column="shukeiTaishoYSeireki"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler" />
        <id property="shukeiTaishoM" column="shukeiTaishoM"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <id property="toukeiTaishoKubun" column="toukeiTaishoKubun"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler" />
        <id property="shichosonCode" column="shichosonCode"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler" />
        <id property="hyoNo" column="hyoNo"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
        <id property="shukeiNo" column="shukeiNo"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
        <id property="shukeiTani" column="shukeiTani"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
        <id property="tateNo" column="tateNo"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler" />
        <id property="yokoNo" column="yokoNo"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler" />
        <result property="shukeiKekkaAtai" column="shukeiKekkaAtai"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler" />
        <result property="tateKomokuCode" column="tateKomokuCode"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
        <result property="yokoKomokuCode" column="yokoKomokuCode"  typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler" />
    </resultMap>

    <select id="getJigyoHokokuNenpoList" resultMap="getJigyoHokokuNenpoListResultMap"
            parameterType="jp.co.ndensan.reams.db.dbu.definition.jigyohokokunenpo.JigyoHokokuNenpoParameter" fetchSize="500">
        SELECT
        DISTINCT
        jigyoHokokuTokeiData."hokokuYSeireki" AS "hokokuYSeireki",
        jigyoHokokuTokeiData."hokokuM" AS "hokokuM",
        jigyoHokokuTokeiData."shukeiTaishoYSeireki" AS "shukeiTaishoYSeireki",
        jigyoHokokuTokeiData."shukeiTaishoM" AS "shukeiTaishoM",
        jigyoHokokuTokeiData."toukeiTaishoKubun" AS "toukeiTaishoKubun",
        jigyoHokokuTokeiData."shichosonCode" AS "shichosonCode",
        jigyoHokokuTokeiData."hyoNo" AS "hyoNo",
        jigyoHokokuTokeiData."shukeiNo" AS "shukeiNo",
        jigyoHokokuTokeiData."shukeiTani" AS "shukeiTani",
        jigyoHokokuTokeiData."tateNo" AS "tateNo",
        jigyoHokokuTokeiData."yokoNo" AS "yokoNo",
        jigyoHokokuTokeiData."shukeiKekkaAtai" AS "shukeiKekkaAtai",
        jigyoHokokuTokeiData."tateKomokuCode" AS "tateKomokuCode",
        jigyoHokokuTokeiData."yokoKomokuCode" AS "yokoKomokuCode"
        FROM
        rgdb."DbT7021JigyoHokokuTokeiData" AS jigyoHokokuTokeiData
        WHERE
        jigyoHokokuTokeiData."isDeleted" = false
        AND
        jigyoHokokuTokeiData."hokokuM" = '00'
        <choose>
            <when test="usehokokuYSeireki">
                AND jigyoHokokuTokeiData."hokokuYSeireki" = #{hokokuYSeireki}
            </when>
        </choose>
        <choose>
            <when test="usehokensilyakbn">
                AND jigyoHokokuTokeiData."toukeiTaishoKubun" = #{hokensilyakbn}
                <if test="usehokensilyakbnShichoson">
                    AND (
                    (
                    jigyoHokokuTokeiData."hyoNo" = '01'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" = '0400'
                    )
                    OR(
                    jigyoHokokuTokeiData."hyoNo" = '02'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" IN ('0601', '0602', '0603')
                    )
                    OR(
                    jigyoHokokuTokeiData."hyoNo" = '08'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" IN ('0100', '0200')
                    )
                    )
                </if>
                <if test="usehokensilyakbnKyuShichoson">
                    AND (
                    (
                    jigyoHokokuTokeiData."hyoNo" = '11'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" = '0400'
                    )
                    OR(
                    jigyoHokokuTokeiData."hyoNo" = '12'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" IN ('0601', '0602', '0603')
                    )
                    OR(
                    jigyoHokokuTokeiData."hyoNo" = '18'
                    AND
                    jigyoHokokuTokeiData."shukeiNo" IN ('0100', '0200')
                    )
                    )
                </if>
            </when>
        </choose>
        <choose>
            <when test="useshichosonCode">
                AND jigyoHokokuTokeiData."shichosonCode" = #{shichosonCode}
            </when>
        </choose>
        ORDER BY
        jigyoHokokuTokeiData."shichosonCode" ASC,
        jigyoHokokuTokeiData."hokokuYSeireki" DESC,
        jigyoHokokuTokeiData."shukeiNo" ASC
    </select>
</mapper>