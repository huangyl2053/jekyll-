<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 徴収方法変更のマッピング用XMLです。 -->
<!-- @reamsid_L DBB-1760-030 sunhui -->
<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbb.persistence.db.mapper.relate.kanri.IChosyuHohoHenkoMapper">
    
    <resultMap id="ChoshuHohoEntity"  type="jp.co.ndensan.reams.db.dbb.entity.db.relate.choshuhoho.ChoshuHohoEntity" autoMapping="true">
        <result property="choshuHoho3gat" column="choshuHoho3gat" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <association property="entity" 
                     resultMap="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2001ChoshuHohoMapper.ResultMap_DbT2001ChoshuHohoEntity"/>
    </resultMap>

    <select id="selectChosyuHoho" parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.kanri.ChosyuHohoHenkoMapperParameter" 
     resultMap="ChoshuHohoEntity"  fetchSize="500"  resultOrdered="true">
          SELECT
             T1.*,
             T2."choshuHoho3gat" AS "choshuHoho3gat"
        FROM
            (   SELECT
                    rgdb."DbT2001ChoshuHoho".*
                FROM rgdb."DbT2001ChoshuHoho"
                WHERE
                    rgdb."DbT2001ChoshuHoho"."fukaNendo" = #{fukaNendo}
                AND rgdb."DbT2001ChoshuHoho"."hihokenshaNo" = #{hihokenshaNo}
                ORDER BY rgdb."DbT2001ChoshuHoho"."rirekiNo" DESC Limit 1
            ) AS T1
        LEFT OUTER JOIN
            ( SELECT
                    "fukaNendo"         AS "fukaNendo" ,
                    "hihokenshaNo"      AS "hihokenshaNo" ,
                    "rirekiNo"          AS "rirekiNo" ,
                    "choshuHoho3gatsu"  AS "choshuHoho3gat" 
              FROM rgdb."DbT2001ChoshuHoho"
              WHERE
                "fukaNendo" = #{fukaNendoBak}
                AND "hihokenshaNo" = #{hihokenshaNo}
                ORDER BY "rirekiNo" DESC Limit 1
            )AS T2
        ON T1."hihokenshaNo" = T2."hihokenshaNo"
    </select>
</mapper>