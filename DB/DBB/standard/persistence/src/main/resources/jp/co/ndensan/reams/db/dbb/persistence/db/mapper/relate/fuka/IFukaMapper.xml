<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 介護賦課のマッピング用XMLです。 -->

<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbb.persistence.db.mapper.relate.fuka.IFukaMapper">
    
    <!-- RelateEntityを取得できるSQL。 -->
    <select resultOrdered="true" id="select介護賦課ByKey" resultMap="resultMap_FukaEntity" parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.fuka.FukaMapperParameter" fetchSize="500">
        SELECT
        dbT2002Fuka.*,
        dbT2003Kibetsu.*
        FROM
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.allColumns_DbT2002Fuka" />
        FROM
        rgdb."DbT2002Fuka"
        WHERE
        "choteiNendo" = #{choteiNendo}
        AND
        "fukaNendo" = #{fukaNendo}
        AND
        "tsuchishoNo" = #{tsuchishoNo}
        AND
        "rirekiNo" = #{rirekiNo}
        )
        AS dbT2002Fuka
        
        INNER JOIN
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2003KibetsuMapper.allColumns_DbT2003Kibetsu"/>
        FROM
        rgdb."DbT2003Kibetsu"
        )
        AS dbT2003Kibetsu
        ON
        dbT2002Fuka."dbT2002Fuka_choteiNendo" = dbT2003Kibetsu."dbT2003Kibetsu_choteiNendo"
        AND
        dbT2002Fuka."dbT2002Fuka_fukaNendo" = dbT2003Kibetsu."dbT2003Kibetsu_fukaNendo"
        AND
        dbT2002Fuka."dbT2002Fuka_tsuchishoNo" = dbT2003Kibetsu."dbT2003Kibetsu_tsuchishoNo"
        AND
        dbT2002Fuka."dbT2002Fuka_rirekiNo" = dbT2003Kibetsu."dbT2003Kibetsu_rirekiNo"
        
    </select>
        
    <!-- RelateEntityを取得できるSQL。 -->
    <select resultOrdered="true" id="select介護賦課リストBy主キー1" resultMap="resultMap_FukaEntity" parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.fuka.FukaMapperParameter" fetchSize="500">
        SELECT
        dbT2002Fuka.*,
        dbT2003Kibetsu.*
        FROM
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.allColumns_DbT2002Fuka" />
        FROM
        rgdb."DbT2002Fuka"
        WHERE
        "choteiNendo" = #{choteiNendo}
        AND
        "fukaNendo" = #{fukaNendo}
        AND
        "tsuchishoNo" = #{tsuchishoNo}
        AND
        "rirekiNo" = #{rirekiNo}
        )
        AS dbT2002Fuka
        
        INNER JOIN
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2003KibetsuMapper.allColumns_DbT2003Kibetsu"/>
        FROM
        rgdb."DbT2003Kibetsu"
        )
        AS dbT2003Kibetsu
        ON
        dbT2002Fuka."dbT2002Fuka_choteiNendo" = dbT2003Kibetsu."dbT2003Kibetsu_choteiNendo"
        AND
        dbT2002Fuka."dbT2002Fuka_fukaNendo" = dbT2003Kibetsu."dbT2003Kibetsu_fukaNendo"
        AND
        dbT2002Fuka."dbT2002Fuka_tsuchishoNo" = dbT2003Kibetsu."dbT2003Kibetsu_tsuchishoNo"
        AND
        dbT2002Fuka."dbT2002Fuka_rirekiNo" = dbT2003Kibetsu."dbT2003Kibetsu_rirekiNo"
        
    </select>

    <!-- RelateEntityを取得できるSQL。 -->
    <select resultOrdered="true" id="getFukaEntity" resultMap="resultMap_FukaEntity" parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.fuka.FukaMapperParameter" fetchSize="500">
        SELECT
        dbT2002Fuka.*,
        dbT2003Kibetsu.*
        FROM
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.allColumns_DbT2002Fuka" />
        FROM
        rgdb."DbT2002Fuka"
        WHERE
        "choteiNendo" = #{choteiNendo}
        AND
        "fukaNendo" = #{fukaNendo}
        AND
        "tsuchishoNo" = #{tsuchishoNo}
        AND
        "rirekiNo" = #{rirekiNo}
        )
        AS dbT2002Fuka
        
        INNER JOIN
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2003KibetsuMapper.allColumns_DbT2003Kibetsu"/>
        FROM
        rgdb."DbT2003Kibetsu"
        )
        AS dbT2003Kibetsu
        ON
        dbT2002Fuka."dbT2002Fuka_choteiNendo" = dbT2003Kibetsu."dbT2003Kibetsu_choteiNendo"
        AND
        dbT2002Fuka."dbT2002Fuka_fukaNendo" = dbT2003Kibetsu."dbT2003Kibetsu_fukaNendo"
        AND
        dbT2002Fuka."dbT2002Fuka_tsuchishoNo" = dbT2003Kibetsu."dbT2003Kibetsu_tsuchishoNo"
        AND
        dbT2002Fuka."dbT2002Fuka_rirekiNo" = dbT2003Kibetsu."dbT2003Kibetsu_rirekiNo"
        
    </select>

    
    <resultMap id="resultMap_FukaEntity" type="jp.co.ndensan.reams.db.dbb.entity.db.relate.fuka.FukaEntity" autoMapping="true">
        <id property="介護賦課Entity.choteiNendo" column="dbT2002Fuka_choteiNendo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler"/>
        <id property="介護賦課Entity.fukaNendo" column="dbT2002Fuka_fukaNendo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler"/>
        <id property="介護賦課Entity.tsuchishoNo" column="dbT2002Fuka_tsuchishoNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.TsuchishoNoTypeHandler"/>
        <id property="介護賦課Entity.rirekiNo" column="dbT2002Fuka_rirekiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <association property="介護賦課Entity" 
                     resultMap="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.ResultMap_DbT2002FukaEntity"/>
        <collection property="介護期別Entity" 
                    resultMap="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2003KibetsuMapper.ResultMap_DbT2003KibetsuEntity"/>
    </resultMap>
    
    <sql id="FukaRowNumber">
        
        SELECT  
            row_number() over(order by "fukaNendo" , "choteiNendo" ,"tsuchishoNo", "rirekiNo") as rownum,
            *
        FROM 
            rgdb."DbT2002Fuka"
        WHERE 
            "tsuchishoNo" = #{tsuchishoNo}
        AND "fukaNendo" <![CDATA[<=]]> #{fukaNendo}
    </sql>

    <!-- RelateEntityを取得できるSQL。 -->
    <select resultOrdered="true" id="get前賦課履歴" resultMap="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.ResultMap_DbT2002FukaEntity" parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.fuka.FukaMapperParameter" fetchSize="500">
        SELECT
            <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.allColumns_DbT2002Fuka" />
        FROM  (<include refid="FukaRowNumber" />) As "DbT2002Fuka"
        WHERE "DbT2002Fuka".rownum <![CDATA[<]]>
        (
        SELECT
            A.rownum
        FROM
            (<include refid="FukaRowNumber" />) as A
        WHERE
                A."choteiNendo" = #{choteiNendo}
            AND A."fukaNendo" =   #{fukaNendo}
            AND A."tsuchishoNo" = #{tsuchishoNo}
            AND A."rirekiNo" =    #{rirekiNo}
        )
        ORDER BY "DbT2002Fuka".rownum DESC
    </select>

</mapper>