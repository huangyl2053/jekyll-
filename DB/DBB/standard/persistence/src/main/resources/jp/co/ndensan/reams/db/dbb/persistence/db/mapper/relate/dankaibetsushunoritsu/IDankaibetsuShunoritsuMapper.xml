<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： バッチ設計_DBB210030_保険料段階別収納率一覧表作成 用XMLです。 --> 
<!-- @reamsid_L DBB-1630-020 tianshuai -->

<mapper namespace="jp.co.ndensan.reams.db.dbb.persistence.db.mapper.relate.dankaibetsushunoritsu.IDankaibetsuShunoritsuMapper">
    <select id="get収納宛名データ" resultMap="resultMap_ShunyuTaishoData"
            parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.dankaibetsushunoritsu.InsDankaibetsuShunoritsuTmpMybatisParamter" 
            fetchSize="500" resultOrdered="true">
        SELECT
            <include refid="jp.co.ndensan.reams.ca.cax.persistence.db.mapper.psm.ICaFt702FindTotalShunyuFunctionMapper.columns_TotalShunyu"/>,
            <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.columns_ShikibetsuTaisho"/>,
            "DbV2002Fuka".*,
            "DbT1001HihokenshaDaicho".*,
            "DbT4001JukyushaDaicho".*
            <!--"DbT3017KyufujissekiKihon".*-->
        FROM
        rgca.${psmTotalShunyu} AS "TotalShunyu"
        INNER JOIN
        rgua."UaFt200FindShikibetsuTaisho"('','',true,'DB',false,'','','','','','','','','','','',true,
        '','','','','','','',true,'','','','','','','','','','','',true,true,true,true,true,true,true,true,true,true,
        true,'','','','','','','','',true,'','',true,true,true,'','','','','','','','','','','','','','','','','','','{}') AS "ShikibetsuTaisho"
        ON "ShikibetsuTaisho"."shikibetsuCode" = "TotalShunyu"."UrT0700shikibetsuCode"
        AND "ShikibetsuTaisho"."seinengappiYMD" <![CDATA[>=]]> #{開始生年月日}
        AND "ShikibetsuTaisho"."seinengappiYMD" <![CDATA[<=]]> #{終了生年月日}
        <if test="広域判定区分.toString() == '120' and 選択対象区分.toString() == '町域' and 選択対象リスト != null and !選択対象リスト.isEmpty()"> 
            AND "ShikibetsuTaisho"."choikiCode" IN
            <foreach item="選択対象リスト" index="index" collection="選択対象リスト"
                     open="(" separator="," close=")">
                #{選択対象リスト}
            </foreach>
        </if>
        <if test="広域判定区分.toString() == '120' and 選択対象区分.toString() == '行政区' and 選択対象リスト != null and !選択対象リスト.isEmpty()"> 
            AND "ShikibetsuTaisho"."gyoseikuCode" IN
            <foreach item="選択対象リスト" index="index" collection="選択対象リスト"
                     open="(" separator="," close=")">
                #{選択対象リスト}
            </foreach>
        </if>
        <if test="広域判定区分.toString() == '120' and 選択対象区分.toString() == '地区コード1' and 選択対象リスト != null and !選択対象リスト.isEmpty()"> 
            AND "ShikibetsuTaisho"."chikuCode1" IN
            <foreach item="選択対象リスト" index="index" collection="選択対象リスト"
                     open="(" separator="," close=")">
                #{選択対象リスト}
            </foreach>
        </if>
        <if test="広域判定区分.toString() == '120' and 選択対象区分.toString() == '地区コード2' and 選択対象リスト != null and !選択対象リスト.isEmpty()"> 
            AND "ShikibetsuTaisho"."chikuCode2" IN
            <foreach item="選択対象リスト" index="index" collection="選択対象リスト"
                     open="(" separator="," close=")">
                #{選択対象リスト}
            </foreach>
        </if>
        <if test="広域判定区分.toString() == '120' and 選択対象区分.toString() == '地区コード3' and 選択対象リスト != null and !選択対象リスト.isEmpty()"> 
            AND "ShikibetsuTaisho"."chikuCode3" IN
            <foreach item="選択対象リスト" index="index" collection="選択対象リスト"
                     open="(" separator="," close=")">
                #{選択対象リスト}
            </foreach>
        </if>
        INNER JOIN
        (<include refid="jp.co.ndensan.reams.db.dbb.persistence.db.mapper.relate.fuka.IFukaJohoRelateMapper.noDeleted_DbV2002Fuka" />) AS "DbV2002Fuka"
        ON "DbV2002Fuka"."dbT2002Fuka_choteiNendo" <![CDATA[>=]]> #{開始調定年度}
        AND "DbV2002Fuka"."dbT2002Fuka_choteiNendo" <![CDATA[<=]]> #{終了調定年度}
        AND "DbV2002Fuka"."dbT2002Fuka_fukaNendo" <![CDATA[>=]]> #{開始賦課年度}
        AND "DbV2002Fuka"."dbT2002Fuka_fukaNendo" <![CDATA[<=]]> #{終了賦課年度}
        AND "DbV2002Fuka"."dbT2002Fuka_choteiNendo" = "TotalShunyu"."UrT0700choteiNendo"
        AND "DbV2002Fuka"."dbT2002Fuka_fukaNendo" = "TotalShunyu"."UrT0700kazeiNendo"
        AND (CAST("DbV2002Fuka" . "dbT2002Fuka_tsuchishoNo" AS numeric)) = "TotalShunyu" . "UrT0700tsuchishoNo"
        LEFT JOIN
        (<include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1001HihokenshaDaichoMapper.noDeleted_DbT1001HihokenshaDaicho" />) AS "DbT1001HihokenshaDaicho"
        ON "DbT1001HihokenshaDaicho"."dbT1001HihokenshaDaicho_hihokenshaNo" = "DbV2002Fuka"."dbT2002Fuka_hihokenshaNo"
        AND (("DbT1001HihokenshaDaicho"."dbT1001HihokenshaDaicho_ichigoShikakuShutokuYMD" <![CDATA[<=]]> "DbV2002Fuka"."dbT2002Fuka_fukaYMD"
        AND "DbT1001HihokenshaDaicho"."dbT1001HihokenshaDaicho_shikakuSoshitsuYMD" = null)
        OR ("DbT1001HihokenshaDaicho"."dbT1001HihokenshaDaicho_ichigoShikakuShutokuYMD" <![CDATA[<=]]> "DbV2002Fuka"."dbT2002Fuka_fukaYMD"
        AND "DbT1001HihokenshaDaicho"."dbT1001HihokenshaDaicho_shikakuSoshitsuYMD" <![CDATA[>]]> "DbV2002Fuka"."dbT2002Fuka_fukaYMD"))
        LEFT JOIN
        (<include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT4001JukyushaDaichoMapper.noDeleted_DbT4001JukyushaDaicho" />) AS "DbT4001JukyushaDaicho"
        ON "DbT4001JukyushaDaicho"."dbT4001JukyushaDaicho_ninteiYukoKikanKaishiYMD" <![CDATA[<=]]> #{基準年月}
        AND "DbT4001JukyushaDaicho"."dbT4001JukyushaDaicho_ninteiYukoKikanShuryoYMD" <![CDATA[>=]]> #{基準年月}
<!--        LEFT JOIN
        rgdb."DbT3017KyufujissekiKihon" AS "DbT3017KyufujissekiKihon"
        ON "DbT3017KyufujissekiKihon"."serviceTeikyoYM" = #{基準年月}-->
        ORDER BY
        "TotalShunyu"."UrT0700shunoId",
        "ShikibetsuTaisho"."shikibetsuCode",
        "DbV2002Fuka" . "dbT2002Fuka_choteiNendo",
        "DbV2002Fuka" . "dbT2002Fuka_fukaNendo",
        "DbV2002Fuka" . "dbT2002Fuka_tsuchishoNo",
        "DbV2002Fuka" . "dbT2002Fuka_rirekiNo"
    </select>

    <select id="select保険料段階別収納率一覧表"  resultType="jp.co.ndensan.reams.db.dbb.entity.db.relate.dankaibetsushunoritsu.DankaibetsuShunoritsuTempEntity"
            parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.dankaibetsushunoritsu.PrtDankaibetsuShunoritsuIchiranhyoMybatisParamter" 
            fetchSize="500" resultOrdered="true">
        SELECT
        "TEMP".*
        FROM "DankaibetsuShunoritsuTemp" AS "TEMP"
        WHERE 1 = 1
        <if test="広域判定区分.toString() == '111' and 市町村情報.toString() != '000000'"> 
            AND "TEMP"."lasdecCode" = #{市町村情報}
            AND "TEMP"."lasdecCode" = "TEMP"."fukaLasdecCode"
        </if>
        <if test="抽出条件.toString() == '2'">
            AND "TEMP"."taishouKubun" = '認定者'
        </if>
        <if test="抽出条件.toString() == '4'"> 
            AND "TEMP"."taishouKubun" <![CDATA[<>]]> '認定者'
        </if>
        <if test="抽出条件.toString() == '3'"> 
            AND "TEMP"."taishouKubun" = '受給者'
        </if>
        ORDER BY
        "TEMP"."choteiNendo" DESC,
        "TEMP"."fukaNendo" DESC,
        "TEMP"."kamokuCode" ASC,
        "TEMP"."lasdecCode" ASC,
        "TEMP"."kibetsu" ASC,
        "TEMP"."tsuchishoNo" ASC
    </select>

    <resultMap id="resultMap_ShunyuTaishoData" type="jp.co.ndensan.reams.db.dbb.entity.db.relate.dankaibetsushunoritsu.DankaibetsuShunoritsuDataEntity" autoMapping="true">
        <id column="UrT0700shunoId"/>
        <association property="収入情報取得PSM" resultMap="jp.co.ndensan.reams.ca.cax.persistence.db.mapper.psm.ICaFt702FindTotalShunyuFunctionMapper.totalShunyuResult"/>
        <association property="宛名" resultMap="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.UaFt200FindShikibetsuTaishoEntity"/>
        <association property="介護賦課" resultMap="ResultMap_DbV2002FukaEntity"/>
        <collection property="被保険者台帳"
                    resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1001HihokenshaDaichoMapper.ResultMap_DbT1001HihokenshaDaichoEntity"/>
        <collection property="受給者台帳"
                    resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT4001JukyushaDaichoMapper.ResultMap_DbT4001JukyushaDaichoEntity"/>
    </resultMap>

     <resultMap id="ResultMap_DbV2002FukaEntity" type="jp.co.ndensan.reams.db.dbx.entity.db.basic.DbT2002FukaEntity" autoMapping="true">
        <result property="choteiNendo" column="dbT2002Fuka_choteiNendo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler"/>
        <result property="fukaNendo" column="dbT2002Fuka_fukaNendo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler"/>
        <result property="tsuchishoNo" column="dbT2002Fuka_tsuchishoNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.TsuchishoNoTypeHandler"/>
        <result property="rirekiNo" column="dbT2002Fuka_rirekiNo" />
        <result property="insertDantaiCd" column="dbT2002Fuka_insertDantaiCd" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="insertTimestamp" column="dbT2002Fuka_insertTimestamp" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RDateTimeTypeHandler"/>
        <result property="insertReamsLoginId" column="dbT2002Fuka_insertReamsLoginId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="insertContextId" column="dbT2002Fuka_insertContextId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.UUIDTypeHandler"/>
        <result property="isDeleted" column="dbT2002Fuka_isDeleted" />
        <result property="updateCount" column="dbT2002Fuka_updateCount" />
        <result property="lastUpdateTimestamp" column="dbT2002Fuka_lastUpdateTimestamp" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RDateTimeTypeHandler"/>
        <result property="lastUpdateReamsLoginId" column="dbT2002Fuka_lastUpdateReamsLoginId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="hihokenshaNo" column="dbT2002Fuka_hihokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <result property="shikibetsuCode" column="dbT2002Fuka_shikibetsuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
        <result property="setaiCode" column="dbT2002Fuka_setaiCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.SetaiCodeTypeHandler"/>
        <result property="setaiInsu" column="dbT2002Fuka_setaiInsu" />
        <result property="shikakuShutokuYMD" column="dbT2002Fuka_shikakuShutokuYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shikakuShutokuJiyu" column="dbT2002Fuka_shikakuShutokuJiyu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shikakuSoshitsuYMD" column="dbT2002Fuka_shikakuSoshitsuYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shikakuSoshitsuJiyu" column="dbT2002Fuka_shikakuSoshitsuJiyu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="seihofujoShurui" column="dbT2002Fuka_seihofujoShurui" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="seihoKaishiYMD" column="dbT2002Fuka_seihoKaishiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="seihoHaishiYMD" column="dbT2002Fuka_seihoHaishiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="ronenKaishiYMD" column="dbT2002Fuka_ronenKaishiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="ronenHaishiYMD" column="dbT2002Fuka_ronenHaishiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="fukaYMD" column="dbT2002Fuka_fukaYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="kazeiKubun" column="dbT2002Fuka_kazeiKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="setaikazeiKubun" column="dbT2002Fuka_setaikazeiKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="gokeiShotokuGaku" column="dbT2002Fuka_gokeiShotokuGaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="nenkinShunyuGaku" column="dbT2002Fuka_nenkinShunyuGaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="hokenryoDankai" column="dbT2002Fuka_hokenryoDankai" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="hokenryoDankai1" column="dbT2002Fuka_hokenryoDankai1" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="nengakuHokenryo1" column="dbT2002Fuka_nengakuHokenryo1" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="tsukiwariStartYM1" column="dbT2002Fuka_tsukiwariStartYM1" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="tsukiwariEndYM1" column="dbT2002Fuka_tsukiwariEndYM1" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="hokenryoDankai2" column="dbT2002Fuka_hokenryoDankai2" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="nengakuHokenryo2" column="dbT2002Fuka_nengakuHokenryo2" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="tsukiwariStartYM2" column="dbT2002Fuka_tsukiwariStartYM2" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="tsukiwariEndYM2" column="dbT2002Fuka_tsukiwariEndYM2" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="choteiNichiji" column="dbT2002Fuka_choteiNichiji" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.YMDHMSTypeHandler"/>
        <result property="choteiJiyu1" column="dbT2002Fuka_choteiJiyu1" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="choteiJiyu2" column="dbT2002Fuka_choteiJiyu2" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="choteiJiyu3" column="dbT2002Fuka_choteiJiyu3" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="choteiJiyu4" column="dbT2002Fuka_choteiJiyu4" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="koseiM" column="dbT2002Fuka_koseiM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="gemmenMaeHokenryo" column="dbT2002Fuka_gemmenMaeHokenryo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="gemmenGaku" column="dbT2002Fuka_gemmenGaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="kakuteiHokenryo" column="dbT2002Fuka_kakuteiHokenryo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="hokenryoDankaiKarisanntei" column="dbT2002Fuka_hokenryoDankaiKarisanntei" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="choshuHohoRirekiNo" column="dbT2002Fuka_choshuHohoRirekiNo" />
        <result property="idoKijunNichiji" column="dbT2002Fuka_idoKijunNichiji" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.YMDHMSTypeHandler"/>
        <result property="kozaKubun" column="dbT2002Fuka_kozaKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="kyokaisoKubun" column="dbT2002Fuka_kyokaisoKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shokkenKubun" column="dbT2002Fuka_shokkenKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="fukaShichosonCode" column="dbT2002Fuka_fukaShichosonCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler"/>
        <result property="tkSaishutsuKampuGaku" column="dbT2002Fuka_tkSaishutsuKampuGaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="fuSaishutsuKampuGaku" column="dbT2002Fuka_fuSaishutsuKampuGaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
    </resultMap>
</mapper>
