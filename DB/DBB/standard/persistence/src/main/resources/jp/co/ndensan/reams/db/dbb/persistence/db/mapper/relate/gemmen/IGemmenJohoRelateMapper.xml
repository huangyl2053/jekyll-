<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 減免の情報のマッピング用XMLです。 -->
<!-- @reamsid_L DBB-9999-013 xicongwang -->

<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbb.persistence.db.mapper.relate.gemmen.IGemmenJohoRelateMapper">

    <select id="select減免の情報ByKey" resultMap="resultMap_GemmenJohoRelateEntity" 
            parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.gemmen.GemmenJohoRelateMapperParameter"
            fetchSize="500" resultOrdered="true">
        <include refid="selectGemmenJohoRelateEntity" />
    </select>

    <sql id="selectGemmenJohoRelateEntity">
        SELECT
        DbT2002Fuka.*,
        DbT2004Gemmen.*,
        DbT2003Kibetsu.*,
        UrT0705ChoteiKyotsu.*
        FROM
        (<include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.noDeleted_DbT2002Fuka" />) AS DbT2002Fuka
        LEFT JOIN
        (<include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2003KibetsuMapper.noDeleted_DbT2003Kibetsu" />) AS DbT2003Kibetsu
        ON
        DbT2002Fuka."dbT2002Fuka_choteiNendo" = DbT2003Kibetsu."dbT2003Kibetsu_choteiNendo" and
        DbT2002Fuka."dbT2002Fuka_fukaNendo" = DbT2003Kibetsu."dbT2003Kibetsu_fukaNendo" and
        DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = DbT2003Kibetsu."dbT2003Kibetsu_tsuchishoNo" and
        DbT2002Fuka."dbT2002Fuka_rirekiNo" = DbT2003Kibetsu."dbT2003Kibetsu_rirekiNo"
        LEFT JOIN
        (<include refid="jp.co.ndensan.reams.db.dbb.persistence.db.mapper.basic.IDbT2004GemmenMapper.noDeleted_DbT2004Gemmen" />) AS DbT2004Gemmen
        ON
        DbT2002Fuka."dbT2002Fuka_choteiNendo" = DbT2004Gemmen."dbT2004Gemmen_choteiNendo" and
        DbT2002Fuka."dbT2002Fuka_fukaNendo" = DbT2004Gemmen."dbT2004Gemmen_fukaNendo" and
        DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = DbT2004Gemmen."dbT2004Gemmen_tsuchishoNo" and
        DbT2002Fuka."dbT2002Fuka_rirekiNo" = DbT2004Gemmen."dbT2004Gemmen_rirekiNo"
        LEFT JOIN
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IUrT0705ChoteiKyotsuMapper.allColumns_UrT0705ChoteiKyotsu" />
        FROM
        rgdb."UrT0705ChoteiKyotsu"
        ) AS UrT0705ChoteiKyotsu
        ON
        DbT2003Kibetsu."dbT2003Kibetsu_choteiId" = UrT0705ChoteiKyotsu."urT0705ChoteiKyotsu_choteiId"
        <where>
            <if test="uses調定年度">
                AND DbT2002Fuka."dbT2002Fuka_choteiNendo" = #{調定年度}
            </if>
            <if test="uses賦課年度">
                and DbT2002Fuka."dbT2002Fuka_fukaNendo" = #{賦課年度}
            </if>
            <if test="uses通知書番号">
                and DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = #{通知書番号}
            </if>
            <if test="uses履歴番号">
                and DbT2002Fuka."dbT2002Fuka_rirekiNo" = #{履歴番号}
            </if>
        </where>
    </sql>

    <select id="select最新の減免情報ByKey" resultMap="resultMap_GemmenJohoRelateEntity" 
            parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.gemmen.GemmenJohoRelateMapperParameter"
            fetchSize="500" resultOrdered="true">
        <include refid="selectSaisnGemmenJohoRelateEntity" />
    </select>

    <sql id="selectSaisnGemmenJohoRelateEntity">
        SELECT
        DbT2002Fuka.*,
        DbT2004Gemmen.*,
        DbT2003Kibetsu.*,
        UrT0705ChoteiKyotsu.*
        FROM
        (<include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.noDeleted_DbT2002Fuka" />) AS DbT2002Fuka
        LEFT JOIN
        (<include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2003KibetsuMapper.noDeleted_DbT2003Kibetsu" />) AS DbT2003Kibetsu
        ON
        DbT2002Fuka."dbT2002Fuka_choteiNendo" = DbT2003Kibetsu."dbT2003Kibetsu_choteiNendo" and
        DbT2002Fuka."dbT2002Fuka_fukaNendo" = DbT2003Kibetsu."dbT2003Kibetsu_fukaNendo" and
        DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = DbT2003Kibetsu."dbT2003Kibetsu_tsuchishoNo" and
        DbT2002Fuka."dbT2002Fuka_rirekiNo" = DbT2003Kibetsu."dbT2003Kibetsu_rirekiNo"
        LEFT JOIN
        (<include refid="jp.co.ndensan.reams.db.dbb.persistence.db.mapper.basic.IDbT2004GemmenMapper.noDeleted_DbT2004Gemmen" />) AS DbT2004Gemmen
        ON
        DbT2002Fuka."dbT2002Fuka_choteiNendo" = DbT2004Gemmen."dbT2004Gemmen_choteiNendo" and
        DbT2002Fuka."dbT2002Fuka_fukaNendo" = DbT2004Gemmen."dbT2004Gemmen_fukaNendo" and
        DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = DbT2004Gemmen."dbT2004Gemmen_tsuchishoNo" and
        DbT2002Fuka."dbT2002Fuka_rirekiNo" = DbT2004Gemmen."dbT2004Gemmen_rirekiNo"
        LEFT JOIN
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IUrT0705ChoteiKyotsuMapper.allColumns_UrT0705ChoteiKyotsu" />
        FROM
        rgdb."UrT0705ChoteiKyotsu"
        ) AS UrT0705ChoteiKyotsu
        ON
        DbT2003Kibetsu."dbT2003Kibetsu_choteiId" = UrT0705ChoteiKyotsu."urT0705ChoteiKyotsu_choteiId"
        <where>
            <if test="uses調定年度">
                AND DbT2002Fuka."dbT2002Fuka_choteiNendo" = #{調定年度}
            </if>
            <if test="uses賦課年度">
                and DbT2002Fuka."dbT2002Fuka_fukaNendo" = #{賦課年度}
            </if>
            <if test="uses通知書番号">
                and DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = #{通知書番号}
            </if>
        </where>
        ORDER BY DbT2002Fuka."dbT2002Fuka_rirekiNo" DESC
    </sql>

    <resultMap id="resultMap_GemmenJohoRelateEntity" type="jp.co.ndensan.reams.db.dbb.entity.db.relate.gemmen.GemmenJohoRelateEntity" autoMapping="true">
        <id property="介護賦課Entity.choteiNendo" column="dbT2002Fuka_choteiNendo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler"/>
        <id property="介護賦課Entity.fukaNendo" column="dbT2002Fuka_fukaNendo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler"/>
        <id property="介護賦課Entity.tsuchishoNo" column="dbT2002Fuka_tsuchishoNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.TsuchishoNoTypeHandler"/>
        <id property="介護賦課Entity.rirekiNo" column="dbT2002Fuka_rirekiNo" />
        <association property="介護賦課Entity" resultMap="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.ResultMap_DbT2002FukaEntity"/>
        <collection property="介護期別Entity" resultMap="resultMap_KibetsuEntity"/>
        <collection property="介護賦課減免Entity" resultMap="jp.co.ndensan.reams.db.dbb.persistence.db.mapper.basic.IDbT2004GemmenMapper.ResultMap_DbT2004GemmenEntity"/>
    </resultMap>
    <resultMap id="resultMap_KibetsuEntity" type="jp.co.ndensan.reams.db.dbb.entity.db.relate.gemmen.KibetsuEntity" autoMapping="true">
        <id property="介護期別Entity.choshuHouhou" column="dbT2003Kibetsu_choshuHouhou" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id property="介護期別Entity.ki" column="dbT2003Kibetsu_ki" />
        <association property="介護期別Entity" resultMap="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2003KibetsuMapper.ResultMap_DbT2003KibetsuEntity"/>
        <collection property="調定共通EntityList" resultMap="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IUrT0705ChoteiKyotsuMapper.ResultMap_UrT0705ChoteiKyotsuEntity"/>
    </resultMap>
    
     <select id="select減免の情報_決定更正後" resultMap="resultMap_GemmenJohoRelateEntity" 
            parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.gemmen.GemmenJohoRelateSonotaMapperParameter"
            fetchSize="500" resultOrdered="true">
        SELECT
        DbT2002Fuka.*,
        DbT2004Gemmen.*,
        DbT2003Kibetsu.*,
        UrT0705ChoteiKyotsu.*
        FROM
        (<include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.noDeleted_DbT2002Fuka" />) AS DbT2002Fuka
        LEFT JOIN
        (<include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2003KibetsuMapper.noDeleted_DbT2003Kibetsu" />) AS DbT2003Kibetsu
        ON
        DbT2002Fuka."dbT2002Fuka_choteiNendo" = DbT2003Kibetsu."dbT2003Kibetsu_choteiNendo" and
        DbT2002Fuka."dbT2002Fuka_fukaNendo" = DbT2003Kibetsu."dbT2003Kibetsu_fukaNendo" and
        DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = DbT2003Kibetsu."dbT2003Kibetsu_tsuchishoNo" and
        DbT2002Fuka."dbT2002Fuka_rirekiNo" = DbT2003Kibetsu."dbT2003Kibetsu_rirekiNo"
        LEFT JOIN
        (<include refid="jp.co.ndensan.reams.db.dbb.persistence.db.mapper.basic.IDbT2004GemmenMapper.noDeleted_DbT2004Gemmen" />) AS DbT2004Gemmen
        ON
        DbT2002Fuka."dbT2002Fuka_choteiNendo" = DbT2004Gemmen."dbT2004Gemmen_choteiNendo" and
        DbT2002Fuka."dbT2002Fuka_fukaNendo" = DbT2004Gemmen."dbT2004Gemmen_fukaNendo" and
        DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = DbT2004Gemmen."dbT2004Gemmen_tsuchishoNo" and
        DbT2002Fuka."dbT2002Fuka_rirekiNo" = DbT2004Gemmen."dbT2004Gemmen_rirekiNo"
        LEFT JOIN
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IUrT0705ChoteiKyotsuMapper.allColumns_UrT0705ChoteiKyotsu" />
        FROM
        rgdb."UrT0705ChoteiKyotsu"
        ) AS UrT0705ChoteiKyotsu
        ON
        DbT2003Kibetsu."dbT2003Kibetsu_choteiId" = UrT0705ChoteiKyotsu."urT0705ChoteiKyotsu_choteiId"
        WHERE
            DbT2002Fuka."dbT2002Fuka_choteiNendo" = #{調定年度}
            AND DbT2002Fuka."dbT2002Fuka_fukaNendo" = #{賦課年度}
            AND DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = #{通知書番号}
            AND DbT2002Fuka."dbT2002Fuka_rirekiNo" = #{履歴番号}
            AND DbT2002Fuka."dbT2002Fuka_choteiNichiji" = #{調定日時}
            AND ((DbT2004Gemmen."dbT2004Gemmen_jotaiKubun" = '1'
                 AND
                 DbT2004Gemmen."dbT2004Gemmen_sakuseiKubun" = '1')
                 OR
                 ((DbT2004Gemmen."dbT2004Gemmen_jotaiKubun" = '2'
                 AND
                 DbT2004Gemmen."dbT2004Gemmen_sakuseiKubun" = '2')))
    </select>

     <select id="select減免の情報_取消更正後" resultMap="resultMap_GemmenJohoRelateEntity" 
            parameterType="jp.co.ndensan.reams.db.dbb.definition.mybatisprm.gemmen.GemmenJohoRelateSonotaMapperParameter"
            fetchSize="500" resultOrdered="true">
        SELECT
        DbT2002Fuka.*,
        DbT2004Gemmen.*,
        DbT2003Kibetsu.*,
        UrT0705ChoteiKyotsu.*
        FROM
        (<include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2002FukaMapper.noDeleted_DbT2002Fuka" />) AS DbT2002Fuka
        LEFT JOIN
        (<include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IDbT2003KibetsuMapper.noDeleted_DbT2003Kibetsu" />) AS DbT2003Kibetsu
        ON
        DbT2002Fuka."dbT2002Fuka_choteiNendo" = DbT2003Kibetsu."dbT2003Kibetsu_choteiNendo" and
        DbT2002Fuka."dbT2002Fuka_fukaNendo" = DbT2003Kibetsu."dbT2003Kibetsu_fukaNendo" and
        DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = DbT2003Kibetsu."dbT2003Kibetsu_tsuchishoNo" and
        DbT2002Fuka."dbT2002Fuka_rirekiNo" = DbT2003Kibetsu."dbT2003Kibetsu_rirekiNo"
        LEFT JOIN
        (<include refid="jp.co.ndensan.reams.db.dbb.persistence.db.mapper.basic.IDbT2004GemmenMapper.noDeleted_DbT2004Gemmen" />) AS DbT2004Gemmen
        ON
        DbT2002Fuka."dbT2002Fuka_choteiNendo" = DbT2004Gemmen."dbT2004Gemmen_choteiNendo" and
        DbT2002Fuka."dbT2002Fuka_fukaNendo" = DbT2004Gemmen."dbT2004Gemmen_fukaNendo" and
        DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = DbT2004Gemmen."dbT2004Gemmen_tsuchishoNo" and
        DbT2002Fuka."dbT2002Fuka_rirekiNo" = DbT2004Gemmen."dbT2004Gemmen_rirekiNo"
        LEFT JOIN
        (
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbx.persistence.db.mapper.basic.IUrT0705ChoteiKyotsuMapper.allColumns_UrT0705ChoteiKyotsu" />
        FROM
        rgdb."UrT0705ChoteiKyotsu"
        ) AS UrT0705ChoteiKyotsu
        ON
        DbT2003Kibetsu."dbT2003Kibetsu_choteiId" = UrT0705ChoteiKyotsu."urT0705ChoteiKyotsu_choteiId"
        WHERE
            DbT2002Fuka."dbT2002Fuka_choteiNendo" = #{調定年度}
            AND DbT2002Fuka."dbT2002Fuka_fukaNendo" = #{賦課年度}
            AND DbT2002Fuka."dbT2002Fuka_tsuchishoNo" = #{通知書番号}
            AND DbT2002Fuka."dbT2002Fuka_rirekiNo" = #{履歴番号}
            AND DbT2002Fuka."dbT2002Fuka_choteiNichiji" = #{調定日時}
            AND (DbT2004Gemmen."dbT2004Gemmen_jotaiKubun" = '1'
                OR
                DbT2004Gemmen."dbT2004Gemmen_jotaiKubun" = '2')
            AND DbT2004Gemmen."dbT2004Gemmen_sakuseiKubun" = '3'
    </select>
</mapper>