<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 画面設計_DBCMN63001_自己負担証明書作成のマッピング用XMLです。 
@reamsid_L DBC-4810-010 yaoyahui -->
<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.jikofutangakushomeisho.IJikoFutangakushomeishoMapper">
    <select resultOrdered="true" id="get高額合算情報1" 
            resultMap="resultMap_KogakuGassanJohoEntity1" 
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.jikofutangakushomeisho.JikoFutangakushomeishoParameter"
            fetchSize="500">
        select
        * 
        from
        ( 
        select
        * 
        from
        ( 
        select
        <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3068KogakuGassanShinseishoMapper.allColumns_DbT3068KogakuGassanShinseisho" />
        , row_number() over ( 
        partition by
        "hihokenshaNo"
        , "taishoNendo"
        , "hokenshaNo"
        , "shikyuShinseishoSeiriNo" 
        order by
        "rirekiNo" DESC
        ) AS rank_number 
        from
        rgdb."DbT3068KogakuGassanShinseisho"
        ) as "DbT3068KogakuGassanShinseisho" 
        where
        rank_number = 1
        ) AS "DbT3068KogakuGassanShinseisho" JOIN ( 
        select
        * 
        from
        ( 
        select
        <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3070KogakuGassanJikoFutanGakuMapper.allColumns_DbT3070KogakuGassanJikoFutanGaku" />
        , row_number() over ( 
        partition by
        "hihokenshaNo"
        , "taishoNendo"
        , "hokenshaNo"
        , "shikyuShinseishoSeiriNo" 
        order by
        "rirekiNo" DESC
        ) AS rank_number 
        from
        rgdb."DbT3070KogakuGassanJikoFutanGaku"
        ) as "DbT3070KogakuGassanJikoFutanGaku" 
        where
        rank_number = 1
        ) AS "DbT3070KogakuGassanJikoFutanGaku" 
        ON "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_hihokenshaNo" = "DbT3070KogakuGassanJikoFutanGaku"."dbT3070KogakuGassanJikoFutanGaku_hihokenshaNo"
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_taishoNendo" = "DbT3070KogakuGassanJikoFutanGaku"."dbT3070KogakuGassanJikoFutanGaku_taishoNendo"
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_hokenshaNo" = "DbT3070KogakuGassanJikoFutanGaku"."dbT3070KogakuGassanJikoFutanGaku_hokenshaNo" 
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_shikyuShinseishoSeiriNo" = "DbT3070KogakuGassanJikoFutanGaku"."dbT3070KogakuGassanJikoFutanGaku_shikyuShinseishoSeiriNo"
        JOIN ( 
        select
        * 
        from
        ( 
        select
        <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3071KogakuGassanJikoFutanGakuMeisaiMapper.allColumns_DbT3071KogakuGassanJikoFutanGakuMeisai" />
        , row_number() over ( 
        partition by
        "hihokenshaNo"
        , "taishoNendo"
        , "hokenshaNo"
        , "shikyuShinseishoSeiriNo" 
        order by
        "rirekiNo" DESC
        ) AS rank_number 
        from
        rgdb."DbT3071KogakuGassanJikoFutanGakuMeisai"
        ) as "DbT3071KogakuGassanJikoFutanGakuMeisai"
        where
        rank_number = 1
        ) AS "DbT3071KogakuGassanJikoFutanGakuMeisai" 
        ON "DbT3070KogakuGassanJikoFutanGaku"."dbT3070KogakuGassanJikoFutanGaku_hihokenshaNo" = "DbT3071KogakuGassanJikoFutanGakuMeisai"."dbT3071KogakuGassanJikoFutanGakuMeisai_hihokenshaNo"
        AND "DbT3070KogakuGassanJikoFutanGaku"."dbT3070KogakuGassanJikoFutanGaku_taishoNendo" = "DbT3071KogakuGassanJikoFutanGakuMeisai"."dbT3071KogakuGassanJikoFutanGakuMeisai_taishoNendo"
        AND "DbT3070KogakuGassanJikoFutanGaku"."dbT3070KogakuGassanJikoFutanGaku_hokenshaNo" = "DbT3071KogakuGassanJikoFutanGakuMeisai"."dbT3071KogakuGassanJikoFutanGakuMeisai_hokenshaNo"
        AND "DbT3070KogakuGassanJikoFutanGaku"."dbT3070KogakuGassanJikoFutanGaku_shikyuShinseishoSeiriNo" = "DbT3071KogakuGassanJikoFutanGakuMeisai"."dbT3071KogakuGassanJikoFutanGakuMeisai_shikyuShinseishoSeiriNo"
        WHERE																
        "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_hihokenshaNo" = #{被保険者番号}															
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_taishoNendo" = #{保険者番号}															
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_hokenshaNo" = #{対象年度}															
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_shikyuShinseishoSeiriNo" = #{支給申請書整理番号}					 
        ORDER BY
        "DbT3071KogakuGassanJikoFutanGakuMeisai"."dbT3071KogakuGassanJikoFutanGakuMeisai_taishoM" ASC

    </select>
    <resultMap id="resultMap_KogakuGassanJohoEntity1" autoMapping="true"
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.jikofutangakushomeisho.KogakuGassanJohoEntity">
        <id column="dbT3068KogakuGassanShinseisho_hihokenshaNo"/>
        <id column="dbT3068KogakuGassanShinseisho_taishoNendo"/>
        <id column="dbT3068KogakuGassanShinseisho_hokenshaNo"/>
        <id column="dbT3068KogakuGassanShinseisho_seiriNo"/>
        <id column="dbT3068KogakuGassanShinseisho_rirekiNo"/>
        <id column="dbT3070KogakuGassanJikoFutanGaku_hihokenshaNo"/>
        <id column="dbT3070KogakuGassanJikoFutanGaku_taishoNendo"/>
        <id column="dbT3070KogakuGassanJikoFutanGaku_hokenshaNo"/>
        <id column="dbT3070KogakuGassanJikoFutanGaku_shikyuShinseishoSeiriNo"/>
        <id column="dbT3070KogakuGassanJikoFutanGaku_rirekiNo" />
        <id column="dbT3071KogakuGassanJikoFutanGakuMeisai_hihokenshaNo"/>
        <id column="dbT3071KogakuGassanJikoFutanGakuMeisai_taishoNendo"/>
        <id column="dbT3071KogakuGassanJikoFutanGakuMeisai_hokenshaNo"/>
        <id column="dbT3071KogakuGassanJikoFutanGakuMeisai_shikyuShinseishoSeiriNo"/>
        <id column="dbT3071KogakuGassanJikoFutanGakuMeisai_rirekiNo"/>
        <id column="dbT3071KogakuGassanJikoFutanGakuMeisai_taishoM"/>
        <association property="高額合算申請書entity" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3068KogakuGassanShinseishoMapper.ResultMap_DbT3068KogakuGassanShinseishoEntity"/>
        <association property="高額合算自己負担額entity" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3070KogakuGassanJikoFutanGakuMapper.ResultMap_DbT3070KogakuGassanJikoFutanGakuEntity"/>
        <association property="高額合算自己負担額明細entity" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3071KogakuGassanJikoFutanGakuMeisaiMapper.ResultMap_DbT3071KogakuGassanJikoFutanGakuMeisaiEntity"/>
    </resultMap>
    <select resultOrdered="true" id="get高額合算情報2" 
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.jikofutangakushomeisho.JikoFutangakushomeishoParameter"
            resultMap="resultMap_KogakuGassanJohoEntity2" 
            fetchSize="500">
        select
        * 
        from
        ( 
        select
        * 
        from
        ( 
        select
        <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3068KogakuGassanShinseishoMapper.allColumns_DbT3068KogakuGassanShinseisho" />
        , row_number() over ( 
        partition by
        "hihokenshaNo"
        , "taishoNendo"
        , "hokenshaNo"
        , "shikyuShinseishoSeiriNo" 
        order by
        "rirekiNo" DESC
        ) AS rank_number 
        from
        rgdb."DbT3068KogakuGassanShinseisho"
        ) as "DbT3068KogakuGassanShinseisho" 
        where
        rank_number = 1
        ) AS "DbT3068KogakuGassanShinseisho" JOIN ( 
        select
        * 
        from
        ( 
        select
        <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3170JigyoKogakuGassanJikoFutanGakuMapper.allColumns_DbT3170JigyoKogakuGassanJikoFutanGaku" />
        , row_number() over ( 
        partition by
        "hihokenshaNo"
        , "taishoNendo"
        , "hokenshaNo"
        , "shikyuShinseishoSeiriNo" 
        order by
        "rirekiNo" DESC
        ) AS rank_number 
        from
        rgdb."DbT3170JigyoKogakuGassanJikoFutanGaku"
        ) as "DbT3170JigyoKogakuGassanJikoFutanGaku" 
        where
        rank_number = 1
        ) AS "DbT3170JigyoKogakuGassanJikoFutanGaku" 
        ON "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_hihokenshaNo" = "DbT3170JigyoKogakuGassanJikoFutanGaku"."hihokenshaNo"
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_taishoNendo" = "DbT3170JigyoKogakuGassanJikoFutanGaku"."taishoNendo"
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_hokenshaNo" = "DbT3170JigyoKogakuGassanJikoFutanGaku"."hokenshaNo" 
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_shikyuShinseishoSeiriNo" = "DbT3170JigyoKogakuGassanJikoFutanGaku"."shikyuShinseishoSeiriNo"
        JOIN ( 
        select
        * 
        from
        ( 
        select
        <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3171JigyoKogakuGassanJikoFutanGakuMeisaiMapper.allColumns_DbT3171JigyoKogakuGassanJikoFutanGakuMeisai" />
        , row_number() over ( 
        partition by
        "hihokenshaNo"
        , "taishoNendo"
        , "hokenshaNo"
        , "shikyuShinseishoSeiriNo" 
        order by
        "rirekiNo" DESC
        ) AS rank_number 
        from
        rgdb."DbT3171JigyoKogakuGassanJikoFutanGakuMeisai"
        ) as "DbT3171JigyoKogakuGassanJikoFutanGakuMeisai"
        where
        rank_number = 1
        ) AS "DbT3171JigyoKogakuGassanJikoFutanGakuMeisai" 
        ON "DbT3170JigyoKogakuGassanJikoFutanGaku"."dbT3170JigyoKogakuGassanJikoFutanGaku_hihokenshaNo" = "DbT3171JigyoKogakuGassanJikoFutanGakuMeisai"."dbT3171_hihokenshaNo"
        AND "DbT3170JigyoKogakuGassanJikoFutanGaku"."dbT3170JigyoKogakuGassanJikoFutanGaku_taishoNendo" = "DbT3171JigyoKogakuGassanJikoFutanGakuMeisai"."dbT3171_taishoNendo"
        AND "DbT3170JigyoKogakuGassanJikoFutanGaku"."dbT3170JigyoKogakuGassanJikoFutanGaku_hokenshaNo" = "DbT3171JigyoKogakuGassanJikoFutanGakuMeisai"."dbT3171_hokenshaNo"
        AND "DbT3170JigyoKogakuGassanJikoFutanGaku"."dbT3170JigyoKogakuGassanJikoFutanGaku_shikyuShinseishoSeiriNo" = "DbT3171JigyoKogakuGassanJikoFutanGakuMeisai"."dbT3171_shikyuShinseishoSeiriNo"
		
        WHERE																
        "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_hihokenshaNo" = #{被保険者番号}															
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_taishoNendo" = #{保険者番号}															
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_hokenshaNo" = #{対象年度}															
        AND "DbT3068KogakuGassanShinseisho"."dbT3068KogakuGassanShinseisho_shikyuShinseishoSeiriNo" = #{支給申請書整理番号}					 
        ORDER BY
        "DbT3171JigyoKogakuGassanJikoFutanGakuMeisai"."dbT3171_taishoM" ASC


    </select>
    <resultMap id="resultMap_KogakuGassanJohoEntity2" autoMapping="true"
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.jikofutangakushomeisho.KogakuGassanJohoEntity">
        <id column="dbT3068KogakuGassanShinseisho_hihokenshaNo" />
        <id column="dbT3068KogakuGassanShinseisho_taishoNendo" />
        <id column="dbT3068KogakuGassanShinseisho_hokenshaNo" />
        <id column="dbT3068KogakuGassanShinseisho_seiriNo" />
        <id column="dbT3068KogakuGassanShinseisho_rirekiNo" />
        <id column="dbT3170_hihokenshaNo" />
        <id column="dbT3170_taishoNendo" />
        <id column="dbT3170_hokenshaNo" />
        <id column="dbT3170_shikyuShinseishoSeiriNo" />
        <id column="dbT3170_rirekiNo" />
        <id column="dbT3171_hihokenshaNo" />
        <id column="dbT3171_taishoNendo" />
        <id column="dbT3171_hokenshaNo" />
        <id column="dbT3171_shikyuShinseishoSeiriNo" />
        <id column="dbT3171_rirekiNo" />
        <id column="dbT3171_taishoM" />
        <association property="高額合算申請書entity" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3068KogakuGassanShinseishoMapper.ResultMap_DbT3068KogakuGassanShinseishoEntity"/>
        <association property="事業高額合算自己負担額entity" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3170JigyoKogakuGassanJikoFutanGakuMapper.ResultMap_DbT3170JigyoKogakuGassanJikoFutanGakuEntity"/>
        <association property="事業高額合算自己負担額明細entity" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3171JigyoKogakuGassanJikoFutanGakuMeisaiMapper.ResultMap_DbT3171JigyoKogakuGassanJikoFutanGakuMeisaiEntity"/>
    </resultMap>
    <select resultOrdered="true" id="get宛名から被保険者の個人情報" 
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.jikofutangakushomeisho.JikoFutangakushomeishoParameter"
            resultMap="resultMap_KogakuGassanJohoEntity3" 
            fetchSize="500">
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1001HihokenshaDaichoMapper.allColumns_DbT1001HihokenshaDaicho" />
        ,<include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.columns_ShikibetsuTaisho" />
        FROM
        ( 
        SELECT
        * 
        FROM
        ( 
        SELECT
        *
        , row_number() over ( 
        partition by
        "hihokenshaNo" 
        order by
        "idoYMD" DESC ,"edaNo" DESC
        ) AS rank_number 
        FROM
        rgdb."DbT1001HihokenshaDaicho" AS "DbT1001HihokenshaDaicho"
        ) AS "DbT1001HihokenshaDaicho" 
        WHERE
        rank_number = 1
        ) AS "DbT1001HihokenshaDaicho" 
        INNER JOIN 
        rgua."UaFt200FindShikibetsuTaisho"('','',FALSE,'DB',FALSE,'','','','','','','','','','','',true,
        '','','','','','','',true,'','','','','','','','','','','',true,true,true,true,true,true,true,true,true,true,
        true,'','','','','','','','',true,'','',true,true,true,'','','','','','','','','','','','','','','','','','','{}') 
        AS "ShikibetsuTaisho"  
        ON "DbT1001HihokenshaDaicho"."shikibetsuCode" = "ShikibetsuTaisho"."shikibetsuCode" 
        WHERE
        "DbT1001HihokenshaDaicho"."hihokenshaNo" = #{被保険者番号}
    </select>
    <resultMap id="resultMap_KogakuGassanJohoEntity3" autoMapping="true"
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.jikofutangakushomeisho.KogakuGassanJohoEntity">
        <association property="被保険者台帳entity" resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1001HihokenshaDaichoMapper.ResultMap_DbT1001HihokenshaDaichoEntity"/>
        <association property="uaFt200Entity" resultMap="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.UaFt200FindShikibetsuTaishoEntity"/>
    </resultMap>
    <select resultOrdered="true" id="get対象者データ" 
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.jikofutangakushomeisho.JikoFutangakushomeishoParameter"
            resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3068KogakuGassanShinseishoMapper.ResultMap_DbT3068KogakuGassanShinseishoEntity"
            fetchSize="500">
        SELECT
        "dbT3068KogakuGassanShinseisho"."taishoNendo" AS "dbT3068KogakuGassanShinseisho_taishoNendo"
        , "dbT3068KogakuGassanShinseisho"."seiriNo" AS "dbT3068KogakuGassanShinseisho_seiriNo"
        , "dbT3068KogakuGassanShinseisho"."shikyuShinseishoSeiriNo" AS "dbT3068KogakuGassanShinseisho_shikyuShinseishoSeiriNo"
        , MAX("dbT3068KogakuGassanShinseisho"."rirekiNo") AS "dbT3068KogakuGassanShinseisho_rirekiNo"
 
        FROM
        rgdb."DbT3068KogakuGassanShinseisho" AS "dbT3068KogakuGassanShinseisho" 
        WHERE
      
        "dbT3068KogakuGassanShinseisho"."hihokenshaNo" = #{被保険者番号} 
        AND "dbT3068KogakuGassanShinseisho"."hokenshaNo" = #{保険者番号} 
        AND "dbT3068KogakuGassanShinseisho"."shinseiJokyoKubun" = #{申請状況区分} 
        AND NOT "dbT3068KogakuGassanShinseisho"."shikyuShinseiKubun" = #{支給申請区分}
        AND ( "dbT3068KogakuGassanShinseisho"."jikoFutan_KeisanYM" IS NOT NULL OR "dbT3068KogakuGassanShinseisho"."jikoFutan_KeisanYM" <![CDATA[<>]]>'')
        GROUP BY
        "dbT3068KogakuGassanShinseisho"."taishoNendo"
        , "dbT3068KogakuGassanShinseisho"."seiriNo"
        , "dbT3068KogakuGassanShinseisho"."shikyuShinseishoSeiriNo"
        ORDER BY
        "dbT3068KogakuGassanShinseisho"."taishoNendo" DESC 
        ,"dbT3068KogakuGassanShinseisho"."seiriNo" ASC 
    </select>
</mapper>