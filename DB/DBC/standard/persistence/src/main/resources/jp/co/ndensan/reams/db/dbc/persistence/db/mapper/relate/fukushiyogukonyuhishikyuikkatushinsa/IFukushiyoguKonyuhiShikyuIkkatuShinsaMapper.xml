<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--  -->

<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.fukushiyogukonyuhishikyuikkatushinsa.IFukushiyoguKonyuhiShikyuIkkatuShinsaMapper">
                    
    <select id="select未審査申請"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.fukushiyogukonyuhishikyuikkatushinsa.ShokanFukushiYoguHanbaihiParameter"
            resultMap="resultMap_ShokanShinseiEntity" fetchSize="500">
        <include refid="selectShokanShinseiEntity" />
    </select>
    <sql id="selectShokanShinseiEntity">
        SELECT
        dbT3038ShokanKihon.*,
        DbT3034ShokanShinsei.*,  
        ShikibetsuTaisho."meisho" AS "氏名"
        FROM
        (<include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3038ShokanKihonMapper.noDeleted_DbT3038ShokanKihon" />) AS DbT3038ShokanKihon
        INNER JOIN (SELECT "hihokenshaNo","shikibetsuCode",MAX("idoYMD" || "edaNo") FROM rgdb."DbT1001HihokenshaDaicho" 
        GROUP BY "hihokenshaNo","shikibetsuCode")AS temp1
        ON "dbT3038ShokanKihon_hiHokenshaNo" = temp1."hihokenshaNo"
        INNER JOIN 
        (<include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3034ShokanShinseiMapper.noDeleted_DbT3034ShokanShinsei" />) AS DbT3034ShokanShinsei
        ON  "dbT3038ShokanKihon_hiHokenshaNo" = "dbT3034ShokanShinsei_hiHokenshaNo"
        AND "dbT3038ShokanKihon_serviceTeikyoYM" = "dbT3034ShokanShinsei_serviceTeikyoYM"
        AND "dbT3038ShokanKihon_seiriNp" = "dbT3034ShokanShinsei_seiriNo"
        AND "dbT3034ShokanShinsei_shikyuShinseiShinsaKubun" = '1'      
        LEFT OUTER JOIN <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.tableName_PsmParamClassShikibetsuTaisho" />
        AS ShikibetsuTaisho
        on temp1."shikibetsuCode" = ShikibetsuTaisho."shikibetsuCode"
        WHERE substring("dbT3038ShokanKihon_yoshikiNo",1,3)='21C'
        AND NOT EXISTS(SELECT "hiHokenshaNo","serviceTeikyoYM","seiriNo" FROM rgdb."DbT3036ShokanHanteiKekka")
        <if test="支給申請日From != null">
            AND "dbT3034ShokanShinsei_shinseiYMD" <![CDATA[>=]]> #{支給申請日From}
        </if>
        <if test="支給申請日To != null">
            AND "dbT3034ShokanShinsei_shinseiYMD" <![CDATA[<=]]> #{支給申請日To}
        </if>
         ORDER BY "dbT3034ShokanShinsei_shinseiYMD" ASC,
                "dbT3038ShokanKihon_serviceTeikyoYM" ASC
    </sql>
        
    <resultMap id="resultMap_ShokanShinseiEntity" autoMapping="true"
               type="jp.co.ndensan.reams.db.dbc.business.core.fukushiyogukonyuhishikyuikkatushinsa.ShokanShinseiEntity">
        <id column="dbT3038ShokanKihon_hiHokenshaNo"/>
        <id column="dbT3038ShokanKihon_serviceTeikyoYM"/>
        <id column="dbT3038ShokanKihon_seiriNp"/>
        <id column="dbT3038ShokanKihon_jigyoshaNo"/>
        <id column="dbT3038ShokanKihon_yoshikiNo"/>
        <id column="dbT3038ShokanKihon_meisaiNo"/>
        <result property="氏名" column="氏名" 
            typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler"/>
        <association property="償還払請求基本Entity" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3038ShokanKihonMapper.ResultMap_DbT3038ShokanKihonEntity"/>
        <association property="償還払支給申請Entity" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3034ShokanShinseiMapper.ResultMap_DbT3034ShokanShinseiEntity"/>
<!--        <collection property="償還払請求基本Entity" 
                    ofType="jp.co.ndensan.reams.db.dbc.entity.db.basic.shokanshinsei.DbT3038ShokanKihonEntity" 
                    resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3038ShokanKihonMapper.ResultMap_DbT3038ShokanKihonEntity"/>
        <collection property="償還払支給申請Entity" 
                    ofType="jp.co.ndensan.reams.db.dbc.entity.db.basic.shokanshinsei.DbT3034ShokanShinseiEntity" 
                    resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3034ShokanShinseiMapper.ResultMap_DbT3034ShokanShinseiEntity"/>-->
    </resultMap>  
</mapper>