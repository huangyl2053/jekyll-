<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBC-3099-020 zhouchuanlin -->

<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.dbc710070.IHanyoListKyodoJukyushaShokanMapper">
    <select resultOrdered="true" id="select共同処理用受給者異動償還情報"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.dbc710070.HanyoListKyodoJukyushaShokanMybatisParameter"
            resultMap="resultMap_HanyoListKyodoJukyushaShokan" fetchSize="500">
        <include refid="selectHanyoListKyodoJukyushaShokan" />
    </select>
    <sql id="selectHanyoListKyodoJukyushaShokan">
        WITH "KyodoJukyushaShokanNewest" AS       
        (SELECT *
        FROM 
            rgdb."DbT3003KyodoShoriyoJukyushaIdoShokanSofu" 
        WHERE
            1=1
            AND "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."idoKubunCode" IN
            <foreach item="異動区分S" index="index" collection="異動区分S" open="(" separator="," close=")">
                #{異動区分S}
            </foreach>
            <if test="!削除含める" >
            AND "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."logicalDeletedFlag" = FALSE
            </if>
            <if test ="日付抽出区分 == 2">
                <if test="処理対象年月FROM !=null and 処理対象年月FROM.toString()!=''" >
                AND  #{処理対象年月FROM}  <![CDATA[<=]]> "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."sofuYM"
                </if>
                <if test="処理対象年月TO !=null and 処理対象年月TO.toString()!=''" >
                AND  "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."sofuYM"  <![CDATA[<=]]> #{処理対象年月TO}
                </if>
                <if test="異動年月From !=null and 異動年月From.toString()!=''" >
                AND  #{異動年月From}  <![CDATA[<=]]> SUBSTR("DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."idoYMD",1,6)
                </if>
                <if test="異動年月To !=null and 異動年月To.toString()!=''" >
                AND  SUBSTR("DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."idoYMD",1,6)  <![CDATA[<=]]> #{異動年月To}
                </if>
            </if>
            <if test ="保険者コード !='' and 保険者コード != '000000'">
                AND  "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."shoKisaiHokenshaNo"  = #{保険者コード}
            </if>
         )   
        SELECT
            <include refid="allColumns_DbT1001HihokenshaDaicho" />,
            <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.dbc710070.IHanyoListKyodoJukyushaShokanMapper.allColumns_DbT3003KyodoShoriyoJukyushaIdoShokanSofu" />,
            <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.columns_ShikibetsuTaisho"/>                
        FROM
            "KyodoJukyushaShokanNewest"  AS "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"
        INNER JOIN 
            rgdb."DbV1001HihokenshaDaicho"  AS "DbT1001HihokenshaDaicho"
        ON 
            "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."hiHokenshaNo" = "DbT1001HihokenshaDaicho"."hihokenshaNo"
        INNER JOIN
            <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.tableName_PsmParamClassShikibetsuTaisho" /> AS "ShikibetsuTaisho"
        ON
            "DbT1001HihokenshaDaicho"."shikibetsuCode"= "ShikibetsuTaisho"."shikibetsuCode" 
        WHERE 1=1
            <if test="日付抽出区分 == 1 " >
            AND  NOT EXISTS (
                SELECT 1
                FROM "KyodoJukyushaShokanNewest"  AS DbT3003KyodoShoriyoJukyushaIdoShokanSofu2
                WHERE
                "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."hiHokenshaNo" = DbT3003KyodoShoriyoJukyushaIdoShokanSofu2."hiHokenshaNo"
                AND "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."idoYMD" <![CDATA[<]]> DbT3003KyodoShoriyoJukyushaIdoShokanSofu2."idoYMD"
                )
            </if> 
            <if test="日付抽出区分 == 2 and 各異動月の最新のみ" >  
            AND  NOT EXISTS (
                SELECT 1  
                FROM "KyodoJukyushaShokanNewest"  AS DbT3003KyodoShoriyoJukyushaIdoShokanSofu2
                WHERE
                "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."hiHokenshaNo" = DbT3003KyodoShoriyoJukyushaIdoShokanSofu2."hiHokenshaNo"
                 AND "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."sofuYM" = DbT3003KyodoShoriyoJukyushaIdoShokanSofu2."sofuYM"
                 AND "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."idoYMD" <![CDATA[<]]> DbT3003KyodoShoriyoJukyushaIdoShokanSofu2."idoYMD" 
                 )
            </if>
    </sql>
    <resultMap id="resultMap_HanyoListKyodoJukyushaShokan" autoMapping="true"
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.dbc710070.KyodoJukyushaShokanEntity">
        <id column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_hiHokenshaNo" />
        <id column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_idoYMD" />
        <id column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_rirekiNo" />
        <association property="共同処理用受給者異動償還送付" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.dbc710070.IHanyoListKyodoJukyushaShokanMapper.ResultMap_DbT3003KyodoShoriyoJukyushaIdoShokanSofuEntity"/>
        <association property="被保険者台帳管理" resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1001HihokenshaDaichoMapper.ResultMap_DbT1001HihokenshaDaichoEntity"/>
        <association property="宛名" resultMap = "jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.UaFt200FindShikibetsuTaishoEntity"/>
    </resultMap> 
    <sql id="allColumns_DbT1001HihokenshaDaicho">
         "DbT1001HihokenshaDaicho"."hihokenshaNo" as "dbT1001HihokenshaDaicho_hihokenshaNo",
         "DbT1001HihokenshaDaicho"."idoYMD" as "dbT1001HihokenshaDaicho_idoYMD",
         "DbT1001HihokenshaDaicho"."edaNo" as "dbT1001HihokenshaDaicho_edaNo",
         "DbT1001HihokenshaDaicho"."idoJiyuCode" as "dbT1001HihokenshaDaicho_idoJiyuCode",
         "DbT1001HihokenshaDaicho"."shichosonCode" as "dbT1001HihokenshaDaicho_shichosonCode",
         "DbT1001HihokenshaDaicho"."shikibetsuCode" as "dbT1001HihokenshaDaicho_shikibetsuCode",
         "DbT1001HihokenshaDaicho"."shikakuShutokuJiyuCode" as "dbT1001HihokenshaDaicho_shikakuShutokuJiyuCode",
         "DbT1001HihokenshaDaicho"."shikakuShutokuYMD" as "dbT1001HihokenshaDaicho_shikakuShutokuYMD",
         "DbT1001HihokenshaDaicho"."shikakuShutokuTodokedeYMD" as "dbT1001HihokenshaDaicho_shikakuShutokuTodokedeYMD",
         "DbT1001HihokenshaDaicho"."ichigoShikakuShutokuYMD" as "dbT1001HihokenshaDaicho_ichigoShikakuShutokuYMD",
         "DbT1001HihokenshaDaicho"."hihokennshaKubunCode" as "dbT1001HihokenshaDaicho_hihokennshaKubunCode",
         "DbT1001HihokenshaDaicho"."shikakuSoshitsuJiyuCode" as "dbT1001HihokenshaDaicho_shikakuSoshitsuJiyuCode",
         "DbT1001HihokenshaDaicho"."shikakuSoshitsuYMD" as "dbT1001HihokenshaDaicho_shikakuSoshitsuYMD",
         "DbT1001HihokenshaDaicho"."shikakuSoshitsuTodokedeYMD" as "dbT1001HihokenshaDaicho_shikakuSoshitsuTodokedeYMD",
         "DbT1001HihokenshaDaicho"."shikakuHenkoJiyuCode" as "dbT1001HihokenshaDaicho_shikakuHenkoJiyuCode",
         "DbT1001HihokenshaDaicho"."shikakuHenkoYMD" as "dbT1001HihokenshaDaicho_shikakuHenkoYMD",
         "DbT1001HihokenshaDaicho"."shikakuHenkoTodokedeYMD" as "dbT1001HihokenshaDaicho_shikakuHenkoTodokedeYMD",
         "DbT1001HihokenshaDaicho"."jushochitokureiTekiyoJiyuCode" as "dbT1001HihokenshaDaicho_jushochitokureiTekiyoJiyuCode",
         "DbT1001HihokenshaDaicho"."jushochitokureiTekiyoYMD" as "dbT1001HihokenshaDaicho_jushochitokureiTekiyoYMD",
         "DbT1001HihokenshaDaicho"."jushochitokureiTekiyoTodokedeYMD" as "dbT1001HihokenshaDaicho_jushochitokureiTekiyoTodokedeYMD",
         "DbT1001HihokenshaDaicho"."jushochitokureiKaijoJiyuCode" as "dbT1001HihokenshaDaicho_jushochitokureiKaijoJiyuCode",
         "DbT1001HihokenshaDaicho"."jushochitokureiKaijoYMD" as "dbT1001HihokenshaDaicho_jushochitokureiKaijoYMD",
         "DbT1001HihokenshaDaicho"."jushochitokureiKaijoTodokedeYMD" as "dbT1001HihokenshaDaicho_jushochitokureiKaijoTodokedeYMD",
         "DbT1001HihokenshaDaicho"."jushochiTokureiFlag" as "dbT1001HihokenshaDaicho_jushochiTokureiFlag",
         "DbT1001HihokenshaDaicho"."koikinaiJushochiTokureiFlag" as "dbT1001HihokenshaDaicho_koikinaiJushochiTokureiFlag",
         "DbT1001HihokenshaDaicho"."koikinaiTokureiSochimotoShichosonCode" as "dbT1001HihokenshaDaicho_koikinaiTokureiSochimotoShichosonCode",
         "DbT1001HihokenshaDaicho"."kyuShichosonCode" as "dbT1001HihokenshaDaicho_kyuShichosonCode",
         "DbT1001HihokenshaDaicho"."logicalDeletedFlag" as "dbT1001HihokenshaDaicho_logicalDeletedFlag"
    </sql>
     <sql id="allColumns_DbT3003KyodoShoriyoJukyushaIdoShokanSofu">
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."hiHokenshaNo" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_hiHokenshaNo",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."idoYMD" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_idoYMD",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."rirekiNo" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_rirekiNo",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."insertDantaiCd" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_insertDantaiCd",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."insertTimestamp" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_insertTimestamp",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."insertReamsLoginId" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_insertReamsLoginId",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."insertContextId" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_insertContextId",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."isDeleted" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_isDeleted",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."updateCount" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_updateCount",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."lastUpdateTimestamp" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_lastUpdateTimestamp",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."lastUpdateReamsLoginId" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_lastUpdateReamsLoginId",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."idoKubunCode" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_idoKubunCode",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."jukyushaIdoJiyu" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_jukyushaIdoJiyu",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."shoKisaiHokenshaNo" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_shoKisaiHokenshaNo",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."hokenKyufuIchijiSashitomeKaishiYMD" as "dbT3003_hokenKyufuIchijiSashitomeKaishiYMD",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."hokenKyufuIchijiSashitomeShuryoYMD" as "dbT3003_hokenKyufuIchijiSashitomeShuryoYMD",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."hokenkyufuIchijiSashitomeKubunCode" as "dbT3003_hokenkyufuIchijiSashitomeKubunCode",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."hokenkyufuIchijiSashitomeKingaku" as "dbT3003_hokenkyufuIchijiSashitomeKingaku",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."teiseiRenrakuhyoFlag" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_teiseiRenrakuhyoFlag",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."sofuYM" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_sofuYM",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."teiseiKubunCode" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_teiseiKubunCode",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."teiseiYMD" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_teiseiYMD",
         "DbT3003KyodoShoriyoJukyushaIdoShokanSofu"."logicalDeletedFlag" as "dbT3003KyodoShoriyoJukyushaIdoShokanSofu_logicalDeletedFlag"
    </sql>
    <!--テーブルDbT3003KyodoShoriyoJukyushaIdoShokanSofuの項目をDbT3003KyodoShoriyoJukyushaIdoShokanSofuEntityの項目にマッピングします。-->
    <resultMap id="ResultMap_DbT3003KyodoShoriyoJukyushaIdoShokanSofuEntity" type="jp.co.ndensan.reams.db.dbc.entity.db.basic.DbT3003KyodoShoriyoJukyushaIdoShokanSofuEntity" autoMapping="true">
        <id property="hiHokenshaNo" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_hiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <id property="idoYMD" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_idoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <id property="rirekiNo" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_rirekiNo" />
        <result property="insertDantaiCd" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_insertDantaiCd" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="insertTimestamp" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_insertTimestamp" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RDateTimeTypeHandler"/>
        <result property="insertReamsLoginId" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_insertReamsLoginId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="insertContextId" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_insertContextId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.UUIDTypeHandler"/>
        <result property="isDeleted" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_isDeleted" />
        <result property="updateCount" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_updateCount" />
        <result property="lastUpdateTimestamp" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_lastUpdateTimestamp" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RDateTimeTypeHandler"/>
        <result property="lastUpdateReamsLoginId" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_lastUpdateReamsLoginId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="idoKubunCode" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_idoKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="jukyushaIdoJiyu" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_jukyushaIdoJiyu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shoKisaiHokenshaNo" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_shoKisaiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ShoKisaiHokenshaNoTypeHandler"/>
        <result property="hokenKyufuIchijiSashitomeKaishiYMD" column="dbT3003_hokenKyufuIchijiSashitomeKaishiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="hokenKyufuIchijiSashitomeShuryoYMD" column="dbT3003_hokenKyufuIchijiSashitomeShuryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="hokenkyufuIchijiSashitomeKubunCode" column="dbT3003_hokenkyufuIchijiSashitomeKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="hokenkyufuIchijiSashitomeKingaku" column="dbT3003_hokenkyufuIchijiSashitomeKingaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="teiseiRenrakuhyoFlag" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_teiseiRenrakuhyoFlag" />
        <result property="sofuYM" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_sofuYM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="teiseiKubunCode" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_teiseiKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="teiseiYMD" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_teiseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="logicalDeletedFlag" column="dbT3003KyodoShoriyoJukyushaIdoShokanSofu_logicalDeletedFlag" />
    </resultMap>
</mapper>