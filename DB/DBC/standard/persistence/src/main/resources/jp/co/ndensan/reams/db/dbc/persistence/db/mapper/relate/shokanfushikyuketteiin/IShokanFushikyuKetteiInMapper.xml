<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- @reamsid_L DBC-2590-030 xuhao -->
<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.shokanfushikyuketteiin.IShokanFushikyuKetteiInMapper">

    <resultMap id="resultMap_Hihokensha" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanfushikyuketteiin.ShokanFushikyuKetteiInEntity" autoMapping="true">
        <result property="hiHokenshaNo" column="hiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
    </resultMap>
    
     <!--一時テーブルの被保険者番号の取得-->
    <select id="select被保険者番号" resultMap="resultMap_Hihokensha" fetchSize="500">
        SELECT DISTINCT SHOKAN."hiHokenshaNo"
        FROM "DbTShokanFushikyuKetteiInTempTable" AS SHOKAN
    </select>
    
    <!--  新被保険者番号一時テーブルを作成する。 -->
    <insert id="create新被保険者番号一時テーブル">
        CREATE TEMP TABLE "TABLE_SHOKANFUSHIKYUSINHIHOKENSHABANGOICHIJI"
        (
            "shichosonCode" rshare."UDD023LasdecCode",
            "shinNo" rgdb."DbUDD002HihokenshaNo",
            "kyuNo" rgdb."DbUDD002HihokenshaNo"
        )
    </insert>
    
    <!-- 被保険者台帳管理から市町村コード取得 -->
    <select id="select市町村コードFrom被保険者台帳管理"
            resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1001HihokenshaDaichoMapper.ResultMap_DbT1001HihokenshaDaichoEntity"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.shokanfushikyuketteiin.ShokanFushikyuKetteiInParameter">
     SELECT
         <include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1001HihokenshaDaichoMapper.allColumns_DbT1001HihokenshaDaicho" />
     FROM
         rgdb."DbT1001HihokenshaDaicho"
     WHERE
         rgdb."DbT1001HihokenshaDaicho"."hihokenshaNo" = #{被保険者番号}
     AND rgdb."DbT1001HihokenshaDaicho"."isDeleted" <![CDATA[<>]]> TRUE
     ORDER BY rgdb."DbT1001HihokenshaDaicho"."hihokenshaNo" DESC,
              rgdb."DbT1001HihokenshaDaicho"."idoYMD" DESC,
              rgdb."DbT1001HihokenshaDaicho"."edaNo" DESC
     LIMIT(1)
    </select>
    
    <resultMap id="resultMap_SinHihokenshaBangoEntity" 
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanfushikyuketteiin.SinHihokenshaBangoEntity"
               autoMapping="true">
        <result property="市町村コード" column="shichosonCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler"/>
        <result property="新番号" column="shinNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="旧番号" column="kyuNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>

    <!-- 被保険者台帳管理から新被保険者番号取得 -->
    <select id="select新被保険者番号From新旧被保険者番号変換"
            resultMap="resultMap_SinHihokenshaBangoEntity"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.shokanfushikyuketteiin.ShokanFushikyuKetteiInParameter">
     SELECT
         DbT7026."shichosonCode",
         DbT7026."shinNo",
         DbT7026."kyuNo"
     FROM
         rgdb."DbT7026ShinKyuHihokenshaNoHenkan" AS DbT7026
     WHERE
         DbT7026."shichosonCode" = #{市町村コード}
     AND DbT7026."kyuNo" = #{被保険者番号}
    </select>
    
    <!-- 新被保険者番号一時テーブルに登録する。 -->
    <insert id="insert新被保険者番号一時テーブル"
            parameterType="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanfushikyuketteiin.SinHihokenshaBangoEntity">
        INSERT INTO "TABLE_SHOKANFUSHIKYUSINHIHOKENSHABANGOICHIJI"
        VALUES (
            #{市町村コード},
            #{新番号},
            #{旧番号}
        )
    </insert>
    
    <!-- 新旧被保険者番号を変換する -->
    <update id="update償還払不支給決定情報一時テーブル">
        UPDATE "DbTShokanFushikyuKetteiInTempTable"
        SET    "hiHokenshaNo" = ICHIJI."shinNo"
        FROM   "TABLE_SHOKANFUSHIKYUSINHIHOKENSHABANGOICHIJI" AS ICHIJI
        WHERE  "hiHokenshaNo" = ICHIJI."kyuNo"
    </update>
    
    <!-- 被保険者台帳管理テーブルにデータを一時テーブルに更新する -->
    <update id="update償還払不支給決定情報一時テーブル_被保険者番号"
            parameterType="jp.co.ndensan.reams.db.dbz.entity.db.basic.DbT1001HihokenshaDaichoEntity">
        UPDATE "DbTShokanFushikyuKetteiInTempTable"
        SET    "shikibetsuCode" = #{shikibetsuCode},
               "soshitsuJiyuCode"= #{shikakuSoshitsuJiyuCode},
               "soshitsuYMD" = #{shikakuSoshitsuYMD}
        WHERE  "hiHokenshaNo" = #{hihokenshaNo}
    </update>
    
    
    <resultMap id="resultMap_ShikibetsuCode"
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanfushikyuketteiin.ShokanFushikyuKetteiInEntity"
               autoMapping="true">
        <result property="shikibetsuCode" column="shikibetsuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
    </resultMap>
    <!-- 一時テーブルの被保険者番号 識別コードの取得 -->
    <select id="select識別コード"
            resultMap="resultMap_ShikibetsuCode" fetchSize="500">
        SELECT DISTINCT TEMP."shikibetsuCode"
        FROM "DbTShokanFushikyuKetteiInTempTable" AS TEMP
    </select>
    
    <resultMap id="resultMap_PSM" 
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanfushikyuketteiin.ShikibetsuTaishoPSMEntity"
               autoMapping="true">
        <result property="識別コード" column="shikibetsuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
        <result property="全国住所コード" column="zenkokuJushoCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ZenkokuJushoCodeTypeHandler"/>
        <result property="住所" column="jusho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaJushoTypeHandler"/>
        <result property="行政区コード" column="gyoseikuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.GyoseikuCodeTypeHandler"/>
        <result property="行政区名" column="gyoseikuName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>
    <select id="select宛名情報Entity" resultMap="resultMap_PSM" 
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.shokanfushikyuketteiin.ShokanFushikyuKetteiInPSMParameter" fetchSize="50">
        SELECT 
             宛名."shikibetsuCode",
             宛名."zenkokuJushoCode",
             宛名."jusho",
             宛名."gyoseikuCode",
             宛名."gyoseikuName"
        FROM <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.tableName_PsmParamClassShikibetsuTaisho" />
             AS 宛名
        
    </select>
    
    <!-- 償還払不支給決定情報一時TBLの宛名情報更新。 -->
    <update id="update償還払不支給決定情報一時テーブル_識別コード"
            parameterType="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanfushikyuketteiin.ShikibetsuTaishoPSMEntity">
        UPDATE "DbTShokanFushikyuKetteiInTempTable"
        SET     "jushoCode" = #{全国住所コード},
                "jusho" = #{住所},
                "gyoseikuCode" = #{行政区コード},
                "gyoseiku" = #{行政区名}
        WHERE "shikibetsuCode" = #{識別コード}
    </update>
    
    <resultMap id="resultMap_yishiTable" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanfushikyuketteiin.ShokanFushikyuKetteiInEntity">
        <result property="kokanShikibetsuNo" column="kokanShikibetsuNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="recordTypeHeader" column="recordTypeHeader" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shokisaiHokenshaNo" column="shokisaiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ShoKisaiHokenshaNoTypeHandler"/>
        <result property="hokenshaName" column="hokenshaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="sakuseiYMD" column="sakuseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="kokuhoRenkokaiName" column="kokuhoRenkokaiName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="recordTypeMesai" column="recordTypeMesai" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="no" column="no" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="seiriNo" column="seiriNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="hiHokenshaNo" column="hiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <result property="hiHokenshaName" column="hiHokenshaName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="serviceTeikyoYM" column="serviceTeikyoYM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="jigyoshoNo" column="jigyoshoNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
        <result property="jigyoshoName" column="jigyoshoName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="serviceShuruiCode" column="serviceShuruiCode" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ServiceShuruiCodeTypeHandler"/>
        <result property="serviceShuruiName" column="serviceShuruiName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="tensuKingaku" column="tensuKingaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="bikoOne" column="bikoOne" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="bikoTwo" column="bikoTwo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shikibetsuCode" column="shikibetsuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
        <result property="tsuchishoNo" column="tsuchishoNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.TsuchishoNoTypeHandler"/>
        <result property="jushoCode" column="jushoCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ZenkokuJushoCodeTypeHandler"/>
        <result property="jusho" column="jusho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaJushoTypeHandler"/>
        <result property="gyoseikuCode" column="gyoseikuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.GyoseikuCodeTypeHandler"/>
        <result property="gyoseiku" column="gyoseiku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="soshitsuJiyuCode" column="soshitsuJiyuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="soshitsuYMD" column="soshitsuYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="isUpdate" column="isUpdate" typeHandler="org.apache.ibatis.type.BooleanTypeHandler"/>
        <result property="shikyuKubunCode" column="shikyuKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>
    <select id="select一時テーブル" resultMap="resultMap_yishiTable" fetchSize="500">
        SELECT TEMP.*
        FROM "DbTShokanFushikyuKetteiInTempTable" AS TEMP
        ORDER BY TEMP."shokisaiHokenshaNo",
                 TEMP."hiHokenshaNo",
                 TEMP."jigyoshoNo"
        
    </select>
    
    <resultMap id="resultMap_ShokanFushikyuKetteiInEntity" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanfushikyuketteiin.ShokanFushikyuKetteiInEntity">
        <result property="hiHokenshaNo" column="hiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <result property="serviceTeikyoYM" column="serviceTeikyoYM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="seiriNo" column="seiriNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="no" column="no" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="sakuseiYMD" column="sakuseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
    </resultMap>
    <select id="select償還払不支給決定情報一時テーブル" resultMap="resultMap_ShokanFushikyuKetteiInEntity" fetchSize="500">
        SELECT TEMP."hiHokenshaNo",
               TEMP."serviceTeikyoYM",
               TEMP."seiriNo",
               TEMP."no",
               <!--TEMP."shokisaiHokenshaNo",-->
               MAX(TEMP."sakuseiYMD") AS sakuseiYMD
               <!--TEMP."zhigeiqufenCode"-->
        FROM "DbTShokanFushikyuKetteiInTempTable" AS TEMP
        GROUP BY
               TEMP."hiHokenshaNo",
               TEMP."serviceTeikyoYM",
               TEMP."seiriNo",
               TEMP."no"
    </select>
    
    <!-- 償還払請求集計一時テーブルを作成します。 -->
    <insert id="create償還払請求集計一時テーブル">
        CREATE TEMP TABLE "TABLE_SHOKANSHUKEIKETTEIIN" 
        (
            "hihokenshaNo" rgdb."DbUDD002HihokenshaNo",
            "serviceTeikyoYM" rshare."UDD014YM",
            "seiriNo" character varying(10),
            "jigyoshoNo" rgdb."DbUDD004JigyoshaNo",
            "serviceShuruiCode" rgdb."DbUDD005ServiceShuruiCode",
            "shikyuKubunCode" character varying(1),
            "tensuKingaku" numeric(10,2),
            "fushikyuRiyu" character varying(100),
            "kounyuKaishuRireki" character varying(100)
        )
    </insert>
    
    <resultMap id="resultMap_ShokanFushikyuKetteiIn" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanfushikyuketteiin.ShokanFushikyuKetteiInEntity">
        <result property="hiHokenshaNo" column="hiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <result property="serviceTeikyoYM" column="serviceTeikyoYM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="seiriNo" column="seiriNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="jigyoshoNo" column="jigyoshoNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
        <result property="serviceShuruiCode" column="serviceShuruiCode" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ServiceShuruiCodeTypeHandler"/>
        <result property="shikyuKubunCode" column="shikyuKubunCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="tensuKingaku" column="tensuKingaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="bikoOne" column="bikoOne" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="bikoTwo" column="bikoTwo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>
    <select id="select償還払不支給決定情報一時" resultMap="resultMap_ShokanFushikyuKetteiIn" fetchSize="500">
        SELECT TEMP."hiHokenshaNo",
               TEMP."serviceTeikyoYM",
               TEMP."seiriNo",
               TEMP."jigyoshoNo",
               TEMP."serviceShuruiCode",
               TEMP."shikyuKubunCode",
               SUM(TEMP."tensuKingaku") AS tensuKingaku,
               MAX(TEMP."bikoOne") AS bikoOne,
               MAX(TEMP."bikoTwo") AS bikoTwo
        FROM "DbTShokanFushikyuKetteiInTempTable" AS TEMP
        GROUP BY
               TEMP."hiHokenshaNo",
               TEMP."serviceTeikyoYM",
               TEMP."seiriNo",
               TEMP."jigyoshoNo",
               TEMP."serviceShuruiCode",
               TEMP."shikyuKubunCode"
        ORDER BY
               TEMP."hiHokenshaNo" DESC,
               TEMP."serviceTeikyoYM" DESC
        
    </select>
    
    <!-- 償還払請求集計一時テーブルに登録する。 -->
    <insert id="insert償還払請求集計一時テーブル" parameterType="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanfushikyuketteiin.ShokanShukeiKetteiInEntity">
        INSERT INTO "TABLE_SHOKANSHUKEIKETTEIIN"
        VALUES(
            #{被保険者番号},
            #{サービス提供年月},
            #{整理番号},
            #{事業所番号},
            #{サービス種類コード},
            #{支給区分コード},
            #{点数_金額},
            #{不支給理由等},
            #{購入_改修履歴等}
        )
    </insert>
    
    <!-- 償還払請求集計を更新する。 -->
    <update id="update償還払請求集計">
        UPDATE rgdb."DbT3053ShokanShukei" a
        SET    "shikyuKubunCode" = TEMP."shikyuKubunCode",
               "tensuKingaku" = TEMP."tensuKingaku",
               "hushikyuRiyu" = TEMP."fushikyuRiyu",
               "kounyuKaishuRireki" = TEMP."kounyuKaishuRireki"
        FROM   "TABLE_SHOKANSHUKEIKETTEIIN" AS TEMP
        WHERE  a."hiHokenshaNo" = TEMP."hihokenshaNo"
        AND    a."serviceTeikyoYM" = TEMP."serviceTeikyoYM"
        AND    a."seiriNo" = TEMP."seiriNo"
        AND    a."jigyoshaNo" = TEMP."jigyoshoNo"
        AND    a."serviceShuruiCode" = TEMP."serviceShuruiCode"
    </update>
    
    <!-- 償還払請求食事費用を更新する。 -->
    <update id="update償還払請求食事費用">
        UPDATE rgdb."DbT3043ShokanShokujiHiyo" a
        SET    "shikyuKubunCode" = TEMP."shikyuKubunCode",
               "tensuKingaku" = TEMP."tensuKingaku"
        FROM   "TABLE_SHOKANSHUKEIKETTEIIN" AS TEMP
        WHERE  a."hiHokenshaNo" = TEMP."hihokenshaNo"
        AND    a."serviceTeikyoYM" = TEMP."serviceTeikyoYM"
        AND    a."seiriNo" = TEMP."seiriNo"
        AND    a."jigyoshaNo" = TEMP."jigyoshoNo"
        AND    TEMP."serviceShuruiCode" IS NULL
    </update>
    
    <!-- 償還払請求サービス計画200004を更新する -->
    <update id="update償還払請求サービス計画200004">
        UPDATE rgdb."DbT3045ShokanServicePlan200004" a
        SET    "shikyuKubunCode" = TEMP."shikyuKubunCode",
               "tensuKingaku" = TEMP."tensuKingaku",
               "fushikyuRiyu" = TEMP."fushikyuRiyu",
               "kounyuKaishuRireki" = TEMP."kounyuKaishuRireki"
        FROM   "TABLE_SHOKANSHUKEIKETTEIIN" AS TEMP
        WHERE  a."hiHokenshaNo" = TEMP."hihokenshaNo"
        AND    a."serviceTeikyoYM" = TEMP."serviceTeikyoYM"
        AND    a."seiriNo" = TEMP."seiriNo"
        AND    a."jigyoshaNo" = TEMP."jigyoshoNo"
        AND    substring(a."serviceCode", 1, 2) = TEMP."serviceShuruiCode"
    </update>
    
    <!-- 償還払請求サービス計画200604を更新する -->
    <update id="update償還払請求サービス計画200604">
        UPDATE rgdb."DbT3046ShokanServicePlan200604" a
        SET    "shikyuKubunCode" = TEMP."shikyuKubunCode",
               "tensuKingaku" = TEMP."tensuKingaku",
               "fushikyuRiyu" = TEMP."fushikyuRiyu",
               "kounyuKaishuRireki" = TEMP."kounyuKaishuRireki"
        FROM   "TABLE_SHOKANSHUKEIKETTEIIN" AS TEMP
        WHERE  a."hiHokenshaNo" = TEMP."hihokenshaNo"
        AND    a."serviceTeikyoYM" = TEMP."serviceTeikyoYM"
        AND    a."seiriNo" = TEMP."seiriNo"
        AND    a."jigyoshaNo" = TEMP."jigyoshoNo"
        AND    substring(a."serviceCode", 1, 2) = TEMP."serviceShuruiCode"
    </update>

    <!-- 償還払請求サービス計画200904を更新する -->
    <update id="update償還払請求サービス計画200904">
        UPDATE rgdb."DbT3047ShokanServicePlan200904" a
        SET    "shikyuKubunCode" = TEMP."shikyuKubunCode",
               "tensuKingaku" = TEMP."tensuKingaku",
               "fushikyuRiyu" = TEMP."fushikyuRiyu",
               "kounyuKaishuRireki" = TEMP."kounyuKaishuRireki"
        FROM   "TABLE_SHOKANSHUKEIKETTEIIN" AS TEMP
        WHERE  a."hiHokenshaNo" = TEMP."hihokenshaNo"
        AND    a."serviceTeikyoYM" = TEMP."serviceTeikyoYM"
        AND    a."seiriNo" = TEMP."seiriNo"
        AND    a."jigyoshaNo" = TEMP."jigyoshoNo"
        AND    substring(a."serviceCode", 1, 2) = TEMP."serviceShuruiCode"
    </update>
    
    <!-- 償還払請求特定入所者介護サービス費用を更新する。 -->
    <update id="update償還払請求特定入所者介護サービス費用">
        UPDATE rgdb."DbT3050ShokanTokuteiNyushoshaKaigoServiceHiyo" a
        SET    "shikyuKubunCode" = TEMP."shikyuKubunCode",
               "tensuKingaku" = TEMP."tensuKingaku"
        FROM   "TABLE_SHOKANSHUKEIKETTEIIN" AS TEMP
        WHERE  a."hiHokenshaNo" = TEMP."hihokenshaNo"
        AND    a."serviceTeikyoYM" = TEMP."serviceTeikyoYM"
        AND    a."seiriNo" = TEMP."seiriNo"
        AND    a."jigyoshaNo" = TEMP."jigyoshoNo"
        AND    a."serviceShuruiCode" = TEMP."serviceShuruiCode"
    </update>
    
</mapper>