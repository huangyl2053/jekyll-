<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBC-3420-010 tz_chengpeng -->

<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.shichosontokubetukyufuservice.IShichosonTokubetuKyufuServiceMapper">

    <select resultOrdered="true" id="get一覧情報" resultMap="ResultMap_ShichosonTokubetuKyufuServiceEntity"  fetchSize="500">
        SELECT
        "serviceCode",
        "serviceYukoKikanKaishiYMD",
        "serviceYukoKikanShuryoYMD",
        "rirekiNo",
        "serviceSeishikiName",
        "serviceRyakushoName",
        "serviceKubun",
        "tanisuNissu",
        "shikyuGendoKijungaku",
        row_number() OVER (PARTITION BY "serviceCode" ORDER BY "rirekiNo" DESC) AS "直近フラグ"
        FROM
        rgdb."DbT3066ShichosonTokubetuKyufuService"
        WHERE
        rgdb."DbT3066ShichosonTokubetuKyufuService"."isDeleted" = FALSE
        ORDER BY "serviceCode" ASC,
        "serviceYukoKikanKaishiYMD" DESC
    </select>

    <select resultOrdered="true" id="get最大履歴番号" resultType="int"
            parameterType="jp.co.ndensan.reams.uz.uza.lang.RString" fetchSize="500">
        SELECT
        max("rirekiNo") as "rirekiNo"
        FROM
        rgdb."DbT3066ShichosonTokubetuKyufuService"
        WHERE
        "serviceCode" = #{serviceCode}
    </select>

    <resultMap id="ResultMap_ShichosonTokubetuKyufuServiceEntity" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.shichosontokubetukyufuservice.ShichosonTokubetuKyufuServiceEntity" autoMapping="true">
        <result property="サービスコード" column="serviceCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="有効期間開始年月日" column="serviceYukoKikanKaishiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="有効期間終了年月日" column="serviceYukoKikanShuryoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="履歴番号" column="rirekiNo" />
        <result property="正式名称" column="serviceSeishikiName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="略称" column="serviceRyakushoName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="サービス区分" column="serviceKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="単位" column="tanisuNissu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="支給限度基準額" column="shikyuGendoKijungaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="直近フラグ" column="直近フラグ" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>

</mapper>
