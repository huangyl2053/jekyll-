<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 過誤申立決定情報照会用XMLです。 -->
<!-- @reamsid_L DBC-2940-010 jinjue -->

<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.taishoshakensakumapper.ITaishoshaKensakuRelateMapper">

    <select resultOrdered="true" id="get過誤決定情報"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.taishoshakensakumybatisprm.TaishoshaKensakuMybitisParamter"
            resultMap="ResultMap_TaishoshaKensakuRelateEntity" fetchSize="500">
        SELECT
        T3060."toriatsukaiYM",
        T3060."hokenshaKubun",
        T3060."rirekiNo",
        T3060."kaigoKyufuhiKensu",
        T3060."kaigoKyufuhiTanisu",
        T3060."kaigoKyufuhiFutangaku",
        T3060."kogakuServicehiKensu",
        T3060."kogakuServicehiTanisu",
        T3060."kogakuServicehiFutangaku",
        T3060."tokuteiNyushoshaServicehiKensu",
        T3060."tokuteiNyushoshaServicehiTanisu",
        T3060."tokuteiNyushoshaServicehiFutangaku",
        T3060."kohiFutanshaNo",
        T3060."sakuseiYMD",
        T3060."torikomiYM",
        T3061."toriatsukaiYM" AS "取扱年月明細",
        T3061."hokenshaKubun" AS "保険者区分明細",
        T3061."rirekiNo" AS "履歴番号明細",
        T3061."jigyoshoNo",
        T3061."jigyoshoName",
        T3061."hiHokenshaNo",
        T3061."kohiJukyushaNo",
        T3061."shokisaiHokenshaNo",
        T3061."serviceTeikyoYM",
        T3061."serviceShuruiCode",
        T3061."serviceShuruiName",
        T3061."kagomoushitateJiyuCode",
        T3061."kagomoushitateJiyu",
        T3061."tanisu",
        T3061."hokenshaFutangaku",
        T3061."torikomiYM" AS "取込年月明細",
        "宛名"."meisho" AS "被保険者氏名",
        T0007."codeRyakusho" AS "様式"
        FROM
        rgdb."DbT3060KagoKetteiShukei" AS T3060
        LEFT JOIN
        rgdb."DbT3061KagoKetteiMeisai" AS T3061
        ON	T3061."toriatsukaiYM"=T3060."toriatsukaiYM"
        AND	T3061."hokenshaKubun"=T3060."hokenshaKubun"
        AND	T3061."rirekiNo"=T3060."rirekiNo"
        LEFT JOIN rgdb."DbV1001HihokenshaDaicho" AS dbv1001
        ON dbv1001."hihokenshaNo" = T3061."hiHokenshaNo"
        LEFT JOIN rgua."UaFt200FindShikibetsuTaisho"('','',FALSE,'DB',FALSE,'','','','','','','','','','','',TRUE,
        '','','','','','','',FALSE,'','','','','','','','','','','',FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,
        FALSE,'','','','','','','','',FALSE,'','',FALSE,FALSE,FALSE,'','','','','','','','','','','','','','','','','','','{}')
        AS 宛名
        ON 宛名."shikibetsuCode" = dbv1001."shikibetsuCode"
        LEFT JOIN
        rgdb."UzT0007Code" AS T0007
        ON	T0007."schemaName"='rgdb'
        AND	T0007."subGyomuCode"='DBC'
        AND	T0007."codeShubetsu"=#{コード種別}
        AND	T0007."code" = substr(T3061."kagomoushitateJiyuCode",1,2)
        WHERE
        T3060."toriatsukaiYM" = #{取扱年月} AND
        T3060."hokenshaKubun" = #{保険者区分}
        <if test="履歴番号フラグ">
            AND T3060."rirekiNo" = #{履歴番号}
        </if>
        <if test="!履歴番号フラグ">
            AND T3060."rirekiNo" = (SELECT MAX("rirekiNo") FROM rgdb."DbT3063SaishinsaKetteiShukei"
            WHERE "toriatsukaiYM" = #{取扱年月}
            AND "hokenshaKubun" = #{保険者区分})
        </if>
        <if test="市町村フラグ">
            AND substr(T3060."kohiFutanshaNo",1,5) = #{市町村コード}
        </if>
        ORDER BY
        T3061."jigyoshoNo"
    </select>

    <resultMap id="ResultMap_TaishoshaKensaku" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.taishoshakensaku.TaishoshaKensakuRelateEntity" autoMapping="true">
        <result property="保険者区分_再" column="保険者区分" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="履歴番号_再" column="履歴番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
    </resultMap>

    <select id="select履歴番号情報" resultMap="ResultMap_TaishoshaKensaku"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.taishoshakensakumybatisprm.TaishoshaKensakuMybitisParamter" fetchSize="500" resultOrdered="true">
        SELECT T3060."hokenshaKubun" AS 保険者区分,
        T3060."rirekiNo" AS 履歴番号
        FROM rgdb."DbT3060KagoKetteiShukei" AS T3060
        WHERE T3060."toriatsukaiYM" = #{取扱年月}
        <if test="市町村フラグ">
            AND substr(T3060."kohiFutanshaNo",1,5) = #{市町村コード}
        </if>
        ORDER BY T3060."rirekiNo" DESC
    </select>


    <resultMap id="ResultMap_TaishoshaKensakuRelateEntity" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.taishoshakensaku.TaishoshaKensakuRelateEntity" autoMapping="true">
        <result property="取扱年月" column="toriatsukaiYM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="保険者区分" column="hokenshaKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="履歴番号" column="rirekiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="介護給付費件数" column="kaigoKyufuhiKensu" />
        <result property="介護給付費単位数" column="kaigoKyufuhiTanisu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="介護給付費保険者負担額" column="kaigoKyufuhiFutangaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="高額介護サービス費件数" column="kogakuServicehiKensu" />
        <result property="高額介護サービス費単位数" column="kogakuServicehiTanisu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="高額介護サービス費保険者負担額" column="kogakuServicehiFutangaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="特定入所者介護サービス費等件数" column="tokuteiNyushoshaServicehiKensu" />
        <result property="特定入所者介護サービス費等費用額" column="tokuteiNyushoshaServicehiTanisu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="特定入所者介護サービス費等保険者負担額" column="tokuteiNyushoshaServicehiFutangaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="公費負担者番号" column="kohiFutanshaNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="作成年月日" column="sakuseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="取込年月" column="torikomiYM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="取扱年月_明細" column="取扱年月明細" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="保険者区分_明細" column="保険者区分明細" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="履歴番号_明細" column="履歴番号明細" />
        <result property="事業所番号" column="jigyoshoNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
        <result property="事業所名" column="jigyoshoName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="被保険者番号" column="hiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <result property="公費受給者番号" column="kohiJukyushaNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="証記載保険者番号" column="shokisaiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HokenshaNoTypeHandler"/>
        <result property="サービス提供年月" column="serviceTeikyoYM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="サービス種類コード" column="serviceShuruiCode" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ServiceShuruiCodeTypeHandler"/>
        <result property="サービス種類名" column="serviceShuruiName" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="過誤申立事由コード" column="kagomoushitateJiyuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.CodeTypeHandler"/>
        <result property="過誤申立事由" column="kagomoushitateJiyu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="単位数" column="tanisu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="保険者負担額" column="hokenshaFutangaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="取込年月_明細" column="取込年月明細" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="コード略称" column="様式" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="被保険者氏名" column="被保険者氏名" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>
</mapper>