<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBC-3000-060 gongliang -->
<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.kogakushokaitaishoshakensaku.IKogakuShokaiTaishoshaKensakuMapper">
   
    <resultMap id="resultMap_KogakuShokaiTaishoshaKensakuEntity" 
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.kogakushokaitaishoshakensaku.KogakuShokaiTaishoshaKensakuEntity" autoMapping="true">
        <result property="被保険者番号" column="被保険者番号" 
                typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <result property="申請者氏名" column="氏名" 
                typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler"/>
        <result property="サービス提供年月" column="サービス提供年月" 
                typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="高額支給額" column="高額支給額" 
                typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="申請日" column="申請日" 
                typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="決定日" column="決定日" 
                typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="支給区分コード" column="支給区分コード" 
                typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="支給金額" column="支給金額" 
                typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="高額自動償還" column="高額自動償還"/>
        <result property="履歴番号" column="履歴番号" 
                typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
    </resultMap>

    <!-- 検索条件より、対象者一覧を取得する。-->
    <select id="selectTaishosha" 
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.kogakushokaitaishoshakensaku.KogakuShokaiTaishoshaKensakuSearch"
            resultMap="resultMap_KogakuShokaiTaishoshaKensakuEntity" fetchSize="500">
        SELECT
            A."hihokenshaNo" AS 被保険者番号,
            "ShikibetsuTaisho"."meisho" AS 氏名,
            A."serviceTeikyoYM" AS サービス提供年月,
            C."KogakuShikyuGaku" AS 高額支給額,
            A."shinseiYMD" AS 申請日,
            B."ketteiYMD" AS 決定日,
            B."shikyuKubunCode" AS 支給区分コード,
            B."shikyuKingaku" AS 支給金額,
            C."jidoShokanTaishoFlag" AS 高額自動償還,
            A."rirekiNo" AS 履歴番号
        FROM
            rgdb."DbT3056KogakuShikyuShinsei" AS A
        LEFT JOIN
            rgdb."DbT3057KogakuShikyuHanteiKekka" AS B
        ON
            A."hihokenshaNo" = B."hihokenshaNo"
        AND A."serviceTeikyoYM" = B."serviceTeikyoYM"
        AND A."rirekiNo" = B."rirekiNo"
        LEFT JOIN
            rgdb."DbT3055KogakuKyufuTaishoshaGokei" AS C
        ON
            A."hihokenshaNo" = C."hihokenshaNo"
        AND A."serviceTeikyoYM" = C."serviceTeikyoYM"
        AND A."rirekiNo" = C."rirekiNo"
        INNER JOIN
            rgdb."DbV1001HihokenshaDaicho" AS D
        ON D."hihokenshaNo" = A."hihokenshaNo"
        INNER JOIN 
            rgua."UaFt200FindShikibetsuTaisho"('1','',TRUE,'DB',FALSE,'','','','','','','','','','','',TRUE,'','','','',
            '','','0','0','','','','','','','','','','0','','1','1','1','1','1','1', '1','1','1','1', '1','','',
            '','','','','','0','0','','','0','0','0','','','','','','','','','','','','','','','','','','', '{  }') AS "ShikibetsuTaisho"
        ON "ShikibetsuTaisho"."shikibetsuCode" = D."shikibetsuCode"
        WHERE 1 = 1
        <if test="指定して場合">
            <if test="被保険者番号 != null and !被保険者番号.isEmpty()">
                AND A."hihokenshaNo" = #{被保険者番号}
            </if>
            <if test="提供年月From != null and !提供年月From.isEmpty()">
                AND #{提供年月From} <![CDATA[<=]]> A."serviceTeikyoYM" 
            </if>
            <if test="提供年月To != null and !提供年月To.isEmpty()">
                AND A."serviceTeikyoYM" <![CDATA[<=]]> #{提供年月To}
            </if>
            <if test="申請年月From != null and !申請年月From.isEmpty()">
                AND #{申請年月From} <![CDATA[<=]]> A."shinseiYMD" 
            </if>
            <if test="申請年月To != null and !申請年月To.isEmpty()">
                AND A."shinseiYMD" <![CDATA[<=]]> #{申請年月To}
            </if>
            <if test="決定年月From != null and !決定年月From.isEmpty()">
                AND #{決定年月From} <![CDATA[<=]]> B."ketteiYMD"
            </if>
            <if test="決定年月To != null and !決定年月To.isEmpty()">
                AND B."ketteiYMD" <![CDATA[<=]]> #{決定年月To}
            </if>
        </if>
        <if test="!指定して場合">
            <if test="提供年月 != null and !提供年月.isEmpty()">
                AND A."serviceTeikyoYM" =  #{提供年月}
            </if>
            <if test="申請年月初 != null and !申請年月初.isEmpty()">
                AND #{申請年月初} <![CDATA[<=]]> A."shinseiYMD"
            </if>
            <if test="申請年月末 != null and !申請年月末.isEmpty()">
                AND A."shinseiYMD" <![CDATA[<=]]> #{申請年月末}
            </if>
            <if test="決定年月初 != null and !決定年月初.isEmpty()">
                AND #{決定年月初} <![CDATA[<=]]> B."ketteiYMD"
            </if>
            <if test="決定年月末 != null and !決定年月末.isEmpty()">
                AND B."ketteiYMD" <![CDATA[<=]]>  #{決定年月末}
            </if>
        </if>
    </select>
</mapper>