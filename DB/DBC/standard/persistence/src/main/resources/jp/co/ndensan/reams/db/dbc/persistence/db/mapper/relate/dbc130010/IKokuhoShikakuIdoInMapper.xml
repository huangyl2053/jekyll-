<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBC-3020-030 dengwei-->
<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.dbc130010.IKokuhoShikakuIdoInMapper">
    <select resultOrdered="true" id = "get取込国保情報Temp" resultMap="取込国保情報_ResultMap" fetchSize="500">
        SELECT
        T1.*,
        T2.件数
        FROM
        "tempTorikomiKokuhoJyoho" AS T1
        LEFT OUTER JOIN
        (SELECT
        T1."iN住民コード",
        COUNT(T1."iN住民コード") AS 件数
        FROM
        "tempTorikomiKokuhoJyoho" AS T1
        GROUP BY
        T1."iN住民コード") AS T2
        ON T1."iN住民コード" = T2."iN住民コード"
        ORDER BY
        T1."iN住民コード" ASC
    </select>
    
    <select resultOrdered="true" id = "get構成市町村マスタ" resultType="jp.co.ndensan.reams.uz.uza.biz.LasdecCode" fetchSize="500">
        SELECT
        D1."shichosonCode"
        FROM
        rgdb."DbT5051KoseiShichosonMaster" as D1
    </select>
    
    <select resultOrdered="true" id = "get国保管理データ作成用データ" 
            resultMap="国保管理データ作成用データResultMap" fetchSize="500">
        WITH master AS(
        SELECT
        データ件数,
        T1.*
        FROM
        "tempTorikomiKokuhoJyoho" AS T1
        LEFT OUTER JOIN
        (
        SELECT
        COUNT (D2."shikibetsuCode") AS データ件数
        ,D2. "shikibetsuCode"
        FROM
        rgdb. "DbT7123KokuhoShikakuInfo" AS D2
        GROUP BY D2. "shikibetsuCode"
        ) AS D3
        ON D3. "shikibetsuCode" = T1. "iN住民コード"
        )

        SELECT
        master.*,
        <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.columns_ShikibetsuTaisho" />
        FROM
        master AS master
        LEFT OUTER JOIN
        rgua."UaFt200FindShikibetsuTaisho"('','',FALSE,'DB',FALSE,'','','','','','','','','','','',true,
        '','','','','','','',true,'','','','','','','','','','','',true,true,true,true,true,true,true,true,true,true,
        true,'','','','','','','','',true,'','',true,true,true,'','','','','','','','','','','','','','','','','','','{
        SELECT
        ARRAY_AGG(CAST (master."iN住民コード" AS TEXT))
        FROM
        master
        }') AS "ShikibetsuTaisho"
        ON "ShikibetsuTaisho"."shikibetsuCode" = master."iN住民コード"
    </select>
    
    <select resultOrdered="true" id = "get国保資格情報インポート用データ" 
            resultMap="国保資格情報インポート用データResultMap" fetchSize="500">
        (SELECT
        T1.*,
        D1.*
        FROM
        "tempTorikomiKokuhoJyoho" AS T1
        LEFT OUTER JOIN
        rgdb."DbT7123KokuhoShikakuInfo" AS D1
        ON D1."shikibetsuCode" = T1."iN住民コード")
        UNION
        (SELECT
        T1.*,
        D1.*
        FROM
        rgdb."DbT7123KokuhoShikakuInfo" AS D1
        LEFT OUTER JOIN
        "tempTorikomiKokuhoJyoho" AS T1
        ON D1."shikibetsuCode" = T1."iN住民コード")
        
    </select>
    
    <select resultOrdered="true" id = "get国保資格情報インポート用Entitｙリスト" 
            resultType="jp.co.ndensan.reams.db.dbc.entity.db.relate.dbc130010.KokuhoShikakuJyohoInpotoyoEntity" fetchSize="500">
        SELECT
        *
        FROM
        "tempKokuhoShikakuJyohoInpotoyo"
    </select>
    
    <select resultOrdered="true" id = "get国保資格情報インポート用Entitｙ件数" 
            resultType="java.lang.Integer" fetchSize="500">
        SELECT
        COUNT(*)
        FROM
        "tempKokuhoShikakuJyohoInpotoyo"
    </select>
    
    <delete id = "delete国保資格情報">
        DELETE FROM rgdb."DbT7123KokuhoShikakuInfo"
    </delete>
    
    <select resultOrdered="true" id = "up処理管理日付マスタ" 
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.dbc130010.UpdShoriDateKanriMybatisParameter" fetchSize="500">
        UPDATE
        rgdb."DbT7022ShoriDateKanri" AS D1
        SET 
        "kijunYMD" = #{基準年月日},
        "kijunTimestamp" = #{基準日時},
        "taishoKaishiYMD" = #{対象開始年月日},
        "taishoKaishiTimestamp" = #{対象開始日時},
        "lastUpdateTimestamp" = #{処理日時},
        "updateCount" = D1."updateCount"+1
        WHERE
        D1."shoriName" = #{処理名} AND
        D1."shoriEdaban" = #{処理枝番}
    </select>
    
    <resultMap  id="取込国保情報_ResultMap" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.dbc130010.TorikomiKokuhoJyohoResultEntity" autoMapping="false">
        <id column="市町村コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id column="iN住民コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id column="履歴番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="件数" column="件数"/>
        <association property="取込国保情報Entity" resultMap="ResultMap_取込国保情報"/>
    </resultMap>
    
    <resultMap  id="国保管理データ作成用データResultMap" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.dbc130010.KokuhoKannriDataYoEntity" autoMapping="false">
        <id column="市町村コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id column="iN住民コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id column="履歴番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="データ件数" column="データ件数"/>
        <association property="取込国保情報Entity" resultMap="ResultMap_取込国保情報"/>
        <association property="宛名識別対象Entity"  resultMap="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.UaFt200FindShikibetsuTaishoEntity"/>
    </resultMap>
    
    <resultMap  id="国保資格情報インポート用データResultMap" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.dbc130010.KokuhoShikakuJyohoYoResultEntity" autoMapping="true">
        <id column="市町村コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id column="iN住民コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id column="履歴番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id column="dbT7123KokuhoShikakuInfo_shikibetsuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
        <id column="dbT7123KokuhoShikakuInfo_rirekiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <association property="取込国保情報Entity" resultMap="ResultMap_取込国保情報"/>
        <association property="現在国保資格情報Entity"  resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT7123KokuhoShikakuInfoMapper.ResultMap_DbT7123KokuhoShikakuInfoEntity"/>
    </resultMap>
    
    <resultMap id="ResultMap_取込国保情報" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.dbc130010.TorikomiKokuhoJyohoEntity" autoMapping="true">
        <id property="市町村コード" column="市町村コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id property="iN住民コード" column="iN住民コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id property="履歴番号" column="履歴番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="国保番号" column="国保番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="国保資格取得年月日" column="国保資格取得年月日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="国保資格喪失年月日" column="国保資格喪失年月日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="国保保険者番号" column="国保保険者番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="国保保険証番号" column="国保保険証番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="国保個人番号" column="国保個人番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="国保退職該当日" column="国保退職該当日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="国保退職非該当日" column="国保退職非該当日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="個人区分コード" column="個人区分コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="登録区分" column="登録区分" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="更新コード" column="更新コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="氏名" column="氏名" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="カナ氏名" column="カナ氏名" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="生年月日" column="生年月日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="性別コード" column="性別コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="郵便番号" column="郵便番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="住所" column="住所" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="方書" column="方書" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="バイト数" column="バイト数" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="エラーコード" column="エラーコード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="エラー文言" column="エラー文言" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="エラー区分" column="エラー区分" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>
</mapper>
