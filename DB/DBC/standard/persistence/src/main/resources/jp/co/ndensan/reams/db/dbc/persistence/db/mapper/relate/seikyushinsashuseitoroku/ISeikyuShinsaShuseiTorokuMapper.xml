<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 概要： 広域内転居のマッピング用XMLです。 -->
<!-- @reamsid_L DBE-1660-010 xuyongchao -->

<!-- どのマッパーインターフェースと対応するかを指定する -->
<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.seikyushinsashuseitoroku.ISeikyuShinsaShuseiTorokuMapper">
    <resultMap id="resultMap_SeikyuShinsaShuseiTorokuRelateEntity" 
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.seikyushinsashuseitoroku.SeikyuShinsaShuseiTorokuRelateEntity" autoMapping="true">
        <id property="dbT3094.riyushoSakuseiJigyoshaNo" column="dbT3094_riyushoSakuseiJigyoshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
        <id property="dbT3094.ketteiYMD" column="dbT3094JutakuKaishuRiyushoTesuryoKettei_ketteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <id property="dbT3094.rirekiNo" column="dbT3094JutakuKaishuRiyushoTesuryoKettei_rirekiNo" />
        <id property="dbT3095.shoKisaiHokenshaNo" column="dbT3095JutakuKaishuRiyushoTesuryoMeisai_shoKisaiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HokenshaNoTypeHandler"/>
        <id property="dbT3095.hihokenshaNo" column="dbT3095JutakuKaishuRiyushoTesuryoMeisai_hihokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <id property="dbT3095.rirekiNo" column="dbT3095JutakuKaishuRiyushoTesuryoMeisai_rirekiNo" />
        <id property="dbT3096.shoKisaiHokenshaNo" column="dbT3096JutakuKaishuRiyushoTesuryoShukei_shoKisaiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HokenshaNoTypeHandler"/>
        <id property="dbT3096.riyushoSakuseiJigyoshaNo" column="dbT3096_riyushoSakuseiJigyoshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
        <id property="dbT3096.shukeiNo" column="dbT3096JutakuKaishuRiyushoTesuryoShukei_shukeiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <id property="dbT3096.rirekiNo" column="dbT3096JutakuKaishuRiyushoTesuryoShukei_rirekiNo" />
        
        <association property="dbT3094" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3094JutakuKaishuRiyushoTesuryoKetteiMapper.ResultMap_DbT3094JutakuKaishuRiyushoTesuryoKetteiEntity"/>
        <association property="dbT3095" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3095JutakuKaishuRiyushoTesuryoMeisaiMapper.ResultMap_DbT3095JutakuKaishuRiyushoTesuryoMeisaiEntity"/>
        <association property="dbT3096" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3096JutakuKaishuRiyushoTesuryoShukeiMapper.ResultMap_DbT3096JutakuKaishuRiyushoTesuryoShukeiEntity"/>
    </resultMap>

    <select id="selectSeikyuShinsaShuseiTorokuList" resultMap="resultMap_SeikyuShinsaShuseiTorokuRelateEntity" 
        resultOrdered="true"  parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.seikyushinsashuseitoroku.SeikyuShinsaShuseiTorokuMapperParameter" 
             fetchSize="500">
        SELECT
        <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3094JutakuKaishuRiyushoTesuryoKetteiMapper.allColumns_DbT3094JutakuKaishuRiyushoTesuryoKettei" />,
        <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3095JutakuKaishuRiyushoTesuryoMeisaiMapper.allColumns_DbT3095JutakuKaishuRiyushoTesuryoMeisai" />,
        <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3096JutakuKaishuRiyushoTesuryoShukeiMapper.allColumns_DbT3096JutakuKaishuRiyushoTesuryoShukei" />  
          FROM
             (SELECT * FROM rgdb."DbT3096JutakuKaishuRiyushoTesuryoShukei" AS 集計
    WHERE 集計."isDeleted" =  FALSE ) AS "DbT3096JutakuKaishuRiyushoTesuryoShukei" 
	 INNER JOIN
	   (SELECT * FROM rgdb."DbT3095JutakuKaishuRiyushoTesuryoMeisai" AS 明細
    WHERE 明細."isDeleted" =  FALSE ) AS "DbT3095JutakuKaishuRiyushoTesuryoMeisai"
	ON
	"DbT3096JutakuKaishuRiyushoTesuryoShukei"."shukeiNo" = "DbT3095JutakuKaishuRiyushoTesuryoMeisai"."shukeiNo"
	LEFT JOIN 
	(SELECT * FROM rgdb."DbT3094JutakuKaishuRiyushoTesuryoKettei" AS 決定
    WHERE 決定."isDeleted" =  FALSE ) AS "DbT3094JutakuKaishuRiyushoTesuryoKettei"
	ON
		"DbT3096JutakuKaishuRiyushoTesuryoShukei"."shukeiNo" = "DbT3094JutakuKaishuRiyushoTesuryoKettei"."shukeiNo"
		WHERE 
                 1=1
                <if test="事業者番号フラグ">
		AND "DbT3096JutakuKaishuRiyushoTesuryoShukei"."riyushoSakuseiJigyoshaNo" = #{事業者番号}
                </if>
                <if test="理由書作成年月フラグ">
		AND substring("DbT3096JutakuKaishuRiyushoTesuryoShukei"."seikyuJohoSakuseiYMD" from 1 for 6) = #{請求情報作成年月}
                </if>
                <if test="メニューID_1004">
		AND "DbT3094JutakuKaishuRiyushoTesuryoKettei"."shikyu_FushikyuKetteiYMD" IS NULL 
                </if>
                <if test="メニューID_1005">
		AND "DbT3094JutakuKaishuRiyushoTesuryoKettei"."shikyu_FushikyuKetteiYMD" IS NULL 
                </if>
	ORDER BY
	"DbT3096JutakuKaishuRiyushoTesuryoShukei"."seikyuJohoSakuseiYMD" DESC,
	"DbT3096JutakuKaishuRiyushoTesuryoShukei"."shukeiNo" ASC,
	"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."hihokenshaNo" ASC
    </select>
</mapper>
