<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--@reamsid_L DBC-2850-030 zuotao-->
<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.kaishuriyushoshikyuketteitsuchishosakusei.IKaishuriyushoShikyuKetteitsuchishoSakuseiMapper">
    <resultMap id= "ResultMap_住宅改修理由書作成手数料請求" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.kaishuriyushoshikyuketteitsuchisho.KaishuriyushoShikyuKetteitsuchishoEntity"
               autoMapping="true">
        <result property="shikibetsuCode" column="shikibetsuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
        <result property="riyushoSakuseiSeikyuKingaku" column="riyushoSakuseiSeikyuKingaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="jutakuKaishuJigyoshaMeisho" column="jutakuKaishuJigyoshaMeisho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler"/>
        <result property="kaishuNaiyo_kasho_Kibo" column="kaishuNaiyo_kasho_Kibo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="kaishuTaishoJutakuJusho" column="kaishuTaishoJutakuJusho" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="riyushoSakuseiYMD" column="riyushoSakuseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="hihokenshaNo" column="hihokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <result property="riyushoSakuseiUketsukeYMD" column="riyushoSakuseiUketsukeYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="tesuryoShiharaiYoteiYMD" column="tesuryoShiharaiYoteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="fushikyuRiyu" column="fushikyuRiyu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shikyu_FushikyuKetteiYMD" column="shikyu_FushikyuKetteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shikyu_FushikyuKubun" column="shikyu_FushikyuKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="riyushoSakuseiJigyoshaNo" column="riyushoSakuseiJigyoshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
        <result property="shoKisaiHokenshaNo" column="shoKisaiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HokenshaNoTypeHandler"/>
        <result property="jutakuKaishuJushoShozaisha" column="jutakuKaishuJushoShozaisha" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler"/>
        <result property="serviceCode" column="serviceCode" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ServiceCodeTypeHandler"/>
        <result property="jutakuKaishuChakkoYMD" column="jutakuKaishuChakkoYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="riyushoSakuseishaMei" column="riyushoSakuseishaMei" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler"/>
        <result property="riyushoSakuseishaMeiKana" column="riyushoSakuseishaMeiKana" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="riyushoSakuseiShinseiYMD" column="riyushoSakuseiShinseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shukeiNo" column="shukeiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shukeiFlag" column="shukeiFlag" />
    </resultMap>
    <select id="get住宅改修理由書作成手数料請求" resultOrdered="true" resultMap="ResultMap_住宅改修理由書作成手数料請求"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.dbc100020.KaishuriyushoShikyuKetteitsuchishoParameter"  fetchSize="500">
        SELECT
        DbT1001HihokenshaDaicho."dbT1001HihokenshaDaicho_shikibetsuCode" AS "shikibetsuCode"
        ,"DbT3094JutakuKaishuRiyushoTesuryoKettei"."riyushoSakuseiJigyoshaNo" AS "riyushoSakuseiJigyoshaNo"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."riyushoSakuseiUketsukeYMD" AS "riyushoSakuseiUketsukeYMD"
        ,"DbT3094JutakuKaishuRiyushoTesuryoKettei"."tesuryoShiharaiYoteiYMD" AS "tesuryoShiharaiYoteiYMD"
        ,"DbT3094JutakuKaishuRiyushoTesuryoKettei"."shikyu_FushikyuKetteiYMD" AS "shikyu_FushikyuKetteiYMD"
        ,"DbT3094JutakuKaishuRiyushoTesuryoKettei"."shikyu_FushikyuKubun" AS "shikyu_FushikyuKubun"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."riyushoSakuseiYMD" AS "riyushoSakuseiYMD"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."kaishuTaishoJutakuJusho" AS "kaishuTaishoJutakuJusho"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."kaishuNaiyo_kasho_Kibo" AS "kaishuNaiyo_kasho_Kibo"
        ,"DbT3096JutakuKaishuRiyushoTesuryoShukei"."jutakuKaishuJigyoshaMeisho" AS "jutakuKaishuJigyoshaMeisho"
        ,"DbT3096JutakuKaishuRiyushoTesuryoShukei"."riyushoSakuseiSeikyuKingaku" AS "riyushoSakuseiSeikyuKingaku"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."hihokenshaNo" AS "hihokenshaNo"
        ,"DbT3094JutakuKaishuRiyushoTesuryoKettei"."fushikyuRiyu" AS "fushikyuRiyu"
        ,"DbT3096JutakuKaishuRiyushoTesuryoShukei"."shoKisaiHokenshaNo" AS "shoKisaiHokenshaNo"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."serviceCode" as "serviceCode"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."jutakuKaishuChakkoYMD" AS "jutakuKaishuChakkoYMD"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."jutakuKaishuJushoShozaisha" AS "jutakuKaishuJushoShozaisha"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."riyushoSakuseishaMei" AS "riyushoSakuseishaMei"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."riyushoSakuseishaMeiKana" AS "riyushoSakuseishaMeiKana"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."riyushoSakuseiShinseiYMD" AS "riyushoSakuseiShinseiYMD"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."shukeiNo" AS "shukeiNo"
        ,"DbT3095JutakuKaishuRiyushoTesuryoMeisai"."shukeiFlag" AS "shukeiFlag"
        FROM
        <include refid="共通条件" />
    </select>
    <sql id="共通条件">
        rgdb."DbT3094JutakuKaishuRiyushoTesuryoKettei" AS "DbT3094JutakuKaishuRiyushoTesuryoKettei"
        INNER JOIN rgdb."DbT3096JutakuKaishuRiyushoTesuryoShukei" AS  "DbT3096JutakuKaishuRiyushoTesuryoShukei"
        ON "DbT3094JutakuKaishuRiyushoTesuryoKettei"."riyushoSakuseiJigyoshaNo" = "DbT3096JutakuKaishuRiyushoTesuryoShukei"."riyushoSakuseiJigyoshaNo"
        AND "DbT3094JutakuKaishuRiyushoTesuryoKettei"."shukeiNo" = "DbT3096JutakuKaishuRiyushoTesuryoShukei"."shukeiNo"
        AND "DbT3096JutakuKaishuRiyushoTesuryoShukei"."isDeleted" = False
        INNER JOIN rgdb."DbT3095JutakuKaishuRiyushoTesuryoMeisai" AS "DbT3095JutakuKaishuRiyushoTesuryoMeisai"
        ON "DbT3094JutakuKaishuRiyushoTesuryoKettei"."riyushoSakuseiJigyoshaNo" = "DbT3095JutakuKaishuRiyushoTesuryoMeisai"."riyushoSakuseiJigyoshaNo"
        AND "DbT3094JutakuKaishuRiyushoTesuryoKettei"."shukeiNo" = "DbT3095JutakuKaishuRiyushoTesuryoMeisai"."shukeiNo"
        AND "DbT3095JutakuKaishuRiyushoTesuryoMeisai"."riyushoSakuseiYMD" = (
        SELECT
        MAX("DbT3095JutakuKaishuRiyushoTesuryoMeisai"."riyushoSakuseiYMD")
        FROM
        rgdb."DbT3095JutakuKaishuRiyushoTesuryoMeisai" AS "DbT3095JutakuKaishuRiyushoTesuryoMeisai"
        )
        AND "DbT3095JutakuKaishuRiyushoTesuryoMeisai"."isDeleted" = False
        INNER JOIN
        (SELECT
        <include refid="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1001HihokenshaDaichoMapper.allColumns_DbT1001HihokenshaDaicho" />
        FROM rgdb."DbT1001HihokenshaDaicho" AS "DbT1001HihokenshaDaicho"
        WHERE
        NOT EXISTS (
        SELECT 'X'
        FROM rgdb."DbT1001HihokenshaDaicho" slv
        WHERE
        "DbT1001HihokenshaDaicho"."hihokenshaNo" = slv."hihokenshaNo"
        AND "DbT1001HihokenshaDaicho"."idoYMD" <![CDATA[<]]> slv."idoYMD"
        AND "DbT1001HihokenshaDaicho"."edaNo" <![CDATA[<]]>slv."edaNo")) AS DbT1001HihokenshaDaicho
        ON DbT1001HihokenshaDaicho."dbT1001HihokenshaDaicho_hihokenshaNo" = "DbT3095JutakuKaishuRiyushoTesuryoMeisai"."hihokenshaNo"
        AND "DbT3094JutakuKaishuRiyushoTesuryoKettei"."ketteiYMD" IS NOT NULL
        AND "DbT3094JutakuKaishuRiyushoTesuryoKettei"."ketteiTsuchiSakuseiYMD" IS NULL
        AND #{決定開始日} <![CDATA[<=]]> "DbT3094JutakuKaishuRiyushoTesuryoKettei"."ketteiYMD"
        AND "DbT3094JutakuKaishuRiyushoTesuryoKettei"."ketteiYMD" <![CDATA[<=]]> #{決定終了日}
        <if test="指定事業者のみフラグ">
            AND "DbT3094JutakuKaishuRiyushoTesuryoKettei"."riyushoSakuseiJigyoshaNo" = #{事業者コード}
        </if>
    </sql>
    <select id="get住宅改修理由書作成手数料請求決定" resultOrdered="true" resultMap="ResultMap_DbT3094JutakuKaishuRiyushoTesuryoKetteiEntity"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.dbc100020.KaishuriyushoShikyuKetteitsuchishoParameter"  fetchSize="500">
        SELECT
        DISTINCT
        <include refid="allColumns_DbT3094JutakuKaishuRiyushoTesuryoKettei"/>
        FROM
        <include refid="共通条件" />
    </select>

    <sql id="allColumns_DbT3094JutakuKaishuRiyushoTesuryoKettei">
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."riyushoSakuseiJigyoshaNo" as "riyushoSakuseiJigyoshaNo",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."ketteiYMD" as "ketteiYMD",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."rirekiNo" as "rirekiNo",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."insertDantaiCd" as "insertDantaiCd",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."insertTimestamp" as "insertTimestamp",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."insertReamsLoginId" as "insertReamsLoginId",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."insertContextId" as "insertContextId",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."isDeleted" as "isDeleted",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."updateCount" as "updateCount",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."lastUpdateTimestamp" as "lastUpdateTimestamp",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."lastUpdateReamsLoginId" as "lastUpdateReamsLoginId",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."shikyu_FushikyuKetteiYMD" as "shikyu_FushikyuKetteiYMD",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."shikyu_FushikyuKubun" as "shikyu_FushikyuKubun",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."fushikyuRiyu" as "fushikyuRiyu",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."tesuryoShiharaiYoteiYMD" as "tesuryoShiharaiYoteiYMD",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."shukeiNo" as "shukeiNo",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."ketteiTsuchiSakuseiYMD" as "ketteiTsuchiSakuseiYMD",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."furikomiTsuchiSakuseiYMD" as "furikomiTsuchiSakuseiYMD",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."uketoriYM" as "uketoriYM",
        "DbT3094JutakuKaishuRiyushoTesuryoKettei"."kozaID" as "kozaID"
    </sql>



    <resultMap id="ResultMap_DbT3094JutakuKaishuRiyushoTesuryoKetteiEntity" type="jp.co.ndensan.reams.db.dbc.entity.db.basic.DbT3094JutakuKaishuRiyushoTesuryoKetteiEntity" autoMapping="true">
        <id property="riyushoSakuseiJigyoshaNo" column="riyushoSakuseiJigyoshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
        <id property="ketteiYMD" column="ketteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <id property="rirekiNo" column="rirekiNo" />
        <result property="insertDantaiCd" column="insertDantaiCd" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="insertTimestamp" column="insertTimestamp" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RDateTimeTypeHandler"/>
        <result property="insertReamsLoginId" column="insertReamsLoginId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="insertContextId" column="insertContextId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.UUIDTypeHandler"/>
        <result property="isDeleted" column="isDeleted" />
        <result property="updateCount" column="updateCount" />
        <result property="lastUpdateTimestamp" column="lastUpdateTimestamp" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RDateTimeTypeHandler"/>
        <result property="lastUpdateReamsLoginId" column="lastUpdateReamsLoginId" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shikyu_FushikyuKetteiYMD" column="shikyu_FushikyuKetteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shikyu_FushikyuKubun" column="shikyu_FushikyuKubun" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="fushikyuRiyu" column="fushikyuRiyu" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="tesuryoShiharaiYoteiYMD" column="tesuryoShiharaiYoteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="shukeiNo" column="shukeiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="ketteiTsuchiSakuseiYMD" column="ketteiTsuchiSakuseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="furikomiTsuchiSakuseiYMD" column="furikomiTsuchiSakuseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="uketoriYM" column="uketoriYM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="kozaID" column="kozaID" />
    </resultMap>
</mapper>