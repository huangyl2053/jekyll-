<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBC-4610-030 xuhao -->

<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.kijunshunyugakutekiyokettei.IKijunShunyugakuTekiyoKetteiMapper">
    
    <resultMap id="resultMap_KijunShunyugakuTekiyoKetteiEntity" 
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.kijunshunyugakutekiyokettei.KijunShunyugakuTekiyoKetteiEntity" autoMapping="true">
        <result property="世帯コード" column="setaiCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.SetaiCodeTypeHandler"/>
        <result property="年度" column="nendo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearTypeHandler"/>
        <result property="履歴番号" column="rirekiNo" typeHandler="org.apache.ibatis.type.IntegerTypeHandler"/>
        <result property="被保険者番号" column="hihokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <result property="算定基準額" column="santeiKijungaku" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.DecimalTypeHandler"/>
        <result property="適用開始年月" column="tekiyoKaishiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="申請日" column="shinseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="決定日" column="ketteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="宛先印字対象者フラグ" column="atesakiInjiTaishoshaFlag"/>
        <result property="郵便番号" column="yubinNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.YubinNoTypeHandler"/>
        <result property="町域コード" column="choikiCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ChoikiCodeTypeHandler"/>
        <result property="行政区コード" column="gyoseikuCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.GyoseikuCodeTypeHandler"/>
        <result property="市町村コード" column="shichosonCode" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler"/>
        <result property="識別コード" column="Temp_識別コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
        <association property="宛名Entity"
                     resultMap="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.UaFt200FindShikibetsuTaishoEntity"/>
        <association property="宛先Entity"
                     resultMap="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt250FindAtesakiMapper.resultAtesakiEntity"/>
    </resultMap>
    
    <!-- 基準収入額適用管理の取得 -->
    <select resultOrdered="true" id="select基準収入額適用管理" resultMap="resultMap_KijunShunyugakuTekiyoKetteiEntity"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.kijunshunyugakutekiyokettei.KijunShunyugakuTekiyoKetteiMybatisParameter" fetchSize="500">
        WITH master AS(
        SELECT "DbT3116KijunShunyugakuTekiyoKanri"."setaiCode" AS "setaiCode",
               "DbT3116KijunShunyugakuTekiyoKanri"."nendo",
               "DbT3116KijunShunyugakuTekiyoKanri"."rirekiNo",
               "DbT3116KijunShunyugakuTekiyoKanri"."hihokenshaNo",
               "DbT3116KijunShunyugakuTekiyoKanri"."santeiKijungaku",
               "DbT3116KijunShunyugakuTekiyoKanri"."tekiyoKaishiYMD",
               "DbT3116KijunShunyugakuTekiyoKanri"."shinseiYMD",
               "DbT3116KijunShunyugakuTekiyoKanri"."ketteiYMD",
               "DbT3116KijunShunyugakuTekiyoKanri"."atesakiInjiTaishoshaFlag",
               "DbV1001HihokenshaDaicho"."shikibetsuCode" AS "Temp_識別コード",
               <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt250FindAtesakiMapper.columns_Atesaki"/>,
               "Atesaki"."yubinNo" AS "yubinNo",
               "Atesaki"."choikiCode" AS "choikiCode",
               "Atesaki"."gyoseikuCode" AS "gyoseikuCode",
               "世帯代表者"."市町村コード" AS "shichosonCode"
        FROM rgdb."DbT3116KijunShunyugakuTekiyoKanri" AS "DbT3116KijunShunyugakuTekiyoKanri"
        INNER JOIN (
                    SELECT "DbT3116KijunShunyugakuTekiyoKanri"."setaiCode",
                           "DbV1001HihokenshaDaicho"."shikibetsuCode" AS "世帯代表者識別コード",
                           CASE WHEN "DbV1001HihokenshaDaicho"."koikinaiJushochiTokureiFlag" = '1' 
                           THEN "DbV1001HihokenshaDaicho"."koikinaiTokureiSochimotoShichosonCode"
                           ELSE "DbV1001HihokenshaDaicho"."shichosonCode" END AS "市町村コード"
                    FROM rgdb."DbT3116KijunShunyugakuTekiyoKanri" AS "DbT3116KijunShunyugakuTekiyoKanri"
                    INNER JOIN rgdb."DbV1001HihokenshaDaicho" AS "DbV1001HihokenshaDaicho"
                    ON "DbT3116KijunShunyugakuTekiyoKanri"."hihokenshaNo" = "DbV1001HihokenshaDaicho"."hihokenshaNo"
                    AND "DbT3116KijunShunyugakuTekiyoKanri"."atesakiInjiTaishoshaFlag" = 'TRUE') AS "世帯代表者"
        ON "DbT3116KijunShunyugakuTekiyoKanri"."setaiCode" = "世帯代表者"."setaiCode"
        INNER JOIN rgdb."DbV1001HihokenshaDaicho" AS "DbV1001HihokenshaDaicho"
        ON "DbT3116KijunShunyugakuTekiyoKanri"."hihokenshaNo" = "DbV1001HihokenshaDaicho"."hihokenshaNo"
        INNER JOIN
        rgua."UaFt250FindAtesaki"('DB','DBC','','false','','','true','true','false','false','') AS "Atesaki"
        ON "Atesaki"."shikibetsuCode" = "DbV1001HihokenshaDaicho"."shikibetsuCode"
        WHERE "DbT3116KijunShunyugakuTekiyoKanri"."ketteiYMD" <![CDATA[<>]]> ''
        AND "DbT3116KijunShunyugakuTekiyoKanri"."ketteiYMD" IS NOT NULL
        <if test="抽出期間 == 0001">
            AND "DbT3116KijunShunyugakuTekiyoKanri"."shinseiYMD" <![CDATA[>=]]> #{開始日}
            AND "DbT3116KijunShunyugakuTekiyoKanri"."shinseiYMD" <![CDATA[<=]]> #{終了日}
        </if>
        <if test="抽出期間 == 0002">
            AND "DbT3116KijunShunyugakuTekiyoKanri"."ketteiYMD" <![CDATA[>=]]> #{開始日}
            AND "DbT3116KijunShunyugakuTekiyoKanri"."ketteiYMD" <![CDATA[<=]]> #{終了日}
        </if>
        <if test="印書 == 2">
            AND （"DbT3116KijunShunyugakuTekiyoKanri"."ketteiTsuchishoHakkoYMD" = '' OR "DbT3116KijunShunyugakuTekiyoKanri"."ketteiTsuchishoHakkoYMD" IS NULL）
        </if>)
        SELECT
        master.*,
        <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.columns_ShikibetsuTaisho"/>
        FROM
        master
        INNER JOIN 
        rgua."UaFt200FindShikibetsuTaisho"('','',TRUE,'DB',FALSE,'','','','','','','','','','','',true,
        '','','','','','','',true,'','','','','','','','','','','',true,true,true,true,FALSE,FALSE,true,true,true,true,
        true,'','','','','','','','',true,'','',true,FALSE,true,'','','','','','','','','','','','','','','','','','',
                (
                    SELECT
                        ARRAY_AGG(CAST (master."Temp_識別コード" AS TEXT))
                    FROM
                        master
                 ) ) AS "ShikibetsuTaisho" 
        ON master."Temp_識別コード" = "ShikibetsuTaisho"."shikibetsuCode"
        ORDER BY <if test="temp_出力順 != null and !temp_出力順.isEmpty()">
                    ${temp_出力順},
                 </if>
                 "setaiCode",
                 "atesakiInjiTaishoshaFlag" DESC,
                 "hihokenshaNo"
    </select>
</mapper>