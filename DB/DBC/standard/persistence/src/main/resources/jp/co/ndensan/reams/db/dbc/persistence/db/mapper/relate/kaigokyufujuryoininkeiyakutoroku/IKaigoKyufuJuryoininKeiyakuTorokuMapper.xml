<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBC-2130-050 cuilin -->
<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.kaigokyufujuryoininkeiyakutoroku.IKaigoKyufuJuryoininKeiyakuTorokuMapper">
 
    <resultMap id="resultMap_HihokenshaJohoEntity" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.kaigokyufujuryoininkeiyakutoroku.HihokenshaJohoEntity" autoMapping="true">
       <result property="市町村コード" column="市町村コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.LasdecCodeTypeHandler"/>
       <result property="識別コード" column="識別コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ShikibetsuCodeTypeHandler"/>
       <result property="名称カナ" column="名称カナ" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaKanaMeishoTypeHandler"/>
       <result property="名称漢字" column="名称漢字" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaMeishoTypeHandler"/>
       <result property="生年月日" column="生年月日" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
       <result property="性別" column="性別" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
       <result property="郵便番号" column="郵便番号" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.YubinNoTypeHandler"/>
       <result property="全国住所コード" column="全国住所コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.ZenkokuJushoCodeTypeHandler"/>
       <result property="行政区コード" column="行政区コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.GyoseikuCodeTypeHandler"/>
       <result property="住民種別コード" column="住民種別コード" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
       <result property="住所" column="住所" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.AtenaJushoTypeHandler"/>
    </resultMap>
    <select resultOrdered="true" id="get被保険者情報" resultMap="resultMap_HihokenshaJohoEntity" parameterType="java.util.Map" fetchSize="500">
     WITH master AS(
        SELECT 
            A.*
        FROM
           rgdb."DbV1001HihokenshaDaicho" AS A
        WHERE
            A."logicalDeletedFlag" = FALSE
        AND A."hihokenshaNo" = #{被保険者番号}
        ORDER BY 
            A."idoYMD" DESC, A."edaNo" DESC 
        LIMIT 1
       )
     SELECT
        A."shichosonCode" AS 市町村コード,
        A."shikibetsuCode" AS 識別コード,
        宛名."kanaShimei" AS 名称カナ,
        宛名."kanjiShimei" AS 名称漢字,
        宛名."seinengappiYMD" AS 生年月日,
        宛名."seibetsuCode" AS 性別,
        宛名."yubinNo" AS 郵便番号,
        宛名."zenkokuJushoCode" AS 全国住所コード,
        宛名."gyoseikuCode" AS 行政区コード,
        宛名."juminShubetsuCode" AS 住民種別コード,
        宛名."jusho" AS 住所
     FROM
        master AS A
        LEFT JOIN rgua."UaFt200FindShikibetsuTaisho"('2',#{処理年月日},true,'DB',false,'','','','','','','','','','','',true,
        '','','','','','','',true,'','','','','','','','','','','',true,true,true,true,true,true,true,true,true,true,
        true,'','','','','','','','',true,'','',true,true,true,'','','','','','','','','','','','','','','','','','',
        (SELECT 
           ARRAY_AGG(CAST ("shikibetsuCode" AS TEXT)) 
         FROM master)
        ) AS 宛名
        ON 宛名."shikibetsuCode" = A."shikibetsuCode"
    </select>

</mapper>
