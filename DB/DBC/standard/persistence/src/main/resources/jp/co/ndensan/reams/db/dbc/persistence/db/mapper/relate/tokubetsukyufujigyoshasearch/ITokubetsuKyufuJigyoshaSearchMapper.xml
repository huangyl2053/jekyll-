<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.tokubetsuKyufujigyoshasearch.ITokubetsuKyufuJigyoshaSearchMapper">
    <resultMap id="Result_TokubetsuKyufuJigyoshaSearchEntity" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.dbc2210011.TokubetsuKyufuJigyoshaSearchEntity" autoMapping="true">
     <id property="事業者.jigyoshaNo" column="dbT3065ShichosonTokubetsuKyufuJigyosha_jigyoshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
     <id property="事業者.serviceCode" column="dbT3065ShichosonTokubetsuKyufuJigyosha_serviceCode" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.ServiceCodeTypeHandler"/>
     <id property="事業者.rirekiNo" column="dbT3065ShichosonTokubetsuKyufuJigyosha_rirekiNo"/>
     <result property="市町村特別給付用サービス名" column="市町村特別給付用サービス名" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    <association property="事業者" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3065ShichosonTokubetsuKyufuJigyoshaMapper.ResultMap_DbT3065ShichosonTokubetsuKyufuJigyoshaEntity"/>
    </resultMap>
    <select id="selectサービス内容" 
            resultOrdered="true" 
            resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3066ShichosonTokubetuKyufuServiceMapper.ResultMap_DbT3066ShichosonTokubetuKyufuServiceEntity"
            fetchSize="500">
    SELECT 
    <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3066ShichosonTokubetuKyufuServiceMapper.allColumns_DbT3066ShichosonTokubetuKyufuService"/>
    FROM
    rgdb."DbT3066ShichosonTokubetuKyufuService" AS mst
    WHERE NOT EXISTS WHERE (SELECT 'X' FROM rgdb."DbT3066ShichosonTokubetuKyufuService" AS slv
                            WHERE mst."serviceCode" = slv."serviceCode"
                            AND mst."serviceYukoKikanKaishiYMD" <![CDATA[<]]>  slv."serviceYukoKikanKaishiYMD")
    AND mst."logicalDeletedFlag" is FALSE
    ORDER BY mst."serviceCode" ASC
    </select>
    <select id="select事業者情報" 
            resultOrdered="true"
            resultMap="Result_TokubetsuKyufuJigyoshaSearchEntity"
            parameterType="jp.co.ndensan.reams.uz.uza.lang.RString"
            fetchSize="500">
    SELECT 
    事業者.*
    サービス内容.市町村特別給付用サービス名
    FROM 
    (SELECT 
        <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3065ShichosonTokubetsuKyufuJigyoshaMapper.allColumns_DbT3065ShichosonTokubetsuKyufuJigyosha"/>
        FROM rgdb."DbT3065ShichosonTokubetsuKyufuJigyosha"
        WHERE rgdb."DbT3065ShichosonTokubetsuKyufuJigyosha"."jigyoshaNo" =#{事業者番号}
        AND rgdb."DbT3065ShichosonTokubetsuKyufuJigyosha"."logicalDeletedFlag" IS FALSE
        ) AS 事業者
    LEFT JOIN
        (SELECT mst."serviceCode",
                mst."serviceRyakushoName" AS 市町村特別給付用サービス名
        FROM rgdb."DbT3066ShichosonTokubetuKyufuService" AS mst
        WHERE NOT EXISTS WHERE (SELECT 'X' FROM rgdb."DbT3066ShichosonTokubetuKyufuService" AS slv
                                WHERE mst."serviceCode" = slv."serviceCode"
                                AND mst."serviceYukoKikanKaishiYMD" <![CDATA[<]]> slv."serviceYukoKikanKaishiYMD")
        AND mst."logicalDeletedFlag" is FALSE
        ) AS サービス内容
        ON 事業者."dbT3065ShichosonTokubetsuKyufuJigyosha_jigyoshaNo" = サービス内容."serviceCode"
        ORDER BY 事業者."dbT3065ShichosonTokubetsuKyufuJigyosha_jigyoshaNo" ASC,
                 事業者."dbT3065ShichosonTokubetsuKyufuJigyosha_serviceCode" ASC
    </select>
</mapper>
    
    
