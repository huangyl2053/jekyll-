<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- @reamsid_L DBC-3098-020 xushouyue -->

<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.dbc710060.IHanyoListKyodoJukyushaKogakuMapper">
    <select resultOrdered="true" id="select共同受給者高額情報"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.dbc710060.HanyoListKyodoJukyushaKogakuMybatisParameter"
            resultMap="resultMap_HanyoListKyodoJukyushaKogaku" fetchSize="500">
        <include refid="selectHanyoListKyodoJukyushaKogaku" />
    </select>
    <sql  id="selectHanyoListKyodoJukyushaKogaku">
        WITH "KyodoJukyushaShokanNewest" AS (
        SELECT 
            * 
        FROM 
        rgdb."DbT3004KyodoShoriyoJukyushaIdoKogakuSofu"
        WHERE 
        1=1
        <if test="異動区分s != null and 異動区分s.size() != 0">
            AND "idoKubunCode" IN   
            <foreach collection="異動区分s" item="異動区分" index="index" open="(" close=")" separator=",">
                #{異動区分}
            </foreach>
        </if>
        <if test="世帯所得区分s!=null and 世帯所得区分s.size()!=0">
            AND "setaiShotokuKubunCode" IN
            <foreach collection="世帯所得区分s" item="世帯所得区分" index="index" open="(" close=")" separator=",">
                #{世帯所得区分}
            </foreach>
        </if>
        <if test="所得区分s!=null and 所得区分s.size()!=0">
            AND "shotokuKubunCode" IN
            <foreach collection="所得区分s" item="所得区分" index="index" open="(" close=")" separator=",">
                #{所得区分}
            </foreach>
        </if>
        <if test="老齢年金受給区分s!=null and 老齢年金受給区分s.size()!=0">
            AND "roureiFukushiNenkinJukyuAriFlag" IN
            <foreach collection="老齢年金受給区分s" item="老齢年金受給区分" index="index" open="(" close=")" separator=",">
                ${老齢年金受給区分}
            </foreach>
        </if>
        <if test="利用者負担第2段階s!=null and 利用者負担第2段階s.size()!=0">
            AND "riyoshaFutan2DankaiAriFlag" IN
            <foreach collection="利用者負担第2段階s" item="利用者負担第2段階" index="index" open="(" close=")" separator=",">
                ${利用者負担第2段階}
            </foreach>
        </if>
        <if test="!削除含める" >
            AND "logicalDeletedFlag" = false
        </if>
        <if test="2 == 日付抽出区分" >                       
            <if test="処理対象年月From != null and !処理対象年月From.isEmpty()" >
                AND #{処理対象年月From} <![CDATA[<=]]> "sofuYM"
            </if>
            <if test="処理対象年月To != null and !処理対象年月To.isEmpty()" >
                AND "sofuYM" <![CDATA[<=]]> #{処理対象年月To}
            </if>
            <if test="異動年月From != null and !異動年月From.isEmpty()" > 
                AND #{異動年月From} <![CDATA[<=]]> SUBSTRING("idoYMD" FROM 1 FOR 6) 
            </if>
            <if test="異動年月To != null and !異動年月To.isEmpty()" > 
                AND SUBSTRING("idoYMD" FROM 1 FOR 6)  <![CDATA[<=]]> #{異動年月To}                     
            </if>
            <if test ="!保険者コード.isEmpty() and 保険者コード.toString() != '000000'">
                AND  "shoKisaiHokenshaNo"  = #{保険者コード}
            </if>
        </if>
        )
        SELECT 
          <include refid="allColumns_DbV1001HihokenshaDaicho" />,
          <include refid="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3004KyodoShoriyoJukyushaIdoKogakuSofuMapper.allColumns_DbT3004KyodoShoriyoJukyushaIdoKogakuSofu" />,
          <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.columns_ShikibetsuTaisho" />
        FROM
          "KyodoJukyushaShokanNewest" AS "DbT3004KyodoShoriyoJukyushaIdoKogakuSofu"
         INNER JOIN 
            rgdb."DbV1001HihokenshaDaicho"  AS "DbV1001HihokenshaDaicho"
        ON 
            "DbT3004KyodoShoriyoJukyushaIdoKogakuSofu"."hiHokenshaNo" = "DbV1001HihokenshaDaicho"."hihokenshaNo"
        INNER JOIN
            <include refid="jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.tableName_PsmParamClassShikibetsuTaisho" /> AS "ShikibetsuTaisho"
        ON
            "DbV1001HihokenshaDaicho"."shikibetsuCode"= "ShikibetsuTaisho"."shikibetsuCode" 
        WHERE
            1 = 1
            <if test="1 == 日付抽出区分">
                AND NOT EXISTS(
                    SELECT 
                        1
                    FROM 
                        "KyodoJukyushaShokanNewest" AS "DbT3004HanyoListKyodoJukyushaKogaku2"
                    WHERE 
                        "DbT3004KyodoShoriyoJukyushaIdoKogakuSofu"."hiHokenshaNo" = "DbT3004HanyoListKyodoJukyushaKogaku2"."hiHokenshaNo"
                        AND "DbT3004KyodoShoriyoJukyushaIdoKogakuSofu"."idoYMD" <![CDATA[<]]> "DbT3004HanyoListKyodoJukyushaKogaku2"."idoYMD"
                )
            </if>
            <if test="2 == 日付抽出区分">
                <if test="各異動月の最新のみ">
                    AND NOT EXISTS(
                        SELECT 
                            1
                        FROM 
                            "KyodoJukyushaShokanNewest" AS "DbT3004HanyoListKyodoJukyushaKogaku2"
                        WHERE 
                            "DbT3004KyodoShoriyoJukyushaIdoKogakuSofu"."hiHokenshaNo" = "DbT3004HanyoListKyodoJukyushaKogaku2"."hiHokenshaNo"
                            AND "DbT3004KyodoShoriyoJukyushaIdoKogakuSofu"."sofuYM" = "DbT3004HanyoListKyodoJukyushaKogaku2"."sofuYM"
                            AND "DbT3004KyodoShoriyoJukyushaIdoKogakuSofu"."idoYMD" <![CDATA[<]]> "DbT3004HanyoListKyodoJukyushaKogaku2"."idoYMD"
                    )
                </if>
            </if>
            <if test="!保険者コード.isEmpty() and 保険者コード.toString() != '000000'">
                AND (
                    ("DbV1001HihokenshaDaicho"."koikinaiJushochiTokureiFlag" <![CDATA[<>]]> '1' 
                        AND "DbV1001HihokenshaDaicho"."shichosonCode" = #{保険者コード}
                    )
                    OR
                    ( "DbV1001HihokenshaDaicho"."koikinaiJushochiTokureiFlag" = '1'
                        AND "DbV1001HihokenshaDaicho"."koikinaiTokureiSochimotoShichosonCode" = #{保険者コード}
                    )
                )
            </if>
    </sql>
    <resultMap id="resultMap_HanyoListKyodoJukyushaKogaku" autoMapping="true"
               type="jp.co.ndensan.reams.db.dbc.entity.db.relate.dbc710060.HanyoListKyodoJukyushaKogakuEntity">
        <id column="dbT3004KyodoShoriyoJukyushaIdoKogakuSofu_hiHokenshaNo"/>  
        <id column="dbT3004KyodoShoriyoJukyushaIdoKogakuSofu_idoYMD" />
        <id column="dbT3004KyodoShoriyoJukyushaIdoKogakuSofu_rirekiNo" />
        <association property="受給者異動高額" resultMap="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.basic.IDbT3004KyodoShoriyoJukyushaIdoKogakuSofuMapper.ResultMap_DbT3004KyodoShoriyoJukyushaIdoKogakuSofuEntity"/>
        <association property="被保険者台帳管理" resultMap="jp.co.ndensan.reams.db.dbz.persistence.db.mapper.basic.IDbT1001HihokenshaDaichoMapper.ResultMap_DbT1001HihokenshaDaichoEntity"/>
        <association property="宛名" resultMap = "jp.co.ndensan.reams.ua.uax.persistence.db.mapper.IUaFt200FindShikibetsuTaishoFunctionMapper.UaFt200FindShikibetsuTaishoEntity"/>
    </resultMap> 
    <sql id="allColumns_DbV1001HihokenshaDaicho">
        "DbV1001HihokenshaDaicho"."hihokenshaNo" as "dbT1001HihokenshaDaicho_hihokenshaNo",
        "DbV1001HihokenshaDaicho"."idoYMD" as "dbT1001HihokenshaDaicho_idoYMD",
        "DbV1001HihokenshaDaicho"."edaNo" as "dbT1001HihokenshaDaicho_edaNo",
        "DbV1001HihokenshaDaicho"."idoJiyuCode" as "dbT1001HihokenshaDaicho_idoJiyuCode",
        "DbV1001HihokenshaDaicho"."shichosonCode" as "dbT1001HihokenshaDaicho_shichosonCode",
        "DbV1001HihokenshaDaicho"."shikibetsuCode" as "dbT1001HihokenshaDaicho_shikibetsuCode",
        "DbV1001HihokenshaDaicho"."shikakuShutokuJiyuCode" as "dbT1001HihokenshaDaicho_shikakuShutokuJiyuCode",
        "DbV1001HihokenshaDaicho"."shikakuShutokuYMD" as "dbT1001HihokenshaDaicho_shikakuShutokuYMD",
        "DbV1001HihokenshaDaicho"."shikakuShutokuTodokedeYMD" as "dbT1001HihokenshaDaicho_shikakuShutokuTodokedeYMD",
        "DbV1001HihokenshaDaicho"."ichigoShikakuShutokuYMD" as "dbT1001HihokenshaDaicho_ichigoShikakuShutokuYMD",
        "DbV1001HihokenshaDaicho"."hihokennshaKubunCode" as "dbT1001HihokenshaDaicho_hihokennshaKubunCode",
        "DbV1001HihokenshaDaicho"."shikakuSoshitsuJiyuCode" as "dbT1001HihokenshaDaicho_shikakuSoshitsuJiyuCode",
        "DbV1001HihokenshaDaicho"."shikakuSoshitsuYMD" as "dbT1001HihokenshaDaicho_shikakuSoshitsuYMD",
        "DbV1001HihokenshaDaicho"."shikakuSoshitsuTodokedeYMD" as "dbT1001HihokenshaDaicho_shikakuSoshitsuTodokedeYMD",
        "DbV1001HihokenshaDaicho"."shikakuHenkoJiyuCode" as "dbT1001HihokenshaDaicho_shikakuHenkoJiyuCode",
        "DbV1001HihokenshaDaicho"."shikakuHenkoYMD" as "dbT1001HihokenshaDaicho_shikakuHenkoYMD",
        "DbV1001HihokenshaDaicho"."shikakuHenkoTodokedeYMD" as "dbT1001HihokenshaDaicho_shikakuHenkoTodokedeYMD",
        "DbV1001HihokenshaDaicho"."jushochitokureiTekiyoJiyuCode" as "dbT1001HihokenshaDaicho_jushochitokureiTekiyoJiyuCode",
        "DbV1001HihokenshaDaicho"."jushochitokureiTekiyoYMD" as "dbT1001HihokenshaDaicho_jushochitokureiTekiyoYMD",
        "DbV1001HihokenshaDaicho"."jushochitokureiTekiyoTodokedeYMD" as "dbT1001HihokenshaDaicho_jushochitokureiTekiyoTodokedeYMD",
        "DbV1001HihokenshaDaicho"."jushochitokureiKaijoJiyuCode" as "dbT1001HihokenshaDaicho_jushochitokureiKaijoJiyuCode",
        "DbV1001HihokenshaDaicho"."jushochitokureiKaijoYMD" as "dbT1001HihokenshaDaicho_jushochitokureiKaijoYMD",
        "DbV1001HihokenshaDaicho"."jushochitokureiKaijoTodokedeYMD" as "dbT1001HihokenshaDaicho_jushochitokureiKaijoTodokedeYMD",
        "DbV1001HihokenshaDaicho"."jushochiTokureiFlag" as "dbT1001HihokenshaDaicho_jushochiTokureiFlag",
        "DbV1001HihokenshaDaicho"."koikinaiJushochiTokureiFlag" as "dbT1001HihokenshaDaicho_koikinaiJushochiTokureiFlag",
        "DbV1001HihokenshaDaicho"."koikinaiTokureiSochimotoShichosonCode" as "dbT1001HihokenshaDaicho_koikinaiTokureiSochimotoShichosonCode",
        "DbV1001HihokenshaDaicho"."kyuShichosonCode" as "dbT1001HihokenshaDaicho_kyuShichosonCode",
        "DbV1001HihokenshaDaicho"."logicalDeletedFlag" as "dbT1001HihokenshaDaicho_logicalDeletedFlag"
    </sql>
</mapper>
