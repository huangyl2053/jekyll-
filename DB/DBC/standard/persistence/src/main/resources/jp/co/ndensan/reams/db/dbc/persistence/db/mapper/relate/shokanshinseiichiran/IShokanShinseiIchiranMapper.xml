<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 償還払申請一覧 -->
<!-- @reamsid_L DBC-0960-020 hezhenzhen -->
<mapper namespace="jp.co.ndensan.reams.db.dbc.persistence.db.mapper.relate.shokanshinseiichiran.IShokanShinseiIchiranMapper">

    <resultMap id="ShokanShinseiIchiranRelateEntity" type="jp.co.ndensan.reams.db.dbc.entity.db.relate.shokanshinseiichiran.ShokanShinseiIchiranRelateEntity">
        <result property="hiHokenshaNo" column="hiHokenshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.HihokenshaNoTypeHandler"/>
        <result property="serviceTeikyoYM" column="serviceTeikyoYM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="seiriNo" column="seiriNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="yoshikiNo" column="yoshikiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
        <result property="shinseiYMD" column="shinseiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="sofuYM" column="sofuYM" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleYearMonthTypeHandler"/>
        <result property="ketteiYMD" column="ketteiYMD" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.FlexibleDateTypeHandler"/>
        <result property="jigyoshaNo" column="jigyoshaNo" typeHandler="jp.co.ndensan.reams.db.dbx.entity.typehandlers.JigyoshaNoTypeHandler"/>
         <result property="meisaiNo" column="meisaiNo" typeHandler="jp.co.ndensan.reams.uz.uza.util.db.typehandlers.RStringTypeHandler"/>
    </resultMap>
    <select resultOrdered="true" id="select償還払支給申請リスト照会"
            resultMap="ShokanShinseiIchiranRelateEntity"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.shokanshinseiichiran.ShokanShinseiIchiranParameter" fetchSize="500">
        SELECT
        shokanShinsei."hiHokenshaNo" AS "hiHokenshaNo",
        shokanShinsei."serviceTeikyoYM" AS "serviceTeikyoYM",
        shokanShinsei."seiriNo" AS "seiriNo",
        T1."yoshikiNo" AS "yoshikiNo",
        T1."jigyoshaNo" AS "jigyoshaNo",
        T1."meisaiNo" AS "meisaiNo",
        shokanShinsei."shinseiYMD" AS "shinseiYMD",
        shokanShinsei."sofuYM" AS "sofuYM",
        T2."ketteiYMD" AS "ketteiYMD"
        FROM
        rgdb."DbT3034ShokanShinsei" AS shokanShinsei
        INNER JOIN
        (
        SELECT
        shokanKihon."hiHokenshaNo" AS "hiHokenshaNo",
        shokanKihon."serviceTeikyoYM" AS "serviceTeikyoYM",
        shokanKihon."seiriNo" AS "seiriNo",
        shokanKihon."jigyoshaNo" AS "jigyoshaNo",
        shokanKihon."yoshikiNo" AS "yoshikiNo",
        shokanKihon."meisaiNo" AS "meisaiNo"
        FROM
        rgdb."DbT3038ShokanKihon" AS shokanKihon
        WHERE
        shokanKihon."hiHokenshaNo" = #{被保険者番号}
        <if test="!isサービス提供年月FromEmpty">
            AND shokanKihon."serviceTeikyoYM" <![CDATA[>=]]> #{サービス提供年月From}
        </if>
        <if test="!isサービス提供年月ToEmpty">
            AND shokanKihon."serviceTeikyoYM" <![CDATA[<=]]> #{サービス提供年月To}
        </if>
        GROUP BY
        shokanKihon."hiHokenshaNo",
        shokanKihon."serviceTeikyoYM",
        shokanKihon."seiriNo",
        shokanKihon."meisaiNo",
        shokanKihon."jigyoshaNo",
        shokanKihon."yoshikiNo"
        )AS T1
        ON
        T1."hiHokenshaNo" = shokanShinsei."hiHokenshaNo" AND
        T1."serviceTeikyoYM" = shokanShinsei."serviceTeikyoYM" AND
        t1."seiriNo" = shokanShinsei."seiriNo"
        LEFT JOIN
        (
        SELECT
        shokanHanteiKekka."hiHokenshaNo" AS "hiHokenshaNo",
        shokanHanteiKekka."serviceTeikyoYM" AS "serviceTeikyoYM",
        shokanHanteiKekka."seiriNo" AS "seiriNo",
        shokanHanteiKekka."ketteiYMD" AS "ketteiYMD"
        FROM
        rgdb."DbT3036ShokanHanteiKekka" AS shokanHanteiKekka
        WHERE
        shokanHanteiKekka."hiHokenshaNo" = #{被保険者番号}
        <if test="!isサービス提供年月FromEmpty">
            AND shokanHanteiKekka."serviceTeikyoYM" <![CDATA[>=]]> #{サービス提供年月From}
        </if>
        <if test="!isサービス提供年月ToEmpty">
            AND shokanHanteiKekka."serviceTeikyoYM" <![CDATA[<=]]> #{サービス提供年月To}
        </if>
        )AS T2
        ON
        T2."hiHokenshaNo" = shokanShinsei."hiHokenshaNo" AND
        T2."serviceTeikyoYM" = shokanShinsei."serviceTeikyoYM" AND
        T2."seiriNo" = shokanShinsei."seiriNo"
        WHERE
        shokanShinsei."hiHokenshaNo" = #{被保険者番号}
        <if test="!isサービス提供年月FromEmpty">
            AND shokanShinsei."serviceTeikyoYM" <![CDATA[>=]]> #{サービス提供年月From}
        </if>
        <if test="!isサービス提供年月ToEmpty">
            AND shokanShinsei."serviceTeikyoYM" <![CDATA[<=]]> #{サービス提供年月To}
        </if>
        ORDER BY
        shokanShinsei."serviceTeikyoYM" DESC,
        shokanShinsei."seiriNo" DESC
    </select>
    <select resultOrdered="true" id="select償還払支給申請リスト申請"
            resultMap="ShokanShinseiIchiranRelateEntity"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.shokanshinseiichiran.ShokanShinseiIchiranParameter" fetchSize="500">

        SELECT
        shokanShinsei."hiHokenshaNo" AS "hiHokenshaNo",
        shokanShinsei."serviceTeikyoYM" AS "serviceTeikyoYM",
        shokanShinsei."seiriNo" AS "seiriNo",
        T1."yoshikiNo" AS "yoshikiNo",
        shokanShinsei."shinseiYMD" AS "shinseiYMD",
        shokanShinsei."sofuYM" AS "sofuYM",
        T2."ketteiYMD" AS "ketteiYMD"
        FROM
        rgdb."DbT3034ShokanShinsei" AS shokanShinsei
        INNER JOIN
        (
        SELECT
        shokanKihon."hiHokenshaNo" AS "hiHokenshaNo",
        shokanKihon."serviceTeikyoYM" AS "serviceTeikyoYM",
        shokanKihon."seiriNo" AS "seiriNo",
        shokanKihon."yoshikiNo" AS "yoshikiNo"
        FROM
        rgdb."DbT3038ShokanKihon" AS shokanKihon
        WHERE
        shokanKihon."hiHokenshaNo" = #{被保険者番号}
        <if test="!isサービス提供年月FromEmpty">
            AND shokanKihon."serviceTeikyoYM" <![CDATA[>=]]> #{サービス提供年月From}
        </if>
        <if test="!isサービス提供年月ToEmpty">
            AND shokanKihon."serviceTeikyoYM" <![CDATA[<=]]> #{サービス提供年月To}
        </if>
        AND substring(shokanKihon."yoshikiNo",1,3) <![CDATA[<>]]> '21C'
        AND substring(shokanKihon."yoshikiNo",1,3) <![CDATA[<>]]> '21D'
        GROUP BY
        shokanKihon."hiHokenshaNo",
        shokanKihon."serviceTeikyoYM",
        shokanKihon."seiriNo",
        shokanKihon."yoshikiNo"
        )AS T1
        ON
        T1."hiHokenshaNo" = shokanShinsei."hiHokenshaNo" AND
        T1."serviceTeikyoYM" = shokanShinsei."serviceTeikyoYM" AND
        T1."seiriNo" = shokanShinsei."seiriNo"
        LEFT JOIN
        (
        SELECT
        shokanHanteiKekka."hiHokenshaNo" AS "hiHokenshaNo",
        shokanHanteiKekka."serviceTeikyoYM" AS "serviceTeikyoYM",
        shokanHanteiKekka."seiriNo" AS "seiriNo",
        shokanHanteiKekka."ketteiYMD" AS "ketteiYMD"
        FROM
        rgdb."DbT3036ShokanHanteiKekka" AS shokanHanteiKekka
        WHERE
        shokanHanteiKekka."hiHokenshaNo" = #{被保険者番号}
        <if test="!isサービス提供年月FromEmpty">
            AND shokanHanteiKekka."serviceTeikyoYM" <![CDATA[>=]]> #{サービス提供年月From}
        </if>
        <if test="!isサービス提供年月ToEmpty">
            AND shokanHanteiKekka."serviceTeikyoYM" <![CDATA[<=]]> #{サービス提供年月To}
        </if>
        )AS T2
        ON
        T2."hiHokenshaNo" = shokanShinsei."hiHokenshaNo" AND
        T2."serviceTeikyoYM" = shokanShinsei."serviceTeikyoYM" AND
        T2."seiriNo" = shokanShinsei."seiriNo"
        WHERE
        shokanShinsei."hiHokenshaNo" = #{被保険者番号}
        <if test="!isサービス提供年月FromEmpty">
            AND shokanShinsei."serviceTeikyoYM" <![CDATA[>=]]> #{サービス提供年月From}
        </if>
        <if test="!isサービス提供年月ToEmpty">
            AND shokanShinsei."serviceTeikyoYM" <![CDATA[<=]]> #{サービス提供年月To}
        </if>
        ORDER BY
        shokanShinsei."serviceTeikyoYM" DESC,
        shokanShinsei."seiriNo" DESC
    </select>
    <select resultOrdered="true" id="select償還払支給申請情報件数取得"
            resultType="java.lang.Integer"
            parameterType="jp.co.ndensan.reams.db.dbc.definition.mybatisprm.shokanshinseiichiran.ShokanShinseiIchiranParameterCount" fetchSize="500">
        SELECT
        count(0)
        FROM
        rgdb."DbT3034ShokanShinsei" AS ShokanShinsei
        INNER JOIN
        (
        SELECT
        ShokanKihon."hiHokenshaNo" AS "hiHokenshaNo",
        ShokanKihon."serviceTeikyoYM" AS "serviceTeikyoYM",
        ShokanKihon."seiriNo" AS "seiriNo"
        FROM
        rgdb."DbT3038ShokanKihon" AS ShokanKihon
        WHERE
        shokanKihon."hiHokenshaNo" = #{被保険者番号} AND
        shokanKihon."serviceTeikyoYM" = #{サービス年月} AND
        substring(shokanKihon."yoshikiNo",1,3) <![CDATA[<>]]> '21C' AND
        substring(shokanKihon."yoshikiNo",1,3) <![CDATA[<>]]> '21D'
        ORDER BY
        ShokanKihon."hiHokenshaNo",
        ShokanKihon."serviceTeikyoYM",
        ShokanKihon."seiriNo"
        ) T1
        ON
        T1."hiHokenshaNo" = ShokanShinsei."hiHokenshaNo"AND
        T1."serviceTeikyoYM" = ShokanShinsei."serviceTeikyoYM" AND
        T1."seiriNo" = ShokanShinsei."seiriNo"
        WHERE
        ShokanShinsei."hiHokenshaNo" = #{被保険者番号} AND
        ShokanShinsei."serviceTeikyoYM" = #{サービス年月}
    </select>
</mapper>